<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Python 3.12 有什么新变化" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://docs.python.org/3/whatsnew/3.12.xhtml" />
<meta property="og:site_name" content="Python documentation" />
<meta property="og:description" content="编者, Adam Turner,. 本文介绍 Python 3.12 相比 3.11 增加的新特性。 Python 3.12 已于 2023 年 10 月 2 日发布。 要获取详细信息，可参阅 changelog 。 摘要 -- 发布重点: Python 3.12 是 Python 编程语言的最新稳定发布版，包含一系列对语言和标准库的改变。 库的改变主要集中在清理已弃用的 API、可用性和正..." />
<meta property="og:image" content="https://docs.python.org/3/_static/og-image.png" />
<meta property="og:image:alt" content="Python documentation" />
<meta name="description" content="编者, Adam Turner,. 本文介绍 Python 3.12 相比 3.11 增加的新特性。 Python 3.12 已于 2023 年 10 月 2 日发布。 要获取详细信息，可参阅 changelog 。 摘要 -- 发布重点: Python 3.12 是 Python 编程语言的最新稳定发布版，包含一系列对语言和标准库的改变。 库的改变主要集中在清理已弃用的 API、可用性和正..." />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta name="theme-color" content="#3776ab" />

    <title>Python 3.12 有什么新变化</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/epub.css" />
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.12.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
 

  </head><body>


    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-12">
<h1>Python 3.12 有什么新变化</h1>
<dl class="field-list simple">
<dt class="field-odd">编者<span class="colon">:</span></dt>
<dd class="field-odd"><p>Adam Turner</p>
</dd>
</dl>
<p>本文介绍 Python 3.12 相比 3.11 增加的新特性。 Python 3.12 已于 2023 年 10 月 2 日发布。 要获取详细信息，可参阅 <a class="reference internal" href="changelog.xhtml#changelog"><span class="std std-ref">changelog</span></a>。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><span class="target" id="index-98"></span><a class="pep reference external" href="https://peps.python.org/pep-0693/"><strong>PEP 693</strong></a><span class="link-target"> [https://peps.python.org/pep-0693/]</span> -- Python 3.12 发布计划</p>
</div>
<section id="summary-release-highlights">
<h2>摘要 -- 发布重点</h2>
<p>Python 3.12 是 Python 编程语言的最新稳定发布版，包含一系列对语言和标准库的改变。 库的改变主要集中在清理已弃用的 API、可用性和正确性等方面。 值得注意的是，<code class="xref py py-mod docutils literal notranslate"><span class="pre">distutils</span></code> 包已从标准库中移除。 <a class="reference internal" href="../library/os.xhtml#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> 和 <a class="reference internal" href="../library/pathlib.xhtml#module-pathlib" title="pathlib: Object-oriented filesystem paths"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pathlib</span></code></a> 中的文件系统支持增加了许多改进，而且部分模块的性能也获得了提升。</p>
<p>语言的改变主要集中在可用性方面，如 <a class="reference internal" href="../glossary.xhtml#term-f-string"><span class="xref std std-term">f-字符串</span></a> 的许多限制已被移除，而 'Did you mean ...' 提示消息继续得到改进。 新的 <a class="reference internal" href="#whatsnew312-pep695"><span class="std std-ref">类型形参语法</span></a> 和 <a class="reference internal" href="../reference/simple_stmts.xhtml#type"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">type</span></code></a> 语句提升了 <a class="reference internal" href="../glossary.xhtml#term-generic-type"><span class="xref std std-term">泛型类型</span></a> 和 <a class="reference internal" href="../glossary.xhtml#term-type-alias"><span class="xref std std-term">类型别名</span></a> 配合静态类型检查器使用时的效率。</p>
<p>本文并不试图提供所有新功能的完整规范说明，而是提供一个方便的概览。 如需了解完整细节，请参阅相应文档，如 <a class="reference internal" href="../library/index.xhtml#library-index"><span class="std std-ref">标准库参考</span></a> 和 <a class="reference internal" href="../reference/index.xhtml#reference-index"><span class="std std-ref">语言参考</span></a>。 如果你想了解某项改变的完整实现和设计理念，请参阅相应新特性的 PEP；但请注意一旦某项特性已完全实现则相应 PEP 通常不会再继续更新。</p>
<hr class="docutils" />
<p>新的语法特性：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep695"><span class="std std-ref">PEP 695</span></a>，类型形参语法和 <a class="reference internal" href="../reference/simple_stmts.xhtml#type"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">type</span></code></a> 语句</p></li>
</ul>
<p>新的语法特性：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep701"><span class="std std-ref">PEP 701</span></a>，<a class="reference internal" href="../glossary.xhtml#term-f-string"><span class="xref std std-term">f-字符串</span></a> 语法的改进</p></li>
</ul>
<p>解释器的改进:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep684"><span class="std std-ref">PEP 684</span></a>，单独的每解释器 <a class="reference internal" href="../glossary.xhtml#term-global-interpreter-lock"><span class="xref std std-term">GIL</span></a></p></li>
<li><p><a class="reference internal" href="#whatsnew312-pep669"><span class="std std-ref">PEP 669</span></a>，低开销的监控</p></li>
<li><p>针对 <a class="reference internal" href="../library/exceptions.xhtml#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a>, <a class="reference internal" href="../library/exceptions.xhtml#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> 和 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 异常 <a class="reference internal" href="#improved-error-messages">改进了 'Did you mean ...' 提示消息</a>。</p></li>
</ul>
<p>对 Python 数据模型的改进：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep688"><span class="std std-ref">PEP 688</span></a>，使用 Python 的 <a class="reference internal" href="../c-api/buffer.xhtml#bufferobjects"><span class="std std-ref">缓冲区协议</span></a></p></li>
</ul>
<p>标准库中的重大改进：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/pathlib.xhtml#pathlib.Path" title="pathlib.Path"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> 类现在支持子类化</p></li>
<li><p><a class="reference internal" href="../library/os.xhtml#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> 模块获得了多项针对 Windows 支持的改进</p></li>
<li><p>在 <a class="reference internal" href="../library/sqlite3.xhtml#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a> 模块中添加了 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3-cli"><span class="std std-ref">命令行界面</span></a>。</p></li>
<li><p>基于 <a class="reference internal" href="../library/typing.xhtml#typing.runtime_checkable" title="typing.runtime_checkable"><code class="xref py py-func docutils literal notranslate"><span class="pre">运行时可检测协议</span></code></a> 的 <a class="reference internal" href="../library/functions.xhtml#isinstance" title="isinstance"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> 检测获得了 2 至 20 倍的提速</p></li>
<li><p><a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 包的性能获得了多项改进，一些基准测试显示有 75% 的提速。</p></li>
<li><p>在 <a class="reference internal" href="../library/uuid.xhtml#module-uuid" title="uuid: UUID objects (universally unique identifiers) according to RFC 4122"><code class="xref py py-mod docutils literal notranslate"><span class="pre">uuid</span></code></a> 模块中添加了 <a class="reference internal" href="../library/uuid.xhtml#uuid-cli"><span class="std std-ref">命令行界面</span></a>。</p></li>
<li><p>由于 <a class="reference internal" href="#whatsnew312-pep701"><span class="std std-ref">PEP 701</span></a> 中的更改，通过 <a class="reference internal" href="../library/tokenize.xhtml#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tokenize</span></code></a> 模块生成令牌（token）的速度最多可提高 64%。</p></li>
</ul>
<p>安全改进：</p>
<ul class="simple">
<li><p>用来自  <a class="reference external" href="https://github.com/hacl-star/hacl-star/">HACL*</a><span class="link-target"> [https://github.com/hacl-star/hacl-star/]</span> 项目的经过正式验证的代码替代 SHA1, SHA3, SHA2-384, SHA2-512 和 MD5 的内置 <a class="reference internal" href="../library/hashlib.xhtml#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code class="xref py py-mod docutils literal notranslate"><span class="pre">hashlib</span></code></a> 实现。 这些内置实现保留作为仅在当 OpenSSL 未提供它们时使用的回退选项。</p></li>
</ul>
<p>C API 的改进：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep697"><span class="std std-ref">PEP 697</span></a>，不稳定 C API 层</p></li>
<li><p><a class="reference internal" href="#whatsnew312-pep683"><span class="std std-ref">PEP 683</span></a>，永生对象</p></li>
</ul>
<p>CPython 实现的改进：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep709"><span class="std std-ref">PEP 709</span></a>，推导式内联化</p></li>
<li><p>对 Linux <code class="docutils literal notranslate"><span class="pre">perf</span></code> 性能分析器的 <a class="reference internal" href="../howto/perf_profiling.xhtml#perf-profiling"><span class="std std-ref">CPython 支持</span></a></p></li>
<li><p>在受支持的平台上实现栈溢出保护</p></li>
</ul>
<p>新的类型标注特性：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#whatsnew312-pep692"><span class="std std-ref">PEP 692</span></a>，使用 <a class="reference internal" href="../library/typing.xhtml#typing.TypedDict" title="typing.TypedDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypedDict</span></code></a> 来标注 <a class="reference internal" href="../glossary.xhtml#term-argument"><span class="xref std std-term">**kwargs</span></a></p></li>
<li><p><a class="reference internal" href="#whatsnew312-pep698"><span class="std std-ref">PEP 698</span></a>，<a class="reference internal" href="../library/typing.xhtml#typing.override" title="typing.override"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.override()</span></code></a> 装饰器</p></li>
</ul>
<p>重要的弃用、移除或限制：</p>
<ul class="simple">
<li><p><span class="target" id="index-99"></span><a class="pep reference external" href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a><span class="link-target"> [https://peps.python.org/pep-0623/]</span>: 在 Python 的 C API 中移除 Unicode 对象中的 <code class="docutils literal notranslate"><span class="pre">wstr</span></code>，使每个 <a class="reference internal" href="../library/stdtypes.xhtml#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 对象的大小缩减至少 8 个字节。</p></li>
<li><p><span class="target" id="index-100"></span><a class="pep reference external" href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a><span class="link-target"> [https://peps.python.org/pep-0632/]</span>: 移除 <code class="xref py py-mod docutils literal notranslate"><span class="pre">distutils</span></code> 包。 请参阅 <a class="reference external" href="https://peps.python.org/pep-0632/#migration-advice">迁移指南</a><span class="link-target"> [https://peps.python.org/pep-0632/#migration-advice]</span> 了解有关替换其所提供的 API 的建议。 第三方 <a class="reference external" href="https://setuptools.pypa.io/en/latest/deprecated/distutils-legacy.html">Setuptools</a><span class="link-target"> [https://setuptools.pypa.io/en/latest/deprecated/distutils-legacy.html]</span> 包将继续提供 <code class="xref py py-mod docutils literal notranslate"><span class="pre">distutils</span></code>，如果你在 Python 3.12 及更高版本中仍然需要它的话。</p></li>
<li><p><a class="reference external" href="https://github.com/python/cpython/issues/95299">gh-95299</a><span class="link-target"> [https://github.com/python/cpython/issues/95299]</span>: 不在使用 <a class="reference internal" href="../library/venv.xhtml#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> 创建的虚拟环境中预装 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>。 这意味着 <code class="docutils literal notranslate"><span class="pre">distutils</span></code>、<code class="docutils literal notranslate"><span class="pre">setuptools</span></code>、<code class="docutils literal notranslate"><span class="pre">pkg_resources</span></code> 和 <code class="docutils literal notranslate"><span class="pre">easy_install</span></code> 默认将不再可用；要访问这些工具请在  <a class="reference internal" href="../library/venv.xhtml#venv-explanation"><span class="std std-ref">激活的</span></a> 虚拟环境中运行 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">setuptools</span></code>。</p></li>
<li><p>移除了 <code class="xref py py-mod docutils literal notranslate"><span class="pre">asynchat</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncore</span></code> 和 <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code> 模块，以及一些 <a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> <a class="reference internal" href="#unittest-testcase-removed-aliases">方法别名</a>。</p></li>
</ul>
</section>
<section id="new-features">
<h2>新的特性</h2>
<section id="pep-695-type-parameter-syntax">
<span id="whatsnew312-pep695"></span><h3>PEP 695: 类型形参语法</h3>
<p><span class="target" id="index-101"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a><span class="link-target"> [https://peps.python.org/pep-0484/]</span> 下的泛型类和函数是使用详细语法声明的，这使得类型参数的范围不明确，并且需要显式声明变化。</p>
<p><span class="target" id="index-102"></span><a class="pep reference external" href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a><span class="link-target"> [https://peps.python.org/pep-0695/]</span> 引入了一种新的、更紧凑、更明确的方式来创建 <a class="reference internal" href="../reference/compound_stmts.xhtml#generic-classes"><span class="std std-ref">泛型类</span></a> 和 <a class="reference internal" href="../reference/compound_stmts.xhtml#generic-functions"><span class="std std-ref">函数</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">max</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">list</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>此外，该 PEP 引入了一种新的方法来使用 <a class="reference internal" href="../reference/simple_stmts.xhtml#type"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">type</span></code></a> 语句声明 <a class="reference internal" href="../library/typing.xhtml#type-aliases"><span class="std std-ref">类型别名</span></a>，该语句会创建 <a class="reference internal" href="../library/typing.xhtml#typing.TypeAliasType" title="typing.TypeAliasType"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeAliasType</span></code></a> 的实例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">Point</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
</pre></div>
</div>
<p>类型别名也可以是  <a class="reference internal" href="../reference/compound_stmts.xhtml#generic-type-aliases"><span class="std std-ref">generic</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">Point</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>新语法允许声明 <a class="reference internal" href="../library/typing.xhtml#typing.TypeVarTuple" title="typing.TypeVarTuple"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVarTuple</span></code></a> 和 <a class="reference internal" href="../library/typing.xhtml#typing.ParamSpec" title="typing.ParamSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamSpec</span></code></a> 形参，以及带边界或约束的 <a class="reference internal" href="../library/typing.xhtml#typing.TypeVar" title="typing.TypeVar"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code></a> 形参:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">IntFunc</span><span class="p">[</span><span class="o">**</span><span class="n">P</span><span class="p">]</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>  <span class="c1"># ParamSpec</span>
<span class="nb">type</span> <span class="n">LabeledTuple</span><span class="p">[</span><span class="o">*</span><span class="n">Ts</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">Ts</span><span class="p">]</span>  <span class="c1"># TypeVarTuple</span>
<span class="nb">type</span> <span class="n">HashableSequence</span><span class="p">[</span><span class="n">T</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>  <span class="c1"># TypeVar with bound</span>
<span class="nb">type</span> <span class="n">IntOrStrSequence</span><span class="p">[</span><span class="n">T</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>  <span class="c1"># TypeVar with constraints</span>
</pre></div>
</div>
<p>类型别名的值以及通过此语法创建的类型变量的边界和约束仅在需要时才进行求值 (参见 <a class="reference internal" href="../reference/executionmodel.xhtml#lazy-evaluation"><span class="std std-ref">惰性求值</span></a>)。 这意味着类型别名可以引用稍后在文件中定义的其他类型。</p>
<p>通过类型参数列表声明的类型参数在声明的作用域和任何嵌套的作用域内都可见，但在外部作用域内不可见。 例如，它们可以用于泛型类的方法的类型注解或类体中。 但是，在定义类之后，不能在模块范围中使用它们。 有关类型参数的运行时语义的详细描述，请参见 <a class="reference internal" href="../reference/compound_stmts.xhtml#type-params"><span class="std std-ref">类型形参列表</span></a>。</p>
<p>为了支持这些作用域定义，引入了一种新的作用域，即 <a class="reference internal" href="../reference/executionmodel.xhtml#annotation-scopes"><span class="std std-ref">标注作用域</span></a>。 标注作用域的行为在很大程度上类似于函数作用域，但与封闭类作用作用域的交互方式不同。 在 Python 3.13 中，<a class="reference internal" href="../glossary.xhtml#term-annotation"><span class="xref std std-term">标注</span></a> 也将在标注作用域中进行求值。</p>
<p>更多细节请参见 <span class="target" id="index-103"></span><a class="pep reference external" href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a><span class="link-target"> [https://peps.python.org/pep-0695/]</span>。</p>
<p>（PEP由 Eric Traut 撰写。 由 Jelle Zijlstra、Eric Traut 和其他人在 <a class="reference external" href="https://github.com/python/cpython/issues/103764">gh-103764</a><span class="link-target"> [https://github.com/python/cpython/issues/103764]</span> 中实现。）</p>
</section>
<section id="pep-701-syntactic-formalization-of-f-strings">
<span id="whatsnew312-pep701"></span><h3>PEP 701：f-字符串的句法形式化</h3>
<p><span class="target" id="index-104"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span> 取消了对 <a class="reference internal" href="../glossary.xhtml#term-f-string"><span class="xref std std-term">f-字符串</span></a> 使用的一些限制。 f-字符串内部的表达式部分现在可以是任何有效的 Python 表达式，包括重用了与标记 f-字符串本身相同的引号的字符串、多行表达式、注释、反斜杠以及 unicode 转义序列。 让我们详细介绍一下：</p>
<ul>
<li><p>引号重用：在 Python 3.11 中，重用与标记 f-字符串本身相同的引号会引发 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>，迫使用户使用其他可用的引号（如在 f-字符串使用单引号时使用双引号或三重引号）。 在 Python 3.12 中，你现在可以这样做了：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">songs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Take me back to Eden&#39;</span><span class="p">,</span> <span class="s1">&#39;Alkaline&#39;</span><span class="p">,</span> <span class="s1">&#39;Ascensionism&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s2">&quot;This is the playlist: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">songs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="go">&#39;This is the playlist: Take me back to Eden, Alkaline, Ascensionism&#39;</span>
</pre></div>
</div>
<p>请注意，在这一更改之前，对f-字符串的嵌套方式没有明确的限制，但字符串引号不能在f-字符串的表达式组件中重复使用，这使得不可能任意嵌套f-字符串。事实上，这是可以编写的嵌套最多的f-字符串：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="s1">&#39;</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
<span class="go">&#39;2&#39;</span>
</pre></div>
</div>
<p>由于现在f-字符串可以在表达式组件中包含任何有效的Python表达式，因此现在可以任意嵌套f-字符串：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="go">&#39;2&#39;</span>
</pre></div>
</div>
</li>
<li><p>多行表达式和注释：在 Python 3.11 中，f-字符串表达式必须在一行中完成定义，即使 f-字符串中的表达式在正常情况下可以跨多行（如在多行中定义的列表字面值），这使得它们更难被读懂。 在 Python 3.12 中，你现在可以定义跨越多行的 f-字符串并添加内联注释：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f&quot;This is the playlist: {&quot;, &quot;.join([
...     &#39;Take me back to Eden&#39;,  # My, my, those eyes like fire
...     &#39;Alkaline&#39;,              # Not acid nor alkaline
...     &#39;Ascensionism&#39;           # Take to the broken skies at last
... ])}&quot;
&#39;This is the playlist: Take me back to Eden, Alkaline, Ascensionism&#39;
</pre></div>
</div>
</li>
<li><p>反斜杠和 unicode 字符：在 Python 3.12 之前，f-字符串表达式不能包含任何 <code class="docutils literal notranslate"><span class="pre">\</span></code> 字符。 这也影响了 unicode <a class="reference internal" href="../reference/lexical_analysis.xhtml#escape-sequences"><span class="std std-ref">转义序列</span></a> (如 <code class="docutils literal notranslate"><span class="pre">\N{snowman}</span></code>)，因为这些序列包含 <code class="docutils literal notranslate"><span class="pre">\N</span></code> 部分，而这部分以前不能作为 f-字符串表达式组件的一部分。 现在，你可以这样定义表达式：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This is the playlist: </span><span class="si">{</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">songs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">This is the playlist: Take me back to Eden</span>
<span class="go">Alkaline</span>
<span class="go">Ascensionism</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This is the playlist: </span><span class="si">{</span><span class="s2">&quot;</span><span class="se">\N{BLACK HEART SUIT}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">songs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">This is the playlist: Take me back to Eden♥Alkaline♥Ascensionism</span>
</pre></div>
</div>
</li>
</ul>
<p>更多细节请参见 <span class="target" id="index-105"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span>。</p>
<p>实现此特性的一个正面的附带影响是（通过使用 <span class="target" id="index-106"></span><a class="pep reference external" href="https://peps.python.org/pep-0617/"><strong>PEG 解析器</strong></a><span class="link-target"> [https://peps.python.org/pep-0617/]</span> 来解析 f-字符串），现在 f-字符串的错误消息会更加精确，包括错误的确切位置。例如，在 Python 3.11 中，下面的 f-字符串将引发一个 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> ：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="p">(</span><span class="n">x</span> <span class="n">z</span> <span class="n">y</span><span class="p">)</span>
<span class="w">     </span><span class="pm">^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">f-string: invalid syntax. Perhaps you forgot a comma?</span>
</pre></div>
</div>
<p>但是错误消息不包括错误在行中的确切位置，而且表达式被人为地用括号括起来。在Python 3.12中，由于f-字符串是用PEG解析器解析的，因此错误消息可以更精确，并显示整行：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="n">my_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                   </span><span class="pm">^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">invalid syntax. Perhaps you forgot a comma?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo、Batuhan Taskaya、 Lysandros Nikolaou、Cristián Maureira-Fredes 和 Marta Gómez 在 <a class="reference external" href="https://github.com/python/cpython/issues/102856">gh-102856</a><span class="link-target"> [https://github.com/python/cpython/issues/102856]</span> 中贡献。 PEP 由 Pablo Galindo、 Batuhan Taskaya、 Lysandros Nikolaou 和 Marta Gómez 撰写）。</p>
</section>
<section id="pep-684-a-per-interpreter-gil">
<span id="whatsnew312-pep684"></span><h3>PEP 684: 每解释器 GIL</h3>
<p><span class="target" id="index-107"></span><a class="pep reference external" href="https://peps.python.org/pep-0684/"><strong>PEP 684</strong></a><span class="link-target"> [https://peps.python.org/pep-0684/]</span> 引入了每解释器 <a class="reference internal" href="../glossary.xhtml#term-global-interpreter-lock"><span class="xref std std-term">GIL</span></a>，使得现在可以创建带有单独的每解释器 GIL 的子解释器。 这将允许 Python 程序充分利用多个 CPU 核心。 此特性目前仅能通过 C-API 使用，不过相应的 Python API <span class="target" id="index-108"></span><a class="pep reference external" href="https://peps.python.org/pep-0554/"><strong>预计将在 3.13 中添加</strong></a><span class="link-target"> [https://peps.python.org/pep-0554/]</span>。</p>
<p>使用新的 <a class="reference internal" href="../c-api/init.xhtml#c.Py_NewInterpreterFromConfig" title="Py_NewInterpreterFromConfig"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_NewInterpreterFromConfig()</span></code></a> 函数来创建具有单独 GIL 的解释器：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PyInterpreterConfig</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">check_multi_interp_extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">gil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyInterpreterConfig_OWN_GIL</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">PyThreadState</span><span class="w"> </span><span class="o">*</span><span class="n">tstate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="n">PyStatus</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Py_NewInterpreterFromConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tstate</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PyStatus_Exception</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* The new interpreter is now active in the current thread. */</span>
</pre></div>
</div>
<p>有关如何将 C-API 用于具有每解释器 GIL 的子解释器的更多示例，请参见 <a class="reference external" href="https://github.com/python/cpython/tree/3.12/Modules/_xxsubinterpretersmodule.c">Modules/_xxsubinterpretersmodule.c</a><span class="link-target"> [https://github.com/python/cpython/tree/3.12/Modules/_xxsubinterpretersmodule.c]</span>。</p>
<p>（由 Eric Snow 在 <a class="reference external" href="https://github.com/python/cpython/issues/104210">gh-104210</a><span class="link-target"> [https://github.com/python/cpython/issues/104210]</span> 等中贡献。）</p>
</section>
<section id="pep-669-low-impact-monitoring-for-cpython">
<span id="whatsnew312-pep669"></span><h3>PEP 669：针对 CPython 的低影响监控</h3>
<p><span class="target" id="index-109"></span><a class="pep reference external" href="https://peps.python.org/pep-0669/"><strong>PEP 669</strong></a><span class="link-target"> [https://peps.python.org/pep-0669/]</span> 定义了一个新的 <a class="reference internal" href="../library/sys.monitoring.xhtml#module-sys.monitoring" title="sys.monitoring: Access and control event monitoring"><code class="xref py py-mod docutils literal notranslate"><span class="pre">API</span></code></a> 用于性能分析器、调试器和其他在 CPython 中监控事件的工具。 它覆盖了大范围的事件，包括调用、返回、行、异常、跳转等等。 这意味着你将只为你所使用的东西付出开销，提供了对近乎零开销的调试器和覆盖工具的支持。 请参阅  <a class="reference internal" href="../library/sys.monitoring.xhtml#module-sys.monitoring" title="sys.monitoring: Access and control event monitoring"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys.monitoring</span></code></a> 了解详情。</p>
<p>（由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/103082">gh-103082</a><span class="link-target"> [https://github.com/python/cpython/issues/103082]</span> 中贡献。）</p>
</section>
<section id="pep-688-making-the-buffer-protocol-accessible-in-python">
<span id="whatsnew312-pep688"></span><h3>PEP 688: 使缓冲区协议在Python中可访问</h3>
<p><span class="target" id="index-110"></span><a class="pep reference external" href="https://peps.python.org/pep-0688/"><strong>PEP 688</strong></a><span class="link-target"> [https://peps.python.org/pep-0688/]</span> 引入了一种在 Python 代码中使用 <a class="reference internal" href="../c-api/buffer.xhtml#bufferobjects"><span class="std std-ref">缓冲区协议</span></a> 的方法。实现 <a class="reference internal" href="../reference/datamodel.xhtml#object.__buffer__" title="object.__buffer__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__buffer__()</span></code></a> 方法的类现在可以作为缓冲区类型使用。</p>
<p>新的 <a class="reference internal" href="../library/collections.abc.xhtml#collections.abc.Buffer" title="collections.abc.Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Buffer</span></code></a> ABC（抽象基类）提供了一种表示缓冲区对象的标准方法，例如在类型注释中。 新的 <a class="reference internal" href="../library/inspect.xhtml#inspect.BufferFlags" title="inspect.BufferFlags"><code class="xref py py-class docutils literal notranslate"><span class="pre">inspect.BufferFlags</span></code></a> 枚举表示可用于自定义缓冲区创建的标志。 （由 Jelle Zijlstra 在 <a class="reference external" href="https://github.com/python/cpython/issues/102500">gh-102500</a><span class="link-target"> [https://github.com/python/cpython/issues/102500]</span> 中贡献。）</p>
</section>
<section id="pep-709-comprehension-inlining">
<span id="whatsnew312-pep709"></span><h3>PEP 709：推导式内联</h3>
<p>字典、列表和集合推导式现在都是内联的，而不是为每次执行推导式都创建一个新的一次性函数对象。 这样可以将推导式的执行速度提高最多两倍。 更多细节请参阅 <span class="target" id="index-111"></span><a class="pep reference external" href="https://peps.python.org/pep-0709/"><strong>PEP 709</strong></a><span class="link-target"> [https://peps.python.org/pep-0709/]</span>。</p>
<p>推导式迭代变量将保持隔离而不会覆盖外作用域中的同名变量，在离开推导式后也不再可见。 内联确实会导致一些可见的行为变化：</p>
<ul class="simple">
<li><p>回溯中的推导式不再有单独的帧，跟踪/评测也不再将推导式显示为函数调用。</p></li>
<li><p><a class="reference internal" href="../library/symtable.xhtml#module-symtable" title="symtable: Interface to the compiler's internal symbol tables."><code class="xref py py-mod docutils literal notranslate"><span class="pre">symtable</span></code></a> 模块将不再为每个推导式产生子符号表；取而代之的是，推导式的 locals 将包括在父函数的符号表中。</p></li>
<li><p>在推导式内部调用 <a class="reference internal" href="../library/functions.xhtml#locals" title="locals"><code class="xref py py-func docutils literal notranslate"><span class="pre">locals()</span></code></a> 现在包括该推导式外部外部的变量，而不再包括推导式“参数”导致的 <code class="docutils literal notranslate"><span class="pre">.0</span></code> 合成变量。</p></li>
<li><p>一个直接迭代 <code class="docutils literal notranslate"><span class="pre">locals()</span></code> 的推导式 (例如 <code class="docutils literal notranslate"><span class="pre">[k</span> <span class="pre">for</span> <span class="pre">k</span> <span class="pre">in</span> <span class="pre">locals()]</span></code>) 在启动追踪 (例如检测代码覆盖度) 的情况下运行时可能导致 &quot;RuntimeError: dictionary changed size during iteration&quot;。 此行为与现有的 <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">k</span> <span class="pre">in</span> <span class="pre">locals():</span></code> 等代码保持一致。 要避免此错误，可先创建一个由键组成的列表用于迭代: <code class="docutils literal notranslate"><span class="pre">keys</span> <span class="pre">=</span> <span class="pre">list(locals());</span> <span class="pre">[k</span> <span class="pre">for</span> <span class="pre">k</span> <span class="pre">in</span> <span class="pre">keys]</span></code>。</p></li>
</ul>
<p>（由 Carl Meyer 和 Vladimir Matveev 在 <span class="target" id="index-112"></span><a class="pep reference external" href="https://peps.python.org/pep-0709/"><strong>PEP 709</strong></a><span class="link-target"> [https://peps.python.org/pep-0709/]</span> 中贡献。）</p>
</section>
<section id="improved-error-messages">
<h3>改进的错误消息</h3>
<ul>
<li><p>当引发的 <a class="reference internal" href="../library/exceptions.xhtml#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a> 传播到最高层级时，解释器显示的错误消息可能将标准库中的模块作为建议的一部分。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/98254">gh-98254</a><span class="link-target"> [https://github.com/python/cpython/issues/98254]</span> 中贡献。）</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">NameError</span>: <span class="n">name &#39;sys&#39; is not defined. Did you forget to import &#39;sys&#39;?</span>
</pre></div>
</div>
</li>
<li><p>改进针对实例的 <a class="reference internal" href="../library/exceptions.xhtml#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a> 异常的错误建议。 现在如果在方法中引发了 <a class="reference internal" href="../library/exceptions.xhtml#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a> 而实例具有与异常中的名称完全相同的属性，建议将会包括 <code class="docutils literal notranslate"><span class="pre">self.&lt;NAME&gt;</span></code> 而不是方法作用域中最接近的匹配项。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/99139">gh-99139</a><span class="link-target"> [https://github.com/python/cpython/issues/99139]</span> 中贡献。）</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>       <span class="bp">self</span><span class="o">.</span><span class="n">blech</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">...</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>       <span class="n">somethin</span> <span class="o">=</span> <span class="n">blech</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="n">somethin</span> <span class="o">=</span> <span class="n">blech</span>
<span class="w">               </span><span class="pm">^^^^^</span>
<span class="gr">NameError</span>: <span class="n">name &#39;blech&#39; is not defined. Did you mean: &#39;self.blech&#39;?</span>
</pre></div>
</div>
</li>
<li><p>改进了当用户输入 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">x</span> <span class="pre">from</span> <span class="pre">y</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">y</span> <span class="pre">import</span> <span class="pre">x</span></code> 时产生的 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 错误消息。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/98931">gh-98931</a><span class="link-target"> [https://github.com/python/cpython/issues/98931]</span> 中贡献。）</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">a.y.z</span> <span class="kn">from</span> <span class="nn">b.y.z</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="kn">import</span> <span class="nn">a.y.z</span> <span class="kn">from</span> <span class="nn">b.y.z</span>
<span class="w">    </span><span class="pm">^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">Did you mean to use &#39;from ... import ...&#39; instead?</span>
</pre></div>
</div>
</li>
<li><p>由失败的 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">&lt;module&gt;</span> <span class="pre">import</span> <span class="pre">&lt;name&gt;</span></code> 语句引发的 <a class="reference internal" href="../library/exceptions.xhtml#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> 异常现在会包括根据 <code class="docutils literal notranslate"><span class="pre">&lt;module&gt;</span></code> 中的可用名称对 <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> 的值提出的建议。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/91058">gh-91058</a><span class="link-target"> [https://github.com/python/cpython/issues/91058]</span> 中贡献。）</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">chainmap</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">ImportError</span>: <span class="n">cannot import name &#39;chainmap&#39; from &#39;collections&#39;. Did you mean: &#39;ChainMap&#39;?</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="new-features-related-to-type-hints">
<h2>有关类型提示的新增特性</h2>
<p>本节介绍了影响 <span class="target" id="index-113"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>类型提示</strong></a><span class="link-target"> [https://peps.python.org/pep-0484/]</span> 和 <a class="reference internal" href="../library/typing.xhtml#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块的主要更改。</p>
<section id="pep-692-using-typeddict-for-more-precise-kwargs-typing">
<span id="whatsnew312-pep692"></span><h3>PEP 692: 使用 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 进行更精确的 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 类型标注</h3>
<p>在函数签名中的 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 类型标注（由 <span class="target" id="index-114"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a><span class="link-target"> [https://peps.python.org/pep-0484/]</span> 引入）只允许在所有 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 都属于同一类型的情况下进行有效标注。</p>
<p><span class="target" id="index-115"></span><a class="pep reference external" href="https://peps.python.org/pep-0692/"><strong>PEP 692</strong></a><span class="link-target"> [https://peps.python.org/pep-0692/]</span> 通过依赖类型化的字典规定了一种更精确的针对 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 的类型标注方式:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">Unpack</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
  <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">Movie</span><span class="p">]):</span> <span class="o">...</span>
</pre></div>
</div>
<p>更多细节请参见 <span class="target" id="index-116"></span><a class="pep reference external" href="https://peps.python.org/pep-0692/"><strong>PEP 692</strong></a><span class="link-target"> [https://peps.python.org/pep-0692/]</span>。</p>
<p>（由 Franek Magiera 在 <a class="reference external" href="https://github.com/python/cpython/issues/103629">gh-103629</a><span class="link-target"> [https://github.com/python/cpython/issues/103629]</span> 中贡献。）</p>
</section>
<section id="pep-698-override-decorator-for-static-typing">
<span id="whatsnew312-pep698"></span><h3>PEP 698：覆盖静态类型的装饰器</h3>
<p>一个新的装饰器 <a class="reference internal" href="../library/typing.xhtml#typing.override" title="typing.override"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.override()</span></code></a> 已添加到 <a class="reference internal" href="../library/typing.xhtml#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块中。 它向类型检查器指示该方法旨在重写超类中的方法。 这允许类型检查器在打算重写基类中的某个方法实际上没有重写的情况下捕获错误。</p>
<p>示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">override</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;blue&quot;</span>

<span class="k">class</span> <span class="nc">GoodChild</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
  <span class="nd">@override</span>  <span class="c1"># ok: overrides Base.get_color</span>
  <span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;yellow&quot;</span>

<span class="k">class</span> <span class="nc">BadChild</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
  <span class="nd">@override</span>  <span class="c1"># type checker error: does not override Base.get_color</span>
  <span class="k">def</span> <span class="nf">get_colour</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;red&quot;</span>
</pre></div>
</div>
<p>更多细节参见 <span class="target" id="index-117"></span><a class="pep reference external" href="https://peps.python.org/pep-0698/"><strong>PEP 698</strong></a><span class="link-target"> [https://peps.python.org/pep-0698/]</span>。</p>
<p>（由 Steven Troxler 在 <a class="reference external" href="https://github.com/python/cpython/issues/101561">gh-101561</a><span class="link-target"> [https://github.com/python/cpython/issues/101561]</span> 中贡献。）</p>
</section>
</section>
<section id="other-language-changes">
<h2>其他语言特性修改</h2>
<ul class="simple">
<li><p>解析器现在在解析包含空字节的源代码时引发 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/96670">gh-96670</a><span class="link-target"> [https://github.com/python/cpython/issues/96670]</span> 中贡献 。）</p></li>
<li><p>不是有效转义序列的反斜杠加字符组合现在会生成 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxWarning" title="SyntaxWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxWarning</span></code></a>，而不是 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 例如，<code class="docutils literal notranslate"><span class="pre">re.compile(&quot;\d+\.\d+&quot;)</span></code> 现在会发出 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxWarning" title="SyntaxWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxWarning</span></code></a> (<code class="docutils literal notranslate"><span class="pre">&quot;\d&quot;</span></code> 是一个无效的转义序列，请使用原始字符串来表示正则表达式: <code class="docutils literal notranslate"><span class="pre">re.compile(r&quot;\d+\.\d+&quot;)</span></code>)。 在未来的 Python 版本中，最终将引发 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>，而不是 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxWarning" title="SyntaxWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxWarning</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/98401">gh-98401</a><span class="link-target"> [https://github.com/python/cpython/issues/98401]</span> 中贡献。）</p></li>
<li><p>值大于 <code class="docutils literal notranslate"><span class="pre">0o377</span></code> (例如: <code class="docutils literal notranslate"><span class="pre">&quot;\477&quot;</span></code>) 的八进制转义序列，在 Python 3.11 中已弃用，现在会产生 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxWarning" title="SyntaxWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxWarning</span></code></a>，而不是 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 在未来的 Python 版本中，它们最终将是 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/98401">gh-98401</a><span class="link-target"> [https://github.com/python/cpython/issues/98401]</span> 中贡献。）</p></li>
<li><p>未存储在推导式目标部分中的变量现在可以在赋值表达式 (<code class="docutils literal notranslate"><span class="pre">:=</span></code>) 中使用。 例如，在 <code class="docutils literal notranslate"><span class="pre">[(b</span> <span class="pre">:=</span> <span class="pre">1)</span> <span class="pre">for</span> <span class="pre">a,</span> <span class="pre">b.prop</span> <span class="pre">in</span> <span class="pre">some_iter]</span></code> 中，现在允许对 <code class="docutils literal notranslate"><span class="pre">b</span></code> 进行赋值。 请注意，根据 <span class="target" id="index-118"></span><a class="pep reference external" href="https://peps.python.org/pep-0572/"><strong>PEP 572</strong></a><span class="link-target"> [https://peps.python.org/pep-0572/]</span>，仍然不允许向存储在推导式目标部分中的变量 (如 <code class="docutils literal notranslate"><span class="pre">a</span></code>) 赋值。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/100581">gh-100581</a><span class="link-target"> [https://github.com/python/cpython/issues/100581]</span> 中贡献。）</p></li>
<li><p>在类或类型对象的 <code class="docutils literal notranslate"><span class="pre">__set_name__</span></code> 方法中引发的异常不再由 <a class="reference internal" href="../library/exceptions.xhtml#RuntimeError" title="RuntimeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> 来包装。 上下文信息将作为 <span class="target" id="index-119"></span><a class="pep reference external" href="https://peps.python.org/pep-0678/"><strong>PEP 678</strong></a><span class="link-target"> [https://peps.python.org/pep-0678/]</span> 注释添加到异常中。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/77757">gh-77757</a><span class="link-target"> [https://github.com/python/cpython/issues/77757]</span> 中贡献。）</p></li>
<li><p>当 <code class="docutils literal notranslate"><span class="pre">try-except*</span></code> 构造处理整个 <a class="reference internal" href="../library/exceptions.xhtml#ExceptionGroup" title="ExceptionGroup"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ExceptionGroup</span></code></a> 并引发另一个异常时，该异常不再封装在 <a class="reference internal" href="../library/exceptions.xhtml#ExceptionGroup" title="ExceptionGroup"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ExceptionGroup</span></code></a> 中。 在 3.11.4 版中也进行了更改。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/103590">gh-103590</a><span class="link-target"> [https://github.com/python/cpython/issues/103590]</span> 中贡献。）</p></li>
<li><p>垃圾回收器现在只在 Python 字节码评估循环的 eval-breaker 机制上运行，而不是在对象分配上运行。 垃圾回收也可以在调用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_CheckSignals" title="PyErr_CheckSignals"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_CheckSignals()</span></code></a> 时运行，因此需要长时间运行而不执行任何 Python 代码的 C 扩展也有机会定期执行垃圾回收。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/97922">gh-97922</a><span class="link-target"> [https://github.com/python/cpython/issues/97922]</span> 中贡献。）</p></li>
<li><p>所有期望布尔参数的内置和扩展可调用函数现在都接受任何类型的参数，而不仅仅是 <a class="reference internal" href="../library/functions.xhtml#bool" title="bool"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> 和 <a class="reference internal" href="../library/functions.xhtml#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/60203">gh-60203</a><span class="link-target"> [https://github.com/python/cpython/issues/60203]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/stdtypes.xhtml#memoryview" title="memoryview"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> 现在支持半精度浮点类型（&quot;e&quot; 格式代码）。 （由 Donghee Na 和 Antoine Pitrou 在 <a class="reference external" href="https://github.com/python/cpython/issues/90751">gh-90751</a><span class="link-target"> [https://github.com/python/cpython/issues/90751]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/functions.xhtml#slice" title="slice"><code class="xref py py-class docutils literal notranslate"><span class="pre">slice</span></code></a> 对象现在是可哈希的，允许它们用作字典的键和集合项。 （由 Will Bradshaw、Furkan Onder 和 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/101264">gh-101264</a><span class="link-target"> [https://github.com/python/cpython/issues/101264]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/functions.xhtml#sum" title="sum"><code class="xref py py-func docutils literal notranslate"><span class="pre">sum()</span></code></a> 现在使用 Neumaier 求和算法以改善对浮点数或混合了整数和浮点数时求和运算的准确性和可换算性。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/100425">gh-100425</a><span class="link-target"> [https://github.com/python/cpython/issues/100425]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/ast.xhtml#ast.parse" title="ast.parse"><code class="xref py py-func docutils literal notranslate"><span class="pre">ast.parse()</span></code></a> 现在会在解析包含空字节的源代码时引发 <a class="reference internal" href="../library/exceptions.xhtml#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 而不是 <a class="reference internal" href="../library/exceptions.xhtml#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/96670">gh-96670</a><span class="link-target"> [https://github.com/python/cpython/issues/96670]</span> 中贡献 。）</p></li>
<li><p><a class="reference internal" href="../library/tarfile.xhtml#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> 中的提取方法和 <a class="reference internal" href="../library/shutil.xhtml#shutil.unpack_archive" title="shutil.unpack_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.unpack_archive()</span></code></a> 有一个新的 <em>filter</em> 参数，它允许限制可能令人惊讶或危险的 tar 功能，例如在目标目录之外创建文件。 相关细节请参阅 <a class="reference internal" href="../library/tarfile.xhtml#tarfile-extraction-filter"><span class="std std-ref">tarfile 提取过滤器</span></a>。 在 Python 3.14 中。默认值将切换为 <code class="docutils literal notranslate"><span class="pre">'data'</span></code>。 （由 Petr Viktorin 在 <span class="target" id="index-120"></span><a class="pep reference external" href="https://peps.python.org/pep-0706/"><strong>PEP 706</strong></a><span class="link-target"> [https://peps.python.org/pep-0706/]</span> 中贡献。）</p></li>
<li><p>如果底层映射是可哈希的，那么 <a class="reference internal" href="../library/types.xhtml#types.MappingProxyType" title="types.MappingProxyType"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.MappingProxyType</span></code></a> 实例现在是可哈希的。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/87995">gh-87995</a><span class="link-target"> [https://github.com/python/cpython/issues/87995]</span> 中贡献。）</p></li>
<li><p>通过新的环境变量 <span class="target" id="index-121"></span><a class="reference internal" href="../using/cmdline.xhtml#envvar-PYTHONPERFSUPPORT"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPERFSUPPORT</span></code></a> 和命令行选项 <a class="reference internal" href="../using/cmdline.xhtml#cmdoption-X"><code class="xref std std-option docutils literal notranslate"><span class="pre">-X</span> <span class="pre">perf</span></code></a> 以及新的 <a class="reference internal" href="../library/sys.xhtml#sys.activate_stack_trampoline" title="sys.activate_stack_trampoline"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.activate_stack_trampoline()</span></code></a>, <a class="reference internal" href="../library/sys.xhtml#sys.deactivate_stack_trampoline" title="sys.deactivate_stack_trampoline"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.deactivate_stack_trampoline()</span></code></a> 和 <a class="reference internal" href="../library/sys.xhtml#sys.is_stack_trampoline_active" title="sys.is_stack_trampoline_active"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.is_stack_trampoline_active()</span></code></a> 函数添加了对 <a class="reference internal" href="../howto/perf_profiling.xhtml#perf-profiling"><span class="std std-ref">perf 性能分析器的支持</span></a>。 （由 Pablo Galindo 设计。 由 Pablo Galindo 和 Christian Heimes 在 <a class="reference external" href="https://github.com/python/cpython/issues/96123">gh-96123</a><span class="link-target"> [https://github.com/python/cpython/issues/96123]</span> 中贡献并包含来自 Gregory P. Smith [Google] 和 Mark Shannon 的帮助。）</p></li>
</ul>
</section>
<section id="new-modules">
<h2>新增模块</h2>
<ul class="simple">
<li><p>无。</p></li>
</ul>
</section>
<section id="improved-modules">
<h2>改进的模块</h2>
<section id="array">
<h3>array</h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/array.xhtml#array.array" title="array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array.array</span></code></a> 类现在支持下标，使其成为 <a class="reference internal" href="../glossary.xhtml#term-generic-type"><span class="xref std std-term">generic type</span></a>。 （由 Jelle Zijlstra 在 <a class="reference external" href="https://github.com/python/cpython/issues/98658">gh-98658</a><span class="link-target"> [https://github.com/python/cpython/issues/98658]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="asyncio">
<h3>asyncio</h3>
<ul class="simple">
<li><p>在 <a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 中写入套接字的性能得到了显著提高。 <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> 现在可以避免在写入套接字时进行不必要的复制，并在平台支持的情况下使用 <a class="reference internal" href="../library/socket.xhtml#socket.socket.sendmsg" title="socket.socket.sendmsg"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sendmsg()</span></code></a>。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/91166">gh-91166</a><span class="link-target"> [https://github.com/python/cpython/issues/91166]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.eager_task_factory" title="asyncio.eager_task_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.eager_task_factory()</span></code></a> 和 <a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.create_eager_task_factory" title="asyncio.create_eager_task_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.create_eager_task_factory()</span></code></a> 函数以允许在主动型任务执行中选择事件循环，使某些用例的速度提升了 2 至 5 倍。 （由 Jacob Bower 和 Itamar Oren 在 <a class="reference external" href="https://github.com/python/cpython/issues/102853">gh-102853</a><span class="link-target"> [https://github.com/python/cpython/issues/102853]</span>, <a class="reference external" href="https://github.com/python/cpython/issues/104140">gh-104140</a><span class="link-target"> [https://github.com/python/cpython/issues/104140]</span> 和 <a class="reference external" href="https://github.com/python/cpython/issues/104138">gh-104138</a><span class="link-target"> [https://github.com/python/cpython/issues/104138]</span> 中贡献。）</p></li>
<li><p>在 Linux 上，如果 <a class="reference internal" href="../library/os.xhtml#os.pidfd_open" title="os.pidfd_open"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.pidfd_open()</span></code></a> 可用且能工作则 <a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 默认会使用 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.PidfdChildWatcher" title="asyncio.PidfdChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.PidfdChildWatcher</span></code></a> 而不是 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.ThreadedChildWatcher" title="asyncio.ThreadedChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.ThreadedChildWatcher</span></code></a>。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/98024">gh-98024</a><span class="link-target"> [https://github.com/python/cpython/issues/98024]</span> 中贡献。）</p></li>
<li><p>现在事件循环会针对每个平台使用最佳的可用子监视器 (在受支持的情况下使用 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.PidfdChildWatcher" title="asyncio.PidfdChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.PidfdChildWatcher</span></code></a>，否则使用 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.ThreadedChildWatcher" title="asyncio.ThreadedChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.ThreadedChildWatcher</span></code></a>)，因此不建议手动配置子监视器。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/94597">gh-94597</a><span class="link-target"> [https://github.com/python/cpython/issues/94597]</span> 中贡献。）</p></li>
<li><p>为 <a class="reference internal" href="../library/asyncio-runner.xhtml#asyncio.run" title="asyncio.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.run()</span></code></a> 添加了形参 <em>loop_factory</em>，以允许指定自定义事件循环工厂。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/99388">gh-99388</a><span class="link-target"> [https://github.com/python/cpython/issues/99388]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.current_task" title="asyncio.current_task"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.current_task()</span></code></a> 的 C 实现以实现 4 - 6 倍的加速。 （由 Itamar Oren 和 Pranav Thulasiram Bhat 在 <a class="reference external" href="https://github.com/python/cpython/issues/100344">gh-100344</a><span class="link-target"> [https://github.com/python/cpython/issues/100344]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.iscoroutine" title="asyncio.iscoroutine"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.iscoroutine()</span></code></a> 现在为生成器返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>，因为 <a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 不支持传统的基于生成器的协程。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/102748">gh-102748</a><span class="link-target"> [https://github.com/python/cpython/issues/102748]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.wait" title="asyncio.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.wait()</span></code></a> 和 <a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.as_completed" title="asyncio.as_completed"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.as_completed()</span></code></a> 现在接受生成器 yield 任务。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/78530">gh-78530</a><span class="link-target"> [https://github.com/python/cpython/issues/78530]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="calendar">
<h3>calendar</h3>
<ul class="simple">
<li><p>添加了枚举 <a class="reference internal" href="../library/calendar.xhtml#calendar.Month" title="calendar.Month"><code class="xref py py-data docutils literal notranslate"><span class="pre">calendar.Month</span></code></a> 和 <a class="reference internal" href="../library/calendar.xhtml#calendar.Day" title="calendar.Day"><code class="xref py py-data docutils literal notranslate"><span class="pre">calendar.Day</span></code></a> 来定义年份中的每一月和星期中的每一日。 （由 Prince Roshan 在 <a class="reference external" href="https://github.com/python/cpython/issues/103636">gh-103636</a><span class="link-target"> [https://github.com/python/cpython/issues/103636]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="csv">
<h3>csv</h3>
<ul class="simple">
<li><p>增加了 <a class="reference internal" href="../library/csv.xhtml#csv.QUOTE_NOTNULL" title="csv.QUOTE_NOTNULL"><code class="xref py py-const docutils literal notranslate"><span class="pre">csv.QUOTE_NOTNULL</span></code></a> 和 <a class="reference internal" href="../library/csv.xhtml#csv.QUOTE_STRINGS" title="csv.QUOTE_STRINGS"><code class="xref py py-const docutils literal notranslate"><span class="pre">csv.QUOTE_STRINGS</span></code></a> 旗标以通过 <a class="reference internal" href="../library/csv.xhtml#csv.writer" title="csv.writer"><code class="xref py py-class docutils literal notranslate"><span class="pre">csv.writer</span></code></a> 对象来提供对 <code class="docutils literal notranslate"><span class="pre">None</span></code> 和空字符串的更细粒度控制。</p></li>
</ul>
</section>
<section id="dis">
<h3>dis</h3>
<ul class="simple">
<li><p>伪指令操作码（由编译器使用但不会出现在可执行字节码中）现在将暴露在 <a class="reference internal" href="../library/dis.xhtml#module-dis" title="dis: Disassembler for Python bytecode."><code class="xref py py-mod docutils literal notranslate"><span class="pre">dis</span></code></a> 模块中。 <a class="reference internal" href="../library/dis.xhtml#opcode-HAVE_ARGUMENT"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">HAVE_ARGUMENT</span></code></a> 仍然与实际的操作码相关，但对伪指令来说没有用处。 请改用新的 <a class="reference internal" href="../library/dis.xhtml#dis.hasarg" title="dis.hasarg"><code class="xref py py-data docutils literal notranslate"><span class="pre">dis.hasarg</span></code></a> 多项集。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/94216">gh-94216</a><span class="link-target"> [https://github.com/python/cpython/issues/94216]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#dis.hasexc" title="dis.hasexc"><code class="xref py py-data docutils literal notranslate"><span class="pre">dis.hasexc</span></code></a> 多项集来表示设置异常处理器的指令。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/94216">gh-94216</a><span class="link-target"> [https://github.com/python/cpython/issues/94216]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="fractions">
<h3>fractions</h3>
<ul class="simple">
<li><p>类型为 <a class="reference internal" href="../library/fractions.xhtml#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">fractions.Fraction</span></code></a> 的对象现在支持浮点格式。 （由 Mark Dickinson 在 <a class="reference external" href="https://github.com/python/cpython/issues/100161">gh-100161</a><span class="link-target"> [https://github.com/python/cpython/issues/100161]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="importlib-resources">
<h3>importlib.resources</h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/importlib.resources.xhtml#importlib.resources.as_file" title="importlib.resources.as_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.resources.as_file()</span></code></a> 现在将支持资源目录。 （由 Jason R. Coombs 在 <a class="reference external" href="https://github.com/python/cpython/issues/97930">gh-97930</a><span class="link-target"> [https://github.com/python/cpython/issues/97930]</span> 中贡献。）</p></li>
<li><p>将 <a class="reference internal" href="../library/importlib.resources.xhtml#importlib.resources.files" title="importlib.resources.files"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.resources.files()</span></code></a> 的第一个形参重命名为 <em>anchor</em>。 （由 Jason R. Coombs 在 <a class="reference external" href="https://github.com/python/cpython/issues/100598">gh-100598</a><span class="link-target"> [https://github.com/python/cpython/issues/100598]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="inspect">
<h3>inspect</h3>
<ul class="simple">
<li><p>增加了 <a class="reference internal" href="../library/inspect.xhtml#inspect.markcoroutinefunction" title="inspect.markcoroutinefunction"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.markcoroutinefunction()</span></code></a> 来标记返回 <a class="reference internal" href="../glossary.xhtml#term-coroutine"><span class="xref std std-term">coroutine</span></a> 的同步函数以便与 <a class="reference internal" href="../library/inspect.xhtml#inspect.iscoroutinefunction" title="inspect.iscoroutinefunction"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.iscoroutinefunction()</span></code></a> 一起使用。 （由 Carlton Gibson 在 <a class="reference external" href="https://github.com/python/cpython/issues/99247">gh-99247</a><span class="link-target"> [https://github.com/python/cpython/issues/99247]</span> 中贡献。）</p></li>
<li><p>添加 <a class="reference internal" href="../library/inspect.xhtml#inspect.getasyncgenstate" title="inspect.getasyncgenstate"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.getasyncgenstate()</span></code></a> 和 <a class="reference internal" href="../library/inspect.xhtml#inspect.getasyncgenlocals" title="inspect.getasyncgenlocals"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.getasyncgenlocals()</span></code></a> 用来确定异步发生器的当前状态。 （由 Thomas Krennwallner 在 <a class="reference external" href="https://github.com/python/cpython/issues/79940">gh-79940</a><span class="link-target"> [https://github.com/python/cpython/issues/79940]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/inspect.xhtml#inspect.getattr_static" title="inspect.getattr_static"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.getattr_static()</span></code></a> 的性能已得到显著提升。 对该函数的大多数调用相比 Python 3.11 至少应有 2 倍的加速。 （由 Alex Waygood 在 <a class="reference external" href="https://github.com/python/cpython/issues/103193">gh-103193</a><span class="link-target"> [https://github.com/python/cpython/issues/103193]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="itertools">
<h3>itertools</h3>
<ul class="simple">
<li><p>增加了 <a class="reference internal" href="../library/itertools.xhtml#itertools.batched" title="itertools.batched"><code class="xref py py-class docutils literal notranslate"><span class="pre">itertools.batched()</span></code></a> 用来将数据收集为相同大小的元组，其中最后一个批次的长度可能会比其他批次的短。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/98363">gh-98363</a><span class="link-target"> [https://github.com/python/cpython/issues/98363]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="math">
<h3>math</h3>
<ul class="simple">
<li><p>添加了 <a class="reference internal" href="../library/math.xhtml#math.sumprod" title="math.sumprod"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.sumprod()</span></code></a> 用于计算乘积之和。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/100485">gh-100485</a><span class="link-target"> [https://github.com/python/cpython/issues/100485]</span> 中贡献。）</p></li>
<li><p>扩展了 <a class="reference internal" href="../library/math.xhtml#math.nextafter" title="math.nextafter"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.nextafter()</span></code></a> 以包括一个 <em>steps</em> 参数用于一次性向上或向下移动多步。 （由 Matthias Goergens, Mark Dickinson 和 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/94906">gh-94906</a><span class="link-target"> [https://github.com/python/cpython/issues/94906]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="os">
<h3>os</h3>
<ul class="simple">
<li><p>增加了 <a class="reference internal" href="../library/os.xhtml#os.PIDFD_NONBLOCK" title="os.PIDFD_NONBLOCK"><code class="xref py py-const docutils literal notranslate"><span class="pre">os.PIDFD_NONBLOCK</span></code></a> 以在非阻塞模式下打开具有 <a class="reference internal" href="../library/os.xhtml#os.pidfd_open" title="os.pidfd_open"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.pidfd_open()</span></code></a> 的进程的文件描述符。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/93312">gh-93312</a><span class="link-target"> [https://github.com/python/cpython/issues/93312]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/os.xhtml#os.DirEntry" title="os.DirEntry"><code class="xref py py-class docutils literal notranslate"><span class="pre">os.DirEntry</span></code></a> 现在包括一个 <a class="reference internal" href="../library/os.xhtml#os.DirEntry.is_junction" title="os.DirEntry.is_junction"><code class="xref py py-meth docutils literal notranslate"><span class="pre">os.DirEntry.is_junction()</span></code></a> 方法来检查该条目是否为目录联接。 （由 Charles Machalow 在 <a class="reference external" href="https://github.com/python/cpython/issues/99547">gh-99547</a><span class="link-target"> [https://github.com/python/cpython/issues/99547]</span> 中贡献。）</p></li>
<li><p>在 Windows 版中添加 <a class="reference internal" href="../library/os.xhtml#os.listdrives" title="os.listdrives"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.listdrives()</span></code></a>、<a class="reference internal" href="../library/os.xhtml#os.listvolumes" title="os.listvolumes"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.listvolumes()</span></code></a> 和 <a class="reference internal" href="../library/os.xhtml#os.listmounts" title="os.listmounts"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.listmounts()</span></code></a> 函数，用于枚举驱动器、卷和挂载点。 （由 Steve Dower 在 <a class="reference external" href="https://github.com/python/cpython/issues/102519">gh-102519</a><span class="link-target"> [https://github.com/python/cpython/issues/102519]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/os.xhtml#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.stat()</span></code></a> 和 <a class="reference internal" href="../library/os.xhtml#os.lstat" title="os.lstat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.lstat()</span></code></a> 现在在 Windows 系统上更准确了。 <code class="docutils literal notranslate"><span class="pre">st_birthtime</span></code> 字段现在将使用文件的创建时间，<code class="docutils literal notranslate"><span class="pre">st_ctime</span></code> 已弃用，但仍包含创建时间（但为了与其他平台保持一致，将来将返回最后一次元数据更改时间）。 <code class="docutils literal notranslate"><span class="pre">st_dev</span></code> 可以高达 64 位，<code class="docutils literal notranslate"><span class="pre">st_ino</span></code> 可以高达 128 位，具体取决于你的文件系统，并且 <code class="docutils literal notranslate"><span class="pre">st_rdev</span></code> 始终设置为零，而非不正确的值。 这两个函数在较新版本的 Windows 上将会明显更快。  （由 Steve Dower 在 <a class="reference external" href="https://github.com/python/cpython/issues/99726">gh-99726</a><span class="link-target"> [https://github.com/python/cpython/issues/99726]</span> 中贡献。）</p></li>
<li><p>As of 3.12.4, <a class="reference internal" href="../library/os.xhtml#os.mkdir" title="os.mkdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.mkdir()</span></code></a> and <a class="reference internal" href="../library/os.xhtml#os.makedirs" title="os.makedirs"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.makedirs()</span></code></a> on Windows
now support passing a <em>mode</em> value of <code class="docutils literal notranslate"><span class="pre">0o700</span></code> to apply access
control to the new directory. This implicitly affects
<a class="reference internal" href="../library/tempfile.xhtml#tempfile.mkdtemp" title="tempfile.mkdtemp"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.mkdtemp()</span></code></a> and is a mitigation for <a class="reference external" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4030">CVE-2024-4030</a><span class="link-target"> [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4030]</span>.
Other values for <em>mode</em> continue to be ignored.
(Contributed by Steve Dower in <a class="reference external" href="https://github.com/python/cpython/issues/118486">gh-118486</a><span class="link-target"> [https://github.com/python/cpython/issues/118486]</span>.)</p></li>
</ul>
</section>
<section id="os-path">
<h3>os.path</h3>
<ul class="simple">
<li><p>添加 <a class="reference internal" href="../library/os.path.xhtml#os.path.isjunction" title="os.path.isjunction"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.isjunction()</span></code></a> 以检查给定路径是否为目录联接。 （由 Charles Machalow 在 <a class="reference external" href="https://github.com/python/cpython/issues/99547">gh-99547</a><span class="link-target"> [https://github.com/python/cpython/issues/99547]</span> 中贡献。）</p></li>
<li><p>添加 <a class="reference internal" href="../library/os.path.xhtml#os.path.splitroot" title="os.path.splitroot"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.splitroot()</span></code></a> 以将路径拆分为三元组 <code class="docutils literal notranslate"><span class="pre">(drive,</span> <span class="pre">root,</span> <span class="pre">tail)</span></code>。（由 Barney Gale 在 <a class="reference external" href="https://github.com/python/cpython/issues/101000">gh-101000</a><span class="link-target"> [https://github.com/python/cpython/issues/101000]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="pathlib">
<h3>pathlib</h3>
<ul class="simple">
<li><p>增加对子类化 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.PurePath" title="pathlib.PurePath"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.PurePath</span></code></a> 和 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.Path" title="pathlib.Path"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>，加上它们的 Posix 和 Windows 专属变体形式的支持。 子类可以重载 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.PurePath.with_segments" title="pathlib.PurePath.with_segments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.PurePath.with_segments()</span></code></a> 方法来在路径实例之间传递信息。</p></li>
<li><p>添加 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.Path.walk" title="pathlib.Path.walk"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.walk()</span></code></a> 用于遍历目录树并生成其中的所有文件或目录名，类似于 <a class="reference internal" href="../library/os.xhtml#os.walk" title="os.walk"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.walk()</span></code></a>。 （由 Stanislav Zmiev 在 <a class="reference external" href="https://github.com/python/cpython/issues/90385">gh-90385</a><span class="link-target"> [https://github.com/python/cpython/issues/90385]</span> 中贡献。）</p></li>
<li><p>在 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.PurePath.relative_to" title="pathlib.PurePath.relative_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.PurePath.relative_to()</span></code></a> 中添加了 <em>walk_up</em> 可选形参以允许在结果中插入``..`` 条目；此行为与 <a class="reference internal" href="../library/os.path.xhtml#os.path.relpath" title="os.path.relpath"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.relpath()</span></code></a> 更为一致。（由 Domenico Ragusa 在 <a class="reference external" href="https://github.com/python/cpython/issues/84538">gh-84538</a><span class="link-target"> [https://github.com/python/cpython/issues/84538]</span> 中贡献。）</p></li>
<li><p>添加 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.Path.is_junction" title="pathlib.Path.is_junction"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.is_junction()</span></code></a> 作为 <a class="reference internal" href="../library/os.path.xhtml#os.path.isjunction" title="os.path.isjunction"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.isjunction()</span></code></a> 的代理。 （由 Charles Machalow 在 <a class="reference external" href="https://github.com/python/cpython/issues/99547">gh-99547</a><span class="link-target"> [https://github.com/python/cpython/issues/99547]</span> 中贡献。）</p></li>
<li><p>为 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.Path.glob" title="pathlib.Path.glob"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.glob()</span></code></a>、<a class="reference internal" href="../library/pathlib.xhtml#pathlib.Path.rglob" title="pathlib.Path.rglob"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.rglob()</span></code></a> 和 <a class="reference internal" href="../library/pathlib.xhtml#pathlib.PurePath.match" title="pathlib.PurePath.match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.PurePath.match()</span></code></a> 添加可选形参 <em>case_sensitive</em>，以匹配路径的大小写敏感性，从而对匹配过程进行更精确的控制。</p></li>
</ul>
</section>
<section id="pdb">
<h3>pdb</h3>
<ul class="simple">
<li><p>添加便利变量以临时保存调试会话的值，并提供对当前帧或返回值等值的快速访问。 （由高天在 <a class="reference external" href="https://github.com/python/cpython/issues/103693">gh-103693</a><span class="link-target"> [https://github.com/python/cpython/issues/103693]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="random">
<h3>random</h3>
<ul class="simple">
<li><p>添加了 <a class="reference internal" href="../library/random.xhtml#random.binomialvariate" title="random.binomialvariate"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.binomialvariate()</span></code></a>。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/81620">gh-81620</a><span class="link-target"> [https://github.com/python/cpython/issues/81620]</span> 中贡献。）</p></li>
<li><p>在 <a class="reference internal" href="../library/random.xhtml#random.expovariate" title="random.expovariate"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.expovariate()</span></code></a> 中添加默认值 <code class="docutils literal notranslate"><span class="pre">lambd=1.0</span></code> 。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/100234">gh-100234</a><span class="link-target"> [https://github.com/python/cpython/issues/100234]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="shutil">
<h3>shutil</h3>
<ul>
<li><p><a class="reference internal" href="../library/shutil.xhtml#shutil.make_archive" title="shutil.make_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.make_archive()</span></code></a> 现在将 <em>rootdir</em> 参数传递给支持它的自定义存档程序。 在这种情况下，它不再临时将进程的当前工作目录更改为 <em>rootdir</em> 来执行存档。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/74696">gh-74696</a><span class="link-target"> [https://github.com/python/cpython/issues/74696]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/shutil.xhtml#shutil.rmtree" title="shutil.rmtree"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.rmtree()</span></code></a> 现在接受一个新的参数 <em>onexc</em>，它是一个类似 <em>onerror</em> 的错误处理器，但它接受一个异常实例而不是一个 <em>(typ, val, tb)</em> 三元组。 <em>onerror</em> 已被弃用。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102828">gh-102828</a><span class="link-target"> [https://github.com/python/cpython/issues/102828]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/shutil.xhtml#shutil.which" title="shutil.which"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.which()</span></code></a> 现在即使给定的 <em>cmd</em> 包含目录组件，在 Windows 系统上也会参考 <em>PATHEXT</em> 环境变量在 <em>PATH</em> 中查找匹配项。 （由 Charles Machalow 在 <a class="reference external" href="https://github.com/python/cpython/issues/103179">gh-103179</a><span class="link-target"> [https://github.com/python/cpython/issues/103179]</span> 中贡献。）</p>
<p><a class="reference internal" href="../library/shutil.xhtml#shutil.which" title="shutil.which"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.which()</span></code></a> 将在 Windows 上查询可执行文件时调用 <code class="docutils literal notranslate"><span class="pre">NeedCurrentDirectoryForExePathW</span></code>，以确定是否应将当前工作目录预先设置为搜索路径。 （由 Charles Machalow 在 <a class="reference external" href="https://github.com/python/cpython/issues/103179">gh-103179</a><span class="link-target"> [https://github.com/python/cpython/issues/103179]</span> 中贡献。）</p>
<p>在 Windows 上 <a class="reference internal" href="../library/shutil.xhtml#shutil.which" title="shutil.which"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.which()</span></code></a> 将在搜索路径的其他地方直接匹配之前返回 <em>cmd</em> 与来自 <code class="docutils literal notranslate"><span class="pre">PATHEXT</span></code> 的组件相匹配的路径。 （由 Charles Machalow 在 <a class="reference external" href="https://github.com/python/cpython/issues/103179">gh-103179</a><span class="link-target"> [https://github.com/python/cpython/issues/103179]</span> 中贡献。）</p>
</li>
</ul>
</section>
<section id="sqlite3">
<h3>sqlite3</h3>
<ul class="simple">
<li><p>增加了一个 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3-cli"><span class="std std-ref">命令行接口</span></a>。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/77617">gh-77617</a><span class="link-target"> [https://github.com/python/cpython/issues/77617]</span> 中贡献。）</p></li>
<li><p>向 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Connection" title="sqlite3.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Connection</span></code></a> 添加 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Connection.autocommit" title="sqlite3.Connection.autocommit"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlite3.Connection.autocommit</span></code></a> 属性并向 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.connect" title="sqlite3.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlite3.connect()</span></code></a> 添加 <em>autocommit</em> 形参用于控制兼容 <span class="target" id="index-122"></span><a class="pep reference external" href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a><span class="link-target"> [https://peps.python.org/pep-0249/]</span> 的 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3-transaction-control-autocommit"><span class="std std-ref">事务处理</span></a>。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/83638">gh-83638</a><span class="link-target"> [https://github.com/python/cpython/issues/83638]</span> 中贡献。）</p></li>
<li><p>向 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.load_extension()</span></code></a> 添加 <em>entrypoint</em> 仅限关键字形参，用于覆盖 SQLite 扩展入口点。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/103015">gh-103015</a><span class="link-target"> [https://github.com/python/cpython/issues/103015]</span> 中贡献。）</p></li>
<li><p>向 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Connection" title="sqlite3.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Connection</span></code></a> 添加 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Connection.getconfig" title="sqlite3.Connection.getconfig"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.getconfig()</span></code></a> 和 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Connection.setconfig" title="sqlite3.Connection.setconfig"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlite3.Connection.setconfig()</span></code></a> 用于对数据库连接进行配置修改。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/103489">gh-103489</a><span class="link-target"> [https://github.com/python/cpython/issues/103489]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="statistics">
<h3>statistics</h3>
<ul class="simple">
<li><p>扩展 <a class="reference internal" href="../library/statistics.xhtml#statistics.correlation" title="statistics.correlation"><code class="xref py py-func docutils literal notranslate"><span class="pre">statistics.correlation()</span></code></a> 以 <code class="docutils literal notranslate"><span class="pre">ranked</span></code> 方法的形式包括对分级数据的斯皮尔曼相关性计算。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/95861">gh-95861</a><span class="link-target"> [https://github.com/python/cpython/issues/95861]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="sys">
<h3>sys</h3>
<ul class="simple">
<li><p>添加了 <a class="reference internal" href="../library/sys.monitoring.xhtml#module-sys.monitoring" title="sys.monitoring: Access and control event monitoring"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys.monitoring</span></code></a> 命名空间以公开新的 <a class="reference internal" href="#whatsnew312-pep669"><span class="std std-ref">PEP 669</span></a> 监控 API。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/103082">gh-103082</a><span class="link-target"> [https://github.com/python/cpython/issues/103082]</span> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../library/sys.xhtml#sys.activate_stack_trampoline" title="sys.activate_stack_trampoline"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.activate_stack_trampoline()</span></code></a> 和 <a class="reference internal" href="../library/sys.xhtml#sys.deactivate_stack_trampoline" title="sys.deactivate_stack_trampoline"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.deactivate_stack_trampoline()</span></code></a> 用于激活和停用栈性能分析器 trampoline，以及 <a class="reference internal" href="../library/sys.xhtml#sys.is_stack_trampoline_active" title="sys.is_stack_trampoline_active"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.is_stack_trampoline_active()</span></code></a> 用于查询栈性能分析器 trampoline 是否激活。 （基于 Gregory P. Smith [Google] 和 Mark Shannon 的贡献由 Pablo Galindo 和 Christian Heimes 在 <a class="reference external" href="https://github.com/python/cpython/issues/96123">gh-96123</a><span class="link-target"> [https://github.com/python/cpython/issues/96123]</span> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../library/sys.xhtml#sys.last_exc" title="sys.last_exc"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_exc</span></code></a> 用于保存最新引发的未处理异常（针对事后调试的应用场景）。 弃用了以三个字段来保存相同信息的旧形式: <a class="reference internal" href="../library/sys.xhtml#sys.last_type" title="sys.last_type"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_type</span></code></a>, <a class="reference internal" href="../library/sys.xhtml#sys.last_value" title="sys.last_value"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_value</span></code></a> 和 <a class="reference internal" href="../library/sys.xhtml#sys.last_traceback" title="sys.last_traceback"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_traceback</span></code></a>。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102778">gh-102778</a><span class="link-target"> [https://github.com/python/cpython/issues/102778]</span> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/sys.xhtml#sys._current_exceptions" title="sys._current_exceptions"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys._current_exceptions()</span></code></a> 将返回从线程 ID 到异常实例的映射，而不是到 <code class="docutils literal notranslate"><span class="pre">(typ,</span> <span class="pre">exc,</span> <span class="pre">tb)</span></code> 元组的映射。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/103176">gh-103176</a><span class="link-target"> [https://github.com/python/cpython/issues/103176]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/sys.xhtml#sys.setrecursionlimit" title="sys.setrecursionlimit"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setrecursionlimit()</span></code></a> 和 <a class="reference internal" href="../library/sys.xhtml#sys.getrecursionlimit" title="sys.getrecursionlimit"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.getrecursionlimit()</span></code></a>。 递归限制现在只应用于 Python 代码。 内置函数不使用该递归限制，但受到另一种可防止递归导致虚拟机崩溃的机制保护。</p></li>
</ul>
</section>
<section id="tempfile">
<h3>tempfile</h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/tempfile.xhtml#tempfile.NamedTemporaryFile" title="tempfile.NamedTemporaryFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">tempfile.NamedTemporaryFile</span></code></a> 函数增加了一个新的可选形参 <em>delete_on_close</em>。 （由 Evgeny Zorin 在 <a class="reference external" href="https://github.com/python/cpython/issues/58451">gh-58451</a><span class="link-target"> [https://github.com/python/cpython/issues/58451]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/tempfile.xhtml#tempfile.mkdtemp" title="tempfile.mkdtemp"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.mkdtemp()</span></code></a> 现在将总是返回一个绝对路径，即使提供给 <em>dir</em> 形参的参数是一个相对路径。</p></li>
<li><p>As of 3.12.4 on Windows, the default mode <code class="docutils literal notranslate"><span class="pre">0o700</span></code> used by
<a class="reference internal" href="../library/tempfile.xhtml#tempfile.mkdtemp" title="tempfile.mkdtemp"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.mkdtemp()</span></code></a> now limits access to the new directory due to
changes to <a class="reference internal" href="../library/os.xhtml#os.mkdir" title="os.mkdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.mkdir()</span></code></a>. This is a mitigation for <a class="reference external" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4030">CVE-2024-4030</a><span class="link-target"> [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4030]</span>.
(Contributed by Steve Dower in <a class="reference external" href="https://github.com/python/cpython/issues/118486">gh-118486</a><span class="link-target"> [https://github.com/python/cpython/issues/118486]</span>.)</p></li>
</ul>
</section>
<section id="threading">
<h3>threading</h3>
<ul class="simple">
<li><p>增加了 <a class="reference internal" href="../library/threading.xhtml#threading.settrace_all_threads" title="threading.settrace_all_threads"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.settrace_all_threads()</span></code></a> 和 <a class="reference internal" href="../library/threading.xhtml#threading.setprofile_all_threads" title="threading.setprofile_all_threads"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.setprofile_all_threads()</span></code></a> 以允许在所运行的全部线程中设置追踪和性能分析函数而不是只在调用方线程中。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/93503">gh-93503</a><span class="link-target"> [https://github.com/python/cpython/issues/93503]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="tkinter">
<h3>tkinter</h3>
<ul class="simple">
<li><p>现在 <code class="docutils literal notranslate"><span class="pre">tkinter.Canvas.coords()</span></code> 会展平其参数。 它现在不仅接受单独参数形式的坐标 (<code class="docutils literal notranslate"><span class="pre">x1,</span> <span class="pre">y1,</span> <span class="pre">x2,</span> <span class="pre">y2,</span> <span class="pre">...</span></code>) 以及由坐标组成的序列 (<code class="docutils literal notranslate"><span class="pre">[x1,</span> <span class="pre">y1,</span> <span class="pre">x2,</span> <span class="pre">y2,</span> <span class="pre">...]</span></code>)，也接受成对分组 (<code class="docutils literal notranslate"><span class="pre">(x1,</span> <span class="pre">y1),</span> <span class="pre">(x2,</span> <span class="pre">y2),</span> <span class="pre">...</span></code> 和 <code class="docutils literal notranslate"><span class="pre">[(x1,</span> <span class="pre">y1),</span> <span class="pre">(x2,</span> <span class="pre">y2),</span> <span class="pre">...]</span></code>) 形式的坐标，就像 <code class="docutils literal notranslate"><span class="pre">create_*()</span></code> 方法一样。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/94473">gh-94473</a><span class="link-target"> [https://github.com/python/cpython/issues/94473]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="tokenize">
<h3>tokenize</h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/tokenize.xhtml#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tokenize</span></code></a> 模块包括了 <span class="target" id="index-123"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span> 所引入的更改。 （由 Marta Gómez Macías 和 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/102856">gh-102856</a><span class="link-target"> [https://github.com/python/cpython/issues/102856]</span> 中贡献。） 请参阅 <a class="reference internal" href="#whatsnew312-porting-to-python312"><span class="std std-ref">移植到 Python 3.12</span></a> 了解有关对 <a class="reference internal" href="../library/tokenize.xhtml#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tokenize</span></code></a> 模块的更改详情。</p></li>
</ul>
</section>
<section id="types">
<h3>types</h3>
<ul class="simple">
<li><p>增加了 <a class="reference internal" href="../library/types.xhtml#types.get_original_bases" title="types.get_original_bases"><code class="xref py py-func docutils literal notranslate"><span class="pre">types.get_original_bases()</span></code></a> 以允许在子类化时继续对 <a class="reference internal" href="../library/typing.xhtml#user-defined-generics"><span class="std std-ref">用户定义的泛型类型</span></a> 进行内省。 （由 James Hilton-Balfe 和 Alex Waygood 在 <a class="reference external" href="https://github.com/python/cpython/issues/101827">gh-101827</a><span class="link-target"> [https://github.com/python/cpython/issues/101827]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="typing">
<span id="whatsnew-typing-py312"></span><h3>typing</h3>
<ul>
<li><p>针对 <a class="reference internal" href="../library/typing.xhtml#typing.runtime_checkable" title="typing.runtime_checkable"><code class="xref py py-func docutils literal notranslate"><span class="pre">运行时可检测协议</span></code></a> 的 <a class="reference internal" href="../library/functions.xhtml#isinstance" title="isinstance"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> 检测现在会使用 <a class="reference internal" href="../library/inspect.xhtml#inspect.getattr_static" title="inspect.getattr_static"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.getattr_static()</span></code></a> 而不是 <a class="reference internal" href="../library/functions.xhtml#hasattr" title="hasattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">hasattr()</span></code></a> 来查找属性是否存在。 这意味着描述器和 <a class="reference internal" href="../reference/datamodel.xhtml#object.__getattr__" title="object.__getattr__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__()</span></code></a> 方法在针对运行时可检测协议的 <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> 检测期间不会被意外地求值。 但是，这也意味着某些原来被视为运行时可检测协议的实例的对象在 Python 3.12+ 上将不再被视为运行时可检测协议的实例，反之亦然。 大部分用户都不太可能受到这一改变的影响。 （由 Alex Waygood 在 <a class="reference external" href="https://github.com/python/cpython/issues/102433">gh-102433</a><span class="link-target"> [https://github.com/python/cpython/issues/102433]</span> 中贡献。）</p></li>
<li><p>现在运行时可检测协议的成员在运行时一旦创建了相应的类就将被视为“已冻结”。 作用于运行时可检测协议的猴子补丁属性将仍然可用，但不会再影响将对象与协议进行比较的 <a class="reference internal" href="../library/functions.xhtml#isinstance" title="isinstance"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> 检测中。 例如:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">runtime_checkable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@runtime_checkable</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">HasX</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span> <span class="o">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">HasX</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">HasX</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">HasX</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">HasX</span><span class="p">)</span>  <span class="c1"># unchanged, even though HasX now also has a &quot;y&quot; attribute</span>
<span class="go">True</span>
</pre></div>
</div>
<p>应用这项改变是为了提高针对运行时可检测协议的 <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> 检测速度。</p>
</li>
<li><p>针对 <a class="reference internal" href="../library/typing.xhtml#typing.runtime_checkable" title="typing.runtime_checkable"><code class="xref py py-func docutils literal notranslate"><span class="pre">运行时可检测协议</span></code></a> 的 <a class="reference internal" href="../library/functions.xhtml#isinstance" title="isinstance"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> 检测的性能表现有显著的改进。 对于仅有少量成员的协议的大部分 <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> 检测相比 3.11 应当至少有 2 倍的加速。 不过，对于具有大量成员的协议的 <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> 检测可能会慢于 Python 3.11。 （由 Alex Waygood 在 <a class="reference external" href="https://github.com/python/cpython/issues/74690">gh-74690</a><span class="link-target"> [https://github.com/python/cpython/issues/74690]</span> 和 <a class="reference external" href="https://github.com/python/cpython/issues/103193">gh-103193</a><span class="link-target"> [https://github.com/python/cpython/issues/103193]</span> 中贡献。）.)</p></li>
<li><p>现在所有 <a class="reference internal" href="../library/typing.xhtml#typing.TypedDict" title="typing.TypedDict"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.TypedDict</span></code></a> 和 <a class="reference internal" href="../library/typing.xhtml#typing.NamedTuple" title="typing.NamedTuple"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.NamedTuple</span></code></a> 类都具有 <code class="docutils literal notranslate"><span class="pre">__orig_bases__</span></code> 属性。 （由 Adrian Garcia Badaracco 在 <a class="reference external" href="https://github.com/python/cpython/issues/103699">gh-103699</a><span class="link-target"> [https://github.com/python/cpython/issues/103699]</span> 中贡献。）</p></li>
<li><p>向 <a class="reference internal" href="../library/typing.xhtml#typing.dataclass_transform" title="typing.dataclass_transform"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.dataclass_transform()</span></code></a> 添加了 <code class="docutils literal notranslate"><span class="pre">frozen_default</span></code> 形参。 （由 Erik De Bonte 在 <a class="reference external" href="https://github.com/python/cpython/issues/99957">gh-99957</a><span class="link-target"> [https://github.com/python/cpython/issues/99957]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="unicodedata">
<h3>unicodedata</h3>
<ul class="simple">
<li><p>Unicode 数据库已更新到 15.0.0 版。 （由 Benjamin Peterson 在 <a class="reference external" href="https://github.com/python/cpython/issues/96734">gh-96734</a><span class="link-target"> [https://github.com/python/cpython/issues/96734]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="unittest">
<h3>unittest</h3>
<p>增加了 <code class="docutils literal notranslate"><span class="pre">--durations</span></code> 命令行选项，显示 N 个最慢的测试用例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="o">--</span><span class="n">durations</span><span class="o">=</span><span class="mi">3</span> <span class="n">lib</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_threading</span>
<span class="o">.....</span>
<span class="n">Slowest</span> <span class="n">test</span> <span class="n">durations</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="mf">1.210</span><span class="n">s</span>     <span class="n">test_timeout</span> <span class="p">(</span><span class="n">Lib</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">test_threading</span><span class="o">.</span><span class="n">BarrierTests</span><span class="p">)</span>
<span class="mf">1.003</span><span class="n">s</span>     <span class="n">test_default_timeout</span> <span class="p">(</span><span class="n">Lib</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">test_threading</span><span class="o">.</span><span class="n">BarrierTests</span><span class="p">)</span>
<span class="mf">0.518</span><span class="n">s</span>     <span class="n">test_timeout</span> <span class="p">(</span><span class="n">Lib</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">test_threading</span><span class="o">.</span><span class="n">EventTests</span><span class="p">)</span>

<span class="p">(</span><span class="mf">0.000</span> <span class="n">durations</span> <span class="n">hidden</span><span class="o">.</span>  <span class="n">Use</span> <span class="o">-</span><span class="n">v</span> <span class="n">to</span> <span class="n">show</span> <span class="n">these</span> <span class="n">durations</span><span class="o">.</span><span class="p">)</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">158</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">9.869</span><span class="n">s</span>

<span class="n">OK</span> <span class="p">(</span><span class="n">skipped</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>（由 Giampaolo Rodola 在 <a class="reference external" href="https://github.com/python/cpython/issues/48330">gh-48330</a><span class="link-target"> [https://github.com/python/cpython/issues/48330]</span> 中贡献。）</p>
</section>
<section id="uuid">
<h3>uuid</h3>
<ul class="simple">
<li><p>增加了一个 <a class="reference internal" href="../library/uuid.xhtml#uuid-cli"><span class="std std-ref">命令行接口</span></a>。 （由 Adam Chhina 在 <a class="reference external" href="https://github.com/python/cpython/issues/88597">gh-88597</a><span class="link-target"> [https://github.com/python/cpython/issues/88597]</span> 中贡献。）</p></li>
</ul>
</section>
</section>
<section id="optimizations">
<h2>性能优化</h2>
<ul class="simple">
<li><p>从 Unicode 对象中移除了 <code class="docutils literal notranslate"><span class="pre">wstr</span></code> 和 <code class="docutils literal notranslate"><span class="pre">wstr_length</span></code> 成员。 这使得对象大小在 64 位平台上减少了 8 个或 16 个字节。 (<span class="target" id="index-124"></span><a class="pep reference external" href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a><span class="link-target"> [https://peps.python.org/pep-0623/]</span>) （由 Inada Naoki 在 <a class="reference external" href="https://github.com/python/cpython/issues/92536">gh-92536</a><span class="link-target"> [https://github.com/python/cpython/issues/92536]</span> 中贡献。）</p></li>
<li><p>增加了在构建进程中使用 BOLT 二进制优化器的实验性支持，这将使得性能提升 1-5%。 （由 Kevin Modzelewski 在 <a class="reference external" href="https://github.com/python/cpython/issues/90536">gh-90536</a><span class="link-target"> [https://github.com/python/cpython/issues/90536]</span> 中贡献并由 Donghee Na 在 <a class="reference external" href="https://github.com/python/cpython/issues/101525">gh-101525</a><span class="link-target"> [https://github.com/python/cpython/issues/101525]</span> 中微调。 ）</p></li>
<li><p>对于包含分组引用的替换字符串的正则表达式替换（包括 <a class="reference internal" href="../library/re.xhtml#re.sub" title="re.sub"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.sub()</span></code></a> 和 <a class="reference internal" href="../library/re.xhtml#re.subn" title="re.subn"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.subn()</span></code></a> 函数及对应的 <code class="xref py py-class docutils literal notranslate"><span class="pre">re.Pattern</span></code> 方法）可加速 2--3 倍。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/91524">gh-91524</a><span class="link-target"> [https://github.com/python/cpython/issues/91524]</span> 中贡献。）</p></li>
<li><p>通过推迟高消耗的字符串格式化来加速 <a class="reference internal" href="../library/asyncio-task.xhtml#asyncio.Task" title="asyncio.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.Task</span></code></a> 的创建的。 （由 Itamar Oren 在 <a class="reference external" href="https://github.com/python/cpython/issues/103793">gh-103793</a><span class="link-target"> [https://github.com/python/cpython/issues/103793]</span> 中贡献。）</p></li>
<li><p>作为在 <a class="reference internal" href="../library/tokenize.xhtml#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tokenize</span></code></a> 模块中应用 <span class="target" id="index-125"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span> 所要求的更改的附带效果，<a class="reference internal" href="../library/tokenize.xhtml#tokenize.tokenize" title="tokenize.tokenize"><code class="xref py py-func docutils literal notranslate"><span class="pre">tokenize.tokenize()</span></code></a> 和 <a class="reference internal" href="../library/tokenize.xhtml#tokenize.generate_tokens" title="tokenize.generate_tokens"><code class="xref py py-func docutils literal notranslate"><span class="pre">tokenize.generate_tokens()</span></code></a> 函数可加速至多 64%。 （由 Marta Gómez Macías 和 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/102856">gh-102856</a><span class="link-target"> [https://github.com/python/cpython/issues/102856]</span> 中贡献。）</p></li>
<li><p>通过新的 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_SUPER_ATTR"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_SUPER_ATTR</span></code></a> 指令加速 <a class="reference internal" href="../library/functions.xhtml#super" title="super"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> 方法调用和属性加载。 （由 Carl Meyer 和 Vladimir Matveev 在 <a class="reference external" href="https://github.com/python/cpython/issues/103497">gh-103497</a><span class="link-target"> [https://github.com/python/cpython/issues/103497]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="cpython-bytecode-changes">
<h2>CPython 字节码的改变</h2>
<ul class="simple">
<li><p>移除了 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_METHOD</span></code> 指令。 它已被合并至 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_ATTR"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_ATTR</span></code></a>。 现在如果设置了 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_ATTR"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_ATTR</span></code></a> 的 oparg 比特位则它的行为将类似原来的 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_METHOD</span></code>。 （由 Ken Jin 在 <a class="reference external" href="https://github.com/python/cpython/issues/93429">gh-93429</a><span class="link-target"> [https://github.com/python/cpython/issues/93429]</span> 中贡献。）</p></li>
<li><p>移除了 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">JUMP_IF_FALSE_OR_POP</span></code> 和 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">JUMP_IF_TRUE_OR_POP</span></code> 指令。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102859">gh-102859</a><span class="link-target"> [https://github.com/python/cpython/issues/102859]</span> 中贡献。）</p></li>
<li><p>移除了 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">PRECALL</span></code> 指令。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/92925">gh-92925</a><span class="link-target"> [https://github.com/python/cpython/issues/92925]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#opcode-BINARY_SLICE"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">BINARY_SLICE</span></code></a> 和 <a class="reference internal" href="../library/dis.xhtml#opcode-STORE_SLICE"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">STORE_SLICE</span></code></a> 指令。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/94163">gh-94163</a><span class="link-target"> [https://github.com/python/cpython/issues/94163]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#opcode-CALL_INTRINSIC_1"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">CALL_INTRINSIC_1</span></code></a> 指令。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/99005">gh-99005</a><span class="link-target"> [https://github.com/python/cpython/issues/99005]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#opcode-CALL_INTRINSIC_2"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">CALL_INTRINSIC_2</span></code></a> 指令。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/101799">gh-101799</a><span class="link-target"> [https://github.com/python/cpython/issues/101799]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#opcode-CLEANUP_THROW"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">CLEANUP_THROW</span></code></a> 指令。 （由 Brandt Bucher 在 <a class="reference external" href="https://github.com/python/cpython/issues/90997">gh-90997</a><span class="link-target"> [https://github.com/python/cpython/issues/90997]</span> 中贡献。）</p></li>
<li><p>添加了 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">END_SEND</span></code> 指令。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/103082">gh-103082</a><span class="link-target"> [https://github.com/python/cpython/issues/103082]</span> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_FAST_AND_CLEAR"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_FAST_AND_CLEAR</span></code></a> 指令作为 <span class="target" id="index-126"></span><a class="pep reference external" href="https://peps.python.org/pep-0709/"><strong>PEP 709</strong></a><span class="link-target"> [https://peps.python.org/pep-0709/]</span> 的实现的组成部分。 （由 Carl Meyer 在 <a class="reference external" href="https://github.com/python/cpython/issues/101441">gh-101441</a><span class="link-target"> [https://github.com/python/cpython/issues/101441]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_FAST_CHECK"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_FAST_CHECK</span></code></a> 指令。 （由 Dennis Sweeney 在 <a class="reference external" href="https://github.com/python/cpython/issues/93143">gh-93143</a><span class="link-target"> [https://github.com/python/cpython/issues/93143]</span> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_FROM_DICT_OR_DEREF"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_FROM_DICT_OR_DEREF</span></code></a>, <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_FROM_DICT_OR_GLOBALS"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_FROM_DICT_OR_GLOBALS</span></code></a> 和 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_LOCALS"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_LOCALS</span></code></a> 操作码作为 <span class="target" id="index-127"></span><a class="pep reference external" href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a><span class="link-target"> [https://peps.python.org/pep-0695/]</span> 的组成部分。 移除了 <code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_CLASSDEREF</span></code> 操作码，它可以用 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_LOCALS"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_LOCALS</span></code></a> 加 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_FROM_DICT_OR_DEREF"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_FROM_DICT_OR_DEREF</span></code></a> 来代替。 （由 Jelle Zijlstra 在 <a class="reference external" href="https://github.com/python/cpython/issues/103764">gh-103764</a><span class="link-target"> [https://github.com/python/cpython/issues/103764]</span> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../library/dis.xhtml#opcode-LOAD_SUPER_ATTR"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_SUPER_ATTR</span></code></a> 指令。 （由 Carl Meyer 和 Vladimir Matveev 在 <a class="reference external" href="https://github.com/python/cpython/issues/103497">gh-103497</a><span class="link-target"> [https://github.com/python/cpython/issues/103497]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../library/dis.xhtml#opcode-RETURN_CONST"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">RETURN_CONST</span></code></a> 指令。 （由 Wenyang Wang 在 <a class="reference external" href="https://github.com/python/cpython/issues/101632">gh-101632</a><span class="link-target"> [https://github.com/python/cpython/issues/101632]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="demos-and-tools">
<h2>演示和工具</h2>
<ul class="simple">
<li><p>移除了包含旧演示脚本的 <code class="docutils literal notranslate"><span class="pre">Tools/demo/</span></code> 目录。 其副本可在 <a class="reference external" href="https://github.com/gvanrossum/old-demos">old-demos project</a><span class="link-target"> [https://github.com/gvanrossum/old-demos]</span> 中找到。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/97681">gh-97681</a><span class="link-target"> [https://github.com/python/cpython/issues/97681]</span> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">Tools/scripts/</span></code> 目录下过时的示例脚本。 其副本可在 <a class="reference external" href="https://github.com/gvanrossum/old-demos">old-demos project</a><span class="link-target"> [https://github.com/gvanrossum/old-demos]</span> 中找到。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/97669">gh-97669</a><span class="link-target"> [https://github.com/python/cpython/issues/97669]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="deprecated">
<h2>弃用</h2>
<ul>
<li><p><a class="reference internal" href="../library/argparse.xhtml#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a>: <code class="xref py py-class docutils literal notranslate"><span class="pre">argparse.BooleanOptionalAction</span></code> 的 <em>type</em>, <em>choices</em> 和 <em>metavar</em> 形参已被弃用并将在 3.14 中移除。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/92248">gh-92248</a><span class="link-target"> [https://github.com/python/cpython/issues/92248]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/ast.xhtml#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a>: 以下 <a class="reference internal" href="../library/ast.xhtml#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 特性自 Python 3.8 起已在文档中声明弃用，现在当运行时如果它们被访问或使用将发出 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>，并将在 Python 3.14 中移除:</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Num</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Str</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Bytes</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.NameConstant</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Ellipsis</span></code></p></li>
</ul>
<p>请改用 <a class="reference internal" href="../library/ast.xhtml#ast.Constant" title="ast.Constant"><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Constant</span></code></a>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/90953">gh-90953</a><span class="link-target"> [https://github.com/python/cpython/issues/90953]</span> 中贡献。）</p>
</li>
<li><p><a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a>:</p>
<ul class="simple">
<li><p>子监视器类 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.MultiLoopChildWatcher" title="asyncio.MultiLoopChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.MultiLoopChildWatcher</span></code></a>, <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.FastChildWatcher" title="asyncio.FastChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.FastChildWatcher</span></code></a>, <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.AbstractChildWatcher" title="asyncio.AbstractChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.AbstractChildWatcher</span></code></a> 和 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.SafeChildWatcher" title="asyncio.SafeChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.SafeChildWatcher</span></code></a> 已被弃用并将在 Python 3.14 中移除。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/94597">gh-94597</a><span class="link-target"> [https://github.com/python/cpython/issues/94597]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.set_child_watcher" title="asyncio.set_child_watcher"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.set_child_watcher()</span></code></a>、<a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.get_child_watcher" title="asyncio.get_child_watcher"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_child_watcher()</span></code></a>、<a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.AbstractEventLoopPolicy.set_child_watcher" title="asyncio.AbstractEventLoopPolicy.set_child_watcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoopPolicy.set_child_watcher()</span></code></a> 和 <a class="reference internal" href="../library/asyncio-policy.xhtml#asyncio.AbstractEventLoopPolicy.get_child_watcher" title="asyncio.AbstractEventLoopPolicy.get_child_watcher"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoopPolicy.get_child_watcher()</span></code></a> 已弃用，并将在 Python 3.14 中移除。（由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/94597">gh-94597</a><span class="link-target"> [https://github.com/python/cpython/issues/94597]</span> 中贡献。）</p></li>
<li><p>现在默认事件循环策略的 <a class="reference internal" href="../library/asyncio-eventloop.xhtml#asyncio.get_event_loop" title="asyncio.get_event_loop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_event_loop()</span></code></a> 方法在当前事件循环未设置并决定创建一个时将发出 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 （由 Serhiy Storchaka 和 Guido van Rossum 在 <a class="reference external" href="https://github.com/python/cpython/issues/100160">gh-100160</a><span class="link-target"> [https://github.com/python/cpython/issues/100160]</span> 中贡献。）</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/calendar.xhtml#module-calendar" title="calendar: Functions for working with calendars, including some emulation of the Unix cal program."><code class="xref py py-mod docutils literal notranslate"><span class="pre">calendar</span></code></a>: <code class="docutils literal notranslate"><span class="pre">calendar.January</span></code> 和 <code class="docutils literal notranslate"><span class="pre">calendar.February</span></code> 常量已被弃用并由 <a class="reference internal" href="../library/calendar.xhtml#calendar.JANUARY" title="calendar.JANUARY"><code class="xref py py-data docutils literal notranslate"><span class="pre">calendar.JANUARY</span></code></a> 和 <a class="reference internal" href="../library/calendar.xhtml#calendar.FEBRUARY" title="calendar.FEBRUARY"><code class="xref py py-data docutils literal notranslate"><span class="pre">calendar.FEBRUARY</span></code></a> 替代。 （由 Prince Roshan 在 <a class="reference external" href="https://github.com/python/cpython/issues/103636">gh-103636</a><span class="link-target"> [https://github.com/python/cpython/issues/103636]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/collections.abc.xhtml#module-collections.abc" title="collections.abc: Abstract base classes for containers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a>: 已弃用 <a class="reference internal" href="../library/collections.abc.xhtml#collections.abc.ByteString" title="collections.abc.ByteString"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.ByteString</span></code></a>。 推荐改用 <code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code> 或 <a class="reference internal" href="../library/collections.abc.xhtml#collections.abc.Buffer" title="collections.abc.Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Buffer</span></code></a>。 在类型标中，推荐改用并集，如 <code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">|</span> <span class="pre">bytearray</span></code> 或 <a class="reference internal" href="../library/collections.abc.xhtml#collections.abc.Buffer" title="collections.abc.Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Buffer</span></code></a>。 （由 Shantanu Jain 在 <a class="reference external" href="https://github.com/python/cpython/issues/91896">gh-91896</a><span class="link-target"> [https://github.com/python/cpython/issues/91896]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/datetime.xhtml#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a>: <a class="reference internal" href="../library/datetime.xhtml#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> 的 <a class="reference internal" href="../library/datetime.xhtml#datetime.datetime.utcnow" title="datetime.datetime.utcnow"><code class="xref py py-meth docutils literal notranslate"><span class="pre">utcnow()</span></code></a> 和 <a class="reference internal" href="../library/datetime.xhtml#datetime.datetime.utcfromtimestamp" title="datetime.datetime.utcfromtimestamp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">utcfromtimestamp()</span></code></a> 已被弃用并将在未来的版本中移除。 请改用可感知时区的对象以 UTC 来表示日期时间：分别调用 <a class="reference internal" href="../library/datetime.xhtml#datetime.datetime.now" title="datetime.datetime.now"><code class="xref py py-meth docutils literal notranslate"><span class="pre">now()</span></code></a> 和 <a class="reference internal" href="../library/datetime.xhtml#datetime.datetime.fromtimestamp" title="datetime.datetime.fromtimestamp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fromtimestamp()</span></code></a> 并设置 <em>tz</em> 形参为 <a class="reference internal" href="../library/datetime.xhtml#datetime.UTC" title="datetime.UTC"><code class="xref py py-const docutils literal notranslate"><span class="pre">datetime.UTC</span></code></a>。 （由 Paul Ganssle 在 <a class="reference external" href="https://github.com/python/cpython/issues/103857">gh-103857</a><span class="link-target"> [https://github.com/python/cpython/issues/103857]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/email.xhtml#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a>: 已弃用 <a class="reference internal" href="../library/email.utils.xhtml#email.utils.localtime" title="email.utils.localtime"><code class="xref py py-func docutils literal notranslate"><span class="pre">email.utils.localtime()</span></code></a> 中的 <em>isdst</em> 形参。 （由 Alan Williams 在 <a class="reference external" href="https://github.com/python/cpython/issues/72346">gh-72346</a><span class="link-target"> [https://github.com/python/cpython/issues/72346]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/importlib.xhtml#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.abc</span></code></a>: 已弃用下列类，计划在 Python 3.14 中移除:</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.ResourceReader</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.Traversable</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.TraversableResources</span></code></p></li>
</ul>
<p>使用 <a class="reference internal" href="../library/importlib.resources.abc.xhtml#module-importlib.resources.abc" title="importlib.resources.abc: Abstract base classes for resources"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.resources.abc</span></code></a> 类代替:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/importlib.resources.abc.xhtml#importlib.resources.abc.Traversable" title="importlib.resources.abc.Traversable"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.resources.abc.Traversable</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/importlib.resources.abc.xhtml#importlib.resources.abc.TraversableResources" title="importlib.resources.abc.TraversableResources"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.resources.abc.TraversableResources</span></code></a></p></li>
</ul>
<p>（由 Jason R. Coombs 和 Hugo van Kemenade 在 <a class="reference external" href="https://github.com/python/cpython/issues/93963">gh-93963</a><span class="link-target"> [https://github.com/python/cpython/issues/93963]</span> 中贡献。）</p>
</li>
<li><p><a class="reference internal" href="../library/itertools.xhtml#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a>: 已弃用对 copy、deepcopy 和 pickle 操作的支持，它们未被写入文档、效率低下、历史上充满问题且缺乏一致性。 这将在 3.14 中移除以显著减少代码量和维护负担。 （由 Raymond Hettinger 在 <a class="reference external" href="https://github.com/python/cpython/issues/101588">gh-101588</a><span class="link-target"> [https://github.com/python/cpython/issues/101588]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/multiprocessing.xhtml#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing</span></code></a>: 在 Python 3.14 中，默认的 <a class="reference internal" href="../library/multiprocessing.xhtml#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing</span></code></a> 启动方法将在 Linux、BSD 和其他非 macOS 的 POSIX 平台上改为更安全的方法，在这些平台上目前默认为 <code class="docutils literal notranslate"><span class="pre">'fork'</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/84559">gh-84559</a><span class="link-target"> [https://github.com/python/cpython/issues/84559]</span>)。 在运行时添加相关警告被认为干扰性太大因为大部分代码都不会在意这个问题。 当你的代码 <em>需要</em> <code class="docutils literal notranslate"><span class="pre">'fork'</span></code> 时请使用 <a class="reference internal" href="../library/multiprocessing.xhtml#multiprocessing.get_context" title="multiprocessing.get_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_context()</span></code></a> 或 <a class="reference internal" href="../library/multiprocessing.xhtml#multiprocessing.set_start_method" title="multiprocessing.set_start_method"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_start_method()</span></code></a> API 显式地指明。 参见 <a class="reference internal" href="../library/multiprocessing.xhtml#multiprocessing-start-methods"><span class="std std-ref">上下文和启动方法</span></a>。</p></li>
<li><p><a class="reference internal" href="../library/pkgutil.xhtml#module-pkgutil" title="pkgutil: Utilities for the import system."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkgutil</span></code></a>: <a class="reference internal" href="../library/pkgutil.xhtml#pkgutil.find_loader" title="pkgutil.find_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">pkgutil.find_loader()</span></code></a> 和 <a class="reference internal" href="../library/pkgutil.xhtml#pkgutil.get_loader" title="pkgutil.get_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">pkgutil.get_loader()</span></code></a> 已被弃用并将在 Python 3.14 中移除；请改用 <a class="reference internal" href="../library/importlib.xhtml#importlib.util.find_spec" title="importlib.util.find_spec"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.find_spec()</span></code></a>。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/97850">gh-97850</a><span class="link-target"> [https://github.com/python/cpython/issues/97850]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/pty.xhtml#module-pty" title="pty: Pseudo-Terminal Handling for Unix. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pty</span></code></a>: 该模块有两个未写入文档的 <code class="docutils literal notranslate"><span class="pre">master_open()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">slave_open()</span></code> 函数自 Python 2 起即已被弃用但直到 3.12 才添加了相应的 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 它们将在 3.14 中移除。 （由 Soumendra Ganguly 和 Gregory P. Smith 在 <a class="reference external" href="https://github.com/python/cpython/issues/85984">gh-85984</a><span class="link-target"> [https://github.com/python/cpython/issues/85984]</span> 中贡献。）.)</p></li>
<li><p><a class="reference internal" href="../library/os.xhtml#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a>:</p>
<ul class="simple">
<li><p>在 Windows 上由 <a class="reference internal" href="../library/os.xhtml#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.stat()</span></code></a> 和 <a class="reference internal" href="../library/os.xhtml#os.lstat" title="os.lstat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.lstat()</span></code></a> 返回的 <code class="docutils literal notranslate"><span class="pre">st_ctime</span></code> 字段已被弃用。 在未来的发布版中，它们将包含最近的元数据修改时间，以与其他平台保持一致。 目前，它们仍然包含创建时间，该值也可通过新的 <code class="docutils literal notranslate"><span class="pre">st_birthtime</span></code> 字段获取。 （由 Steve Dower 在 <a class="reference external" href="https://github.com/python/cpython/issues/99726">gh-99726</a><span class="link-target"> [https://github.com/python/cpython/issues/99726]</span> 中贡献。）</p></li>
<li><p>On POSIX platforms, <a class="reference internal" href="../library/os.xhtml#os.fork" title="os.fork"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.fork()</span></code></a> can now raise a
<a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> when it can detect being called from a
multithreaded process. There has always been a fundamental incompatibility
with the POSIX platform when doing so. Even if such code <em>appeared</em> to work.
We added the warning to raise awareness as issues encountered by code doing
this are becoming more frequent. See the <a class="reference internal" href="../library/os.xhtml#os.fork" title="os.fork"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.fork()</span></code></a> documentation for
more details along with <a class="reference external" href="https://discuss.python.org/t/33555">this discussion on fork being incompatible with threads</a><span class="link-target"> [https://discuss.python.org/t/33555]</span> for <em>why</em> we're now surfacing this
longstanding platform compatibility problem to developers.</p></li>
</ul>
<p>当由于使用 <a class="reference internal" href="../library/multiprocessing.xhtml#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing</span></code></a> 或 <a class="reference internal" href="../library/concurrent.futures.xhtml#module-concurrent.futures" title="concurrent.futures: Execute computations concurrently using threads or processes."><code class="xref py py-mod docutils literal notranslate"><span class="pre">concurrent.futures</span></code></a> 而出现此警告时的解决办法是使用其他的 <a class="reference internal" href="../library/multiprocessing.xhtml#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing</span></code></a> 启动方法如 <code class="docutils literal notranslate"><span class="pre">&quot;spawn&quot;</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&quot;forkserver&quot;</span></code>。</p>
</li>
<li><p><a class="reference internal" href="../library/shutil.xhtml#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a>: <a class="reference internal" href="../library/shutil.xhtml#shutil.rmtree" title="shutil.rmtree"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.rmtree()</span></code></a> 的 <em>onerror</em> 参数已被弃用；请改用 <em>onexc</em>。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102828">gh-102828</a><span class="link-target"> [https://github.com/python/cpython/issues/102828]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/sqlite3.xhtml#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/sqlite3.xhtml#sqlite3-default-converters"><span class="std std-ref">默认适配器和转换器</span></a> 现在已被弃用，请使用 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3-adapter-converter-recipes"><span class="std std-ref">适配器和转换器范例程序</span></a> 并根据你的需要调整它们。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/90016">gh-90016</a><span class="link-target"> [https://github.com/python/cpython/issues/90016]</span> 中贡献。）</p></li>
<li><p>在 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.Cursor.execute" title="sqlite3.Cursor.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> 中，现在当 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3-placeholders"><span class="std std-ref">命名占位符</span></a> 与作为 <a class="reference internal" href="../glossary.xhtml#term-sequence"><span class="xref std std-term">sequence</span></a> 而不是 <a class="reference internal" href="../library/stdtypes.xhtml#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 提供的形参一起使用时将发出 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 从 Python 3.14 开始，当命名占位符与作为序列提供的形参一起使用时将引发 <a class="reference internal" href="../library/sqlite3.xhtml#sqlite3.ProgrammingError" title="sqlite3.ProgrammingError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ProgrammingError</span></code></a>。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/101698">gh-101698</a><span class="link-target"> [https://github.com/python/cpython/issues/101698]</span> 中贡献。）</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/sys.xhtml#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a>: <a class="reference internal" href="../library/sys.xhtml#sys.last_type" title="sys.last_type"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_type</span></code></a>, <a class="reference internal" href="../library/sys.xhtml#sys.last_value" title="sys.last_value"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_value</span></code></a> 和 <a class="reference internal" href="../library/sys.xhtml#sys.last_traceback" title="sys.last_traceback"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_traceback</span></code></a> 字段已被弃用。 请改用 <a class="reference internal" href="../library/sys.xhtml#sys.last_exc" title="sys.last_exc"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.last_exc</span></code></a>。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102778">gh-102778</a><span class="link-target"> [https://github.com/python/cpython/issues/102778]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/tarfile.xhtml#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a>: 提取 tar 归档而不指定 <em>filter</em> 的做法已被弃用直到 Python 3.14，在该版本中 <code class="docutils literal notranslate"><span class="pre">'data'</span></code> 将成为默认过滤器。 请参阅 <a class="reference internal" href="../library/tarfile.xhtml#tarfile-extraction-filter"><span class="std std-ref">解压缩过滤器</span></a> 了解详情。</p></li>
<li><p><a class="reference internal" href="../library/typing.xhtml#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/typing.xhtml#typing.Hashable" title="typing.Hashable"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Hashable</span></code></a> 和 <a class="reference internal" href="../library/typing.xhtml#typing.Sized" title="typing.Sized"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Sized</span></code></a>，分别为 <a class="reference internal" href="../library/collections.abc.xhtml#collections.abc.Hashable" title="collections.abc.Hashable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Hashable</span></code></a> 和 <a class="reference internal" href="../library/collections.abc.xhtml#collections.abc.Sized" title="collections.abc.Sized"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Sized</span></code></a> 的别名，现已被弃用。 (<a class="reference external" href="https://github.com/python/cpython/issues/94309">gh-94309</a><span class="link-target"> [https://github.com/python/cpython/issues/94309]</span>。)</p></li>
<li><p><a class="reference internal" href="../library/typing.xhtml#typing.ByteString" title="typing.ByteString"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ByteString</span></code></a> 自 Python 3.9 起已被弃用，现在当被使用时将会发出 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 （由 Alex Waygood 在 <a class="reference external" href="https://github.com/python/cpython/issues/91896">gh-91896</a><span class="link-target"> [https://github.com/python/cpython/issues/91896]</span> 中贡献。）</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.xhtml#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a>: 现在该模块在对 <a class="reference internal" href="../library/xml.etree.elementtree.xhtml#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element</span></code></a> 执行真值测试时将发出 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 在之前，Python 实现会发出 <a class="reference internal" href="../library/exceptions.xhtml#FutureWarning" title="FutureWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FutureWarning</span></code></a>，而 C 实现则不会发出任何警告。 （由 Jacob Walls 在 <a class="reference external" href="https://github.com/python/cpython/issues/83122">gh-83122</a><span class="link-target"> [https://github.com/python/cpython/issues/83122]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../reference/datamodel.xhtml#coroutine.throw" title="coroutine.throw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">coroutine</span> <span class="pre">throw()</span></code></a>, <a class="reference internal" href="../reference/expressions.xhtml#generator.throw" title="generator.throw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">generator</span> <span class="pre">throw()</span></code></a> 和 <a class="reference internal" href="../reference/expressions.xhtml#agen.athrow" title="agen.athrow"><code class="xref py py-meth docutils literal notranslate"><span class="pre">async</span> <span class="pre">generator</span> <span class="pre">throw()</span></code></a> 的三参数签名形式 (type, value, traceback) 已被弃用并可能在未来的 Python 版本中移除。 请改用这些函数的单参数版本。 （由 Ofey Chan 在 <a class="reference external" href="https://github.com/python/cpython/issues/89874">gh-89874</a><span class="link-target"> [https://github.com/python/cpython/issues/89874]</span> 中贡献。）</p></li>
<li><p>现在当一个模块上的 <code class="docutils literal notranslate"><span class="pre">__package__</span></code> 不同于 <code class="docutils literal notranslate"><span class="pre">__spec__.parent</span></code> 时将引发 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>  (在之前版本中则为 <a class="reference internal" href="../library/exceptions.xhtml#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a>)。 （由 Brett Cannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/65961">gh-65961</a><span class="link-target"> [https://github.com/python/cpython/issues/65961]</span> 中贡献。）</p></li>
<li><p>在模块上设置 <code class="docutils literal notranslate"><span class="pre">__package__</span></code> 或 <code class="docutils literal notranslate"><span class="pre">__cached__</span></code> 已被弃用，在 Python 3.14 中导入系统将不再设置或考虑这些属性。 （由 Brett Cannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/65961">gh-65961</a><span class="link-target"> [https://github.com/python/cpython/issues/65961]</span> 中贡献。）</p></li>
<li><p>对布尔值的位取反运算符 (<code class="docutils literal notranslate"><span class="pre">~</span></code>) 已被弃用。 它在 Python 3.14 中将抛出错误。 请改用 <code class="docutils literal notranslate"><span class="pre">not</span></code> 来执行布尔值的逻辑非运算。 在你确实需要对下层的 <code class="docutils literal notranslate"><span class="pre">int</span></code> 执行按位取反运算的少数场景下，请显式地将其转换为整数值: <code class="docutils literal notranslate"><span class="pre">~int(x)</span></code>。 （由 Tim Hoffmann 在 <a class="reference external" href="https://github.com/python/cpython/issues/103487">gh-103487</a><span class="link-target"> [https://github.com/python/cpython/issues/103487]</span> 中贡献。）</p></li>
<li><p>在代码对象上对 <a class="reference internal" href="../reference/datamodel.xhtml#codeobject.co_lnotab" title="codeobject.co_lnotab"><code class="xref py py-attr docutils literal notranslate"><span class="pre">co_lnotab</span></code></a> 的访问自 Python 3.10 起已通过 <span class="target" id="index-128"></span><a class="pep reference external" href="https://peps.python.org/pep-0626/"><strong>PEP 626</strong></a><span class="link-target"> [https://peps.python.org/pep-0626/]</span> 被弃用，但直到 3.12 才添加了适当的 <a class="reference internal" href="../library/exceptions.xhtml#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>，因而它将在 3.14 中被移除。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/101866">gh-101866</a><span class="link-target"> [https://github.com/python/cpython/issues/101866]</span> 中贡献。）</p></li>
</ul>
<section id="pending-removal-in-python-3-13">
<h3>计划在 Python 3.13 中移除</h3>
<p>以下模块和 API 已在之前的 Python 发布版中弃用，并将在 Python 3.13 中移除。</p>
<p>模块 (参见 <span class="target" id="index-129"></span><a class="pep reference external" href="https://peps.python.org/pep-0594/"><strong>PEP 594</strong></a><span class="link-target"> [https://peps.python.org/pep-0594/]</span>):</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/aifc.xhtml#module-aifc" title="aifc: Read and write audio files in AIFF or AIFC format.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aifc</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/audioop.xhtml#module-audioop" title="audioop: Manipulate raw audio data.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">audioop</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/cgi.xhtml#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgi</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/cgitb.xhtml#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cgitb</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/chunk.xhtml#module-chunk" title="chunk: Module to read IFF chunks.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">chunk</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/crypt.xhtml#module-crypt" title="crypt: The crypt() function used to check Unix passwords.（已弃用） (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">crypt</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/imghdr.xhtml#module-imghdr" title="imghdr: Determine the type of image contained in a file or byte stream.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imghdr</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/mailcap.xhtml#module-mailcap" title="mailcap: Mailcap file handling.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mailcap</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/msilib.xhtml#module-msilib" title="msilib: Creation of Microsoft Installer files, and CAB files.（已弃用） (Windows)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">msilib</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/nis.xhtml#module-nis" title="nis: Interface to Sun's NIS (Yellow Pages) library.（已弃用） (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nis</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/nntplib.xhtml#module-nntplib" title="nntplib: NNTP protocol client (requires sockets).（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nntplib</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/ossaudiodev.xhtml#module-ossaudiodev" title="ossaudiodev: Access to OSS-compatible audio devices.（已弃用） (Linux, FreeBSD)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ossaudiodev</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/pipes.xhtml#module-pipes" title="pipes: A Python interface to Unix shell pipelines.（已弃用） (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pipes</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/sndhdr.xhtml#module-sndhdr" title="sndhdr: Determine type of a sound file.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sndhdr</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/spwd.xhtml#module-spwd" title="spwd: The shadow password database (getspnam() and friends).（已弃用） (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">spwd</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/sunau.xhtml#module-sunau" title="sunau: Provide an interface to the Sun AU sound format.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sunau</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/telnetlib.xhtml#module-telnetlib" title="telnetlib: Telnet client class.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">telnetlib</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/uu.xhtml#module-uu" title="uu: Encode and decode files in uuencode format.（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">uu</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/xdrlib.xhtml#module-xdrlib" title="xdrlib: Encoders and decoders for the External Data Representation (XDR).（已弃用）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">xdrlib</span></code></a></p></li>
</ul>
<p>其他模块：</p>
<ul class="simple">
<li><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">lib2to3</span></code>，以及 <strong class="program">2to3</strong> 程序 (<a class="reference external" href="https://github.com/python/cpython/issues/84540">gh-84540</a><span class="link-target"> [https://github.com/python/cpython/issues/84540]</span>)</p></li>
</ul>
<p>API:</p>
<ul>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">configparser.LegacyInterpolation</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/90765">gh-90765</a><span class="link-target"> [https://github.com/python/cpython/issues/90765]</span>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">locale.resetlocale()</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/90817">gh-90817</a><span class="link-target"> [https://github.com/python/cpython/issues/90817]</span>)</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">turtle.RawTurtle.settiltangle()</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/50096">gh-50096</a><span class="link-target"> [https://github.com/python/cpython/issues/50096]</span>)</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">unittest.findTestCases()</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/50096">gh-50096</a><span class="link-target"> [https://github.com/python/cpython/issues/50096]</span>)</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">unittest.getTestCaseNames()</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/50096">gh-50096</a><span class="link-target"> [https://github.com/python/cpython/issues/50096]</span>)</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">unittest.makeSuite()</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/50096">gh-50096</a><span class="link-target"> [https://github.com/python/cpython/issues/50096]</span>)</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">unittest.TestProgram.usageExit()</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/67048">gh-67048</a><span class="link-target"> [https://github.com/python/cpython/issues/67048]</span>)</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">webbrowser.MacOSX</span></code> (<a class="reference external" href="https://github.com/python/cpython/issues/86421">gh-86421</a><span class="link-target"> [https://github.com/python/cpython/issues/86421]</span>)</p></li>
<li><p><a class="reference internal" href="../library/functions.xhtml#classmethod" title="classmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">classmethod</span></code></a> 描述器串联 (<a class="reference external" href="https://github.com/python/cpython/issues/89519">gh-89519</a><span class="link-target"> [https://github.com/python/cpython/issues/89519]</span>)</p></li>
<li><p><a class="reference internal" href="../library/importlib.resources.xhtml#module-importlib.resources" title="importlib.resources: Package resource reading, opening, and access"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.resources</span></code></a> 中已弃用的方法：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contents()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_resource()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">open_binary()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">open_text()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_binary()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_text()</span></code></p></li>
</ul>
<p>请改用 <a class="reference internal" href="../library/importlib.resources.xhtml#importlib.resources.files" title="importlib.resources.files"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.resources.files()</span></code></a>。 参见 <a class="reference external" href="https://importlib-resources.readthedocs.io/en/latest/using.html#migrating-from-legacy">importlib-resources: Migrating from Legacy</a><span class="link-target"> [https://importlib-resources.readthedocs.io/en/latest/using.html#migrating-from-legacy]</span> (<a class="reference external" href="https://github.com/python/cpython/issues/106531">gh-106531</a><span class="link-target"> [https://github.com/python/cpython/issues/106531]</span>)</p>
</li>
</ul>
</section>
<section id="pending-removal-in-python-3-14">
<h3>计划在 Python 3.14 中移除</h3>
<p>以下 API 已被弃用并将在 Python 3.14 中移除。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/argparse.xhtml#module-argparse" title="argparse: Command-line option and argument parsing library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a>: <code class="xref py py-class docutils literal notranslate"><span class="pre">argparse.BooleanOptionalAction</span></code> 的 <em>type</em>, <em>choices</em> 和 <em>metavar</em> 形参</p></li>
<li><p><a class="reference internal" href="../library/ast.xhtml#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a>:</p>
<ul>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Num</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Str</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Bytes</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.NameConstant</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.Ellipsis</span></code></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a>:</p>
<ul>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.MultiLoopChildWatcher</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.FastChildWatcher</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.AbstractChildWatcher</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.SafeChildWatcher</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.set_child_watcher()</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_child_watcher()</span></code>,</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoopPolicy.set_child_watcher()</span></code></p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoopPolicy.get_child_watcher()</span></code></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/collections.abc.xhtml#module-collections.abc" title="collections.abc: Abstract base classes for containers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a>: <code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.ByteString</span></code>。</p></li>
<li><p><a class="reference internal" href="../library/email.xhtml#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code></a>: <a class="reference internal" href="../library/email.utils.xhtml#email.utils.localtime" title="email.utils.localtime"><code class="xref py py-func docutils literal notranslate"><span class="pre">email.utils.localtime()</span></code></a> 中的 <em>isdst</em> 形参。</p></li>
<li><p><a class="reference internal" href="../library/importlib.xhtml#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.abc</span></code></a>:</p>
<ul>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.ResourceReader</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.Traversable</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.TraversableResources</span></code></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/itertools.xhtml#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code class="xref py py-mod docutils literal notranslate"><span class="pre">itertools</span></code></a>: 对 copy, deepcopy 和 pickle 操作的支持。</p></li>
<li><p><a class="reference internal" href="../library/pkgutil.xhtml#module-pkgutil" title="pkgutil: Utilities for the import system."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkgutil</span></code></a>:</p>
<ul>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">pkgutil.find_loader()</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">pkgutil.get_loader()</span></code>。</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/pty.xhtml#module-pty" title="pty: Pseudo-Terminal Handling for Unix. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pty</span></code></a>:</p>
<ul>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">pty.master_open()</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">pty.slave_open()</span></code></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../library/shutil.xhtml#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a>: <a class="reference internal" href="../library/shutil.xhtml#shutil.rmtree" title="shutil.rmtree"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.rmtree()</span></code></a> 的 <em>onerror</em> 参数</p></li>
<li><p><a class="reference internal" href="../library/typing.xhtml#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a>: <code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ByteString</span></code></p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.xhtml#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a>: 对 <a class="reference internal" href="../library/xml.etree.elementtree.xhtml#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">xml.etree.ElementTree.Element</span></code></a> 的真值测试。</p></li>
<li><p>模块对象上的 <code class="docutils literal notranslate"><span class="pre">__package__</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__cached__</span></code> 属性。</p></li>
<li><p>代码对象的 <a class="reference internal" href="../reference/datamodel.xhtml#codeobject.co_lnotab" title="codeobject.co_lnotab"><code class="xref py py-attr docutils literal notranslate"><span class="pre">co_lnotab</span></code></a> 属性。</p></li>
</ul>
</section>
<section id="pending-removal-in-python-3-15">
<h3>Python 3.15 中的待移除功能</h3>
<p>以下 API 已被弃用并将在 Python 3.15 中移除。</p>
<p>API:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/locale.xhtml#locale.getdefaultlocale" title="locale.getdefaultlocale"><code class="xref py py-func docutils literal notranslate"><span class="pre">locale.getdefaultlocale()</span></code></a> (<a class="reference external" href="https://github.com/python/cpython/issues/90817">gh-90817</a><span class="link-target"> [https://github.com/python/cpython/issues/90817]</span>)</p></li>
</ul>
</section>
<section id="pending-removal-in-future-versions">
<h3>计划在未来版本中移除</h3>
<p>下列 API 在更早的 Python 版本中已被弃用并将被移除，但目前还没有确定它们的移除日期。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/array.xhtml#module-array" title="array: Space efficient arrays of uniformly typed numeric values."><code class="xref py py-mod docutils literal notranslate"><span class="pre">array</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">'u'</span></code> 格式代码 (<a class="reference external" href="https://github.com/python/cpython/issues/57281">gh-57281</a><span class="link-target"> [https://github.com/python/cpython/issues/57281]</span>)</p></li>
<li><p><a class="reference internal" href="../library/typing.xhtml#typing.Text" title="typing.Text"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Text</span></code></a> (<a class="reference external" href="https://github.com/python/cpython/issues/92332">gh-92332</a><span class="link-target"> [https://github.com/python/cpython/issues/92332]</span>)</p></li>
<li><p>目前 Python 接受数字类字面值后面紧跟关键字的写法，例如 <code class="docutils literal notranslate"><span class="pre">0in</span> <span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">1or</span> <span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">0if</span> <span class="pre">1else</span> <span class="pre">2</span></code>。 它将允许像 <code class="docutils literal notranslate"><span class="pre">[0x1for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> 这样令人困惑且模棱两可的表达式 (它可以被解读为 <code class="docutils literal notranslate"><span class="pre">[0x1</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">[0x1f</span> <span class="pre">or</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code>)。 从本发布版开始，如果数字类字面值后面紧跟关键字 <a class="reference internal" href="../reference/expressions.xhtml#and"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">and</span></code></a>, <a class="reference internal" href="../reference/compound_stmts.xhtml#else"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">else</span></code></a>, <a class="reference internal" href="../reference/compound_stmts.xhtml#for"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">for</span></code></a>, <a class="reference internal" href="../reference/compound_stmts.xhtml#if"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">if</span></code></a>, <a class="reference internal" href="../reference/expressions.xhtml#in"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">in</span></code></a>, <a class="reference internal" href="../reference/expressions.xhtml#is"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">is</span></code></a> 和 <a class="reference internal" href="../reference/expressions.xhtml#or"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">or</span></code></a> 中的一个将会引发弃用警告。 在未来的版本中它将改为语法警告，最终将改为语法错误。 (<a class="reference external" href="https://github.com/python/cpython/issues/87999">gh-87999</a><span class="link-target"> [https://github.com/python/cpython/issues/87999]</span>)</p></li>
</ul>
</section>
</section>
<section id="removed">
<h2>移除</h2>
<section id="asynchat-and-asyncore">
<h3>asynchat 和 asyncore</h3>
<ul class="simple">
<li><p>这两个模块已根据 <span class="target" id="index-130"></span><a class="pep reference external" href="https://peps.python.org/pep-0594/"><strong>PEP 594</strong></a><span class="link-target"> [https://peps.python.org/pep-0594/]</span> 中的时间表被移除，它们从 Python 3.6 起已被弃用。 请改用 <a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a>。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/96580">gh-96580</a><span class="link-target"> [https://github.com/python/cpython/issues/96580]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="configparser">
<h3>configparser</h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/configparser.xhtml#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> 中的几个从 3.2 起已被弃用的名称已根据 <a class="reference external" href="https://github.com/python/cpython/issues/89336">gh-89336</a><span class="link-target"> [https://github.com/python/cpython/issues/89336]</span> 被移除：</p>
<ul>
<li><p><a class="reference internal" href="../library/configparser.xhtml#configparser.ParsingError" title="configparser.ParsingError"><code class="xref py py-class docutils literal notranslate"><span class="pre">configparser.ParsingError</span></code></a> 不再具有 <code class="docutils literal notranslate"><span class="pre">filename</span></code> 属性或参数。 请改用 <code class="docutils literal notranslate"><span class="pre">source</span></code> 属性和参数。</p></li>
<li><p><a class="reference internal" href="../library/configparser.xhtml#module-configparser" title="configparser: Configuration file parser."><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> 不再具有 <code class="docutils literal notranslate"><span class="pre">SafeConfigParser</span></code> 类。 请改用更简短的名称 <a class="reference internal" href="../library/configparser.xhtml#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a>。</p></li>
<li><p><a class="reference internal" href="../library/configparser.xhtml#configparser.ConfigParser" title="configparser.ConfigParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">configparser.ConfigParser</span></code></a> 不再具有 <code class="docutils literal notranslate"><span class="pre">readfp</span></code> 方法。 请改用 <a class="reference internal" href="../library/configparser.xhtml#configparser.ConfigParser.read_file" title="configparser.ConfigParser.read_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read_file()</span></code></a>。</p></li>
</ul>
</li>
</ul>
</section>
<section id="distutils">
<h3>distutils</h3>
<ul class="simple">
<li><p>移除了 <code class="xref py py-mod docutils literal notranslate"><span class="pre">distutils</span></code> 包。 它已在 Python 3.10 中根据 <span class="target" id="index-131"></span><a class="pep reference external" href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a><span class="link-target"> [https://peps.python.org/pep-0632/]</span> &quot;Deprecate distutils module&quot; 被弃用。 对于仍然使用 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 且无法升级为使用其他工具的项目，可以安装 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 项目：它仍然提供了 <code class="docutils literal notranslate"><span class="pre">distutils</span></code>。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/92584">gh-92584</a><span class="link-target"> [https://github.com/python/cpython/issues/92584]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="ensurepip">
<h3>ensurepip</h3>
<ul>
<li><p>从 <a class="reference internal" href="../library/ensurepip.xhtml#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code></a> 中移除了捆绑的 setuptools wheel，并停止在由 <a class="reference internal" href="../library/venv.xhtml#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> 创建的环境中安装 setuptools。</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">(&gt;=</span> <span class="pre">22.1)</span></code> 不再要求在环境中安装 setuptools。 基于 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> (和基于 <code class="docutils literal notranslate"><span class="pre">distutils</span></code>) 的包仍然可通过 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> 来使用，因为 pip 将在它用于构建包的构建环境中提供 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>。</p>
<p>在默认情况下由 <code class="docutils literal notranslate"><span class="pre">venv</span></code> 创建或通过 <code class="docutils literal notranslate"><span class="pre">ensurepip</span></code> 初始化的环境将不再提供 <code class="docutils literal notranslate"><span class="pre">easy_install</span></code>, <code class="docutils literal notranslate"><span class="pre">pkg_resources</span></code>, <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 和 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 包，因为它们是 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 包的组成部分。 对于在运行时依赖这些包的项目，应当将 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 项目声明为依赖项之一并单独安装（通常是使用 pip）。</p>
<p>（由 Pradyun Gedam 在 <a class="reference external" href="https://github.com/python/cpython/issues/95299">gh-95299</a><span class="link-target"> [https://github.com/python/cpython/issues/95299]</span> 中贡献。）</p>
</li>
</ul>
</section>
<section id="enum">
<h3>enum</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/enum.xhtml#module-enum" title="enum: Implementation of an enumeration class."><code class="xref py py-mod docutils literal notranslate"><span class="pre">enum</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">EnumMeta.__getattr__</span></code>，枚举属性访问已不再需要它。 （由 Ethan Furman 在 <a class="reference external" href="https://github.com/python/cpython/issues/95083">gh-95083</a><span class="link-target"> [https://github.com/python/cpython/issues/95083]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="ftplib">
<h3>ftplib</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/ftplib.xhtml#module-ftplib" title="ftplib: FTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ftplib</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">FTP_TLS.ssl_version</span></code> 类属性：请改用 <em>context</em> 形参。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94172">gh-94172</a><span class="link-target"> [https://github.com/python/cpython/issues/94172]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="gzip">
<h3>gzip</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/gzip.xhtml#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a> 中 <a class="reference internal" href="../library/gzip.xhtml#gzip.GzipFile" title="gzip.GzipFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">gzip.GzipFile</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">filename</span></code> 属性，自 Python 2.6 起该属性已被弃用，请改用 <a class="reference internal" href="../library/gzip.xhtml#gzip.GzipFile.name" title="gzip.GzipFile.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a> 属性。 在可写模式下，如果 <code class="docutils literal notranslate"><span class="pre">filename</span></code> 属性没有 <code class="docutils literal notranslate"><span class="pre">'.gz'</span></code> 文件扩展名则会添加它。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94196">gh-94196</a><span class="link-target"> [https://github.com/python/cpython/issues/94196]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="hashlib">
<h3>hashlib</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/hashlib.xhtml#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code class="xref py py-mod docutils literal notranslate"><span class="pre">hashlib</span></code></a> 中 <a class="reference internal" href="../library/hashlib.xhtml#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code class="xref py py-func docutils literal notranslate"><span class="pre">hashlib.pbkdf2_hmac()</span></code></a> 的纯 Python 实现，它在 Python 3.10 中已被弃用。 Python 3.10 及更新版本需要 OpenSSL 1.1.1 (<span class="target" id="index-132"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a><span class="link-target"> [https://peps.python.org/pep-0644/]</span>)：该 OpenSSL 版本提供了 <a class="reference internal" href="../library/hashlib.xhtml#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code class="xref py py-func docutils literal notranslate"><span class="pre">pbkdf2_hmac()</span></code></a> 的更快速的 C 实现。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94199">gh-94199</a><span class="link-target"> [https://github.com/python/cpython/issues/94199]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="importlib">
<h3>importlib</h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/importlib.xhtml#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> 中许多先前已弃用对象的清理工作现已完成：</p>
<ul>
<li><p>对 <code class="xref py py-meth docutils literal notranslate"><span class="pre">module_repr()</span></code> 的引用和支持已被移除。 （由 Barry Warsaw 在 <a class="reference external" href="https://github.com/python/cpython/issues/97850">gh-97850</a><span class="link-target"> [https://github.com/python/cpython/issues/97850]</span> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">importlib.util.set_package</span></code>, <code class="docutils literal notranslate"><span class="pre">importlib.util.set_loader</span></code> 和 <code class="docutils literal notranslate"><span class="pre">importlib.util.module_for_loader</span></code> 均已被移除。 （由 Brett Cannon 和 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/65961">gh-65961</a><span class="link-target"> [https://github.com/python/cpython/issues/65961]</span> 和 <a class="reference external" href="https://github.com/python/cpython/issues/97850">gh-97850</a><span class="link-target"> [https://github.com/python/cpython/issues/97850]</span> 中贡献。）</p></li>
<li><p>对 <code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">find_module()</span></code> API 的支持已被移除。 （由 Barry Warsaw 在 <a class="reference external" href="https://github.com/python/cpython/issues/98040">gh-98040</a><span class="link-target"> [https://github.com/python/cpython/issues/98040]</span> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">importlib.abc.Finder</span></code>, <code class="docutils literal notranslate"><span class="pre">pkgutil.ImpImporter</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pkgutil.ImpLoader</span></code> 已被移除。 （由 Barry Warsaw 在 <a class="reference external" href="https://github.com/python/cpython/issues/98040">gh-98040</a><span class="link-target"> [https://github.com/python/cpython/issues/98040]</span> 中贡献。）</p></li>
</ul>
</li>
</ul>
</section>
<section id="imp">
<h3>imp</h3>
<ul>
<li><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code> 模块已被移除。 （由 Barry Warsaw 在 <a class="reference external" href="https://github.com/python/cpython/issues/98040">gh-98040</a><span class="link-target"> [https://github.com/python/cpython/issues/98040]</span> 中贡献。）</p>
<p>要进行迁移，请参考以下对照表：</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>imp</p></th>
<th class="head"><p>importlib</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">imp.NullImporter</span></code></p></td>
<td><p>将 <code class="docutils literal notranslate"><span class="pre">None</span></code> 插入到 <code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">imp.cache_from_source()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.util.cache_from_source" title="importlib.util.cache_from_source"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.cache_from_source()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">imp.find_module()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.util.find_spec" title="importlib.util.find_spec"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.find_spec()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">imp.get_magic()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.util.MAGIC_NUMBER" title="importlib.util.MAGIC_NUMBER"><code class="xref py py-attr docutils literal notranslate"><span class="pre">importlib.util.MAGIC_NUMBER</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">imp.get_suffixes()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.machinery.SOURCE_SUFFIXES" title="importlib.machinery.SOURCE_SUFFIXES"><code class="xref py py-attr docutils literal notranslate"><span class="pre">importlib.machinery.SOURCE_SUFFIXES</span></code></a>, <a class="reference internal" href="../library/importlib.xhtml#importlib.machinery.EXTENSION_SUFFIXES" title="importlib.machinery.EXTENSION_SUFFIXES"><code class="xref py py-attr docutils literal notranslate"><span class="pre">importlib.machinery.EXTENSION_SUFFIXES</span></code></a> 和 <a class="reference internal" href="../library/importlib.xhtml#importlib.machinery.BYTECODE_SUFFIXES" title="importlib.machinery.BYTECODE_SUFFIXES"><code class="xref py py-attr docutils literal notranslate"><span class="pre">importlib.machinery.BYTECODE_SUFFIXES</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">imp.get_tag()</span></code></p></td>
<td><p><a class="reference internal" href="../library/sys.xhtml#sys.implementation" title="sys.implementation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.implementation.cache_tag</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">imp.load_module()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.import_module" title="importlib.import_module"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.import_module()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">imp.new_module(name)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">types.ModuleType(name)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">imp.reload()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.reload" title="importlib.reload"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.reload()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">imp.source_from_cache()</span></code></p></td>
<td><p><a class="reference internal" href="../library/importlib.xhtml#importlib.util.source_from_cache" title="importlib.util.source_from_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.source_from_cache()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">imp.load_source()</span></code></p></td>
<td><p><em>见下文</em></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>将 <code class="docutils literal notranslate"><span class="pre">imp.load_source()</span></code> 替换为:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">importlib.machinery</span>

<span class="k">def</span> <span class="nf">load_source</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="n">loader</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="c1"># The module is always executed and not cached in sys.modules.</span>
    <span class="c1"># Uncomment the following line to cache the module.</span>
    <span class="c1"># sys.modules[module.__name__] = module</span>
    <span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span>
</pre></div>
</div>
</li>
<li><p>已移除 <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code> 的函数和属性并且没有替代选项:</p>
<ul class="simple">
<li><p>未写入文档的函数：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">imp.init_builtin()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imp.load_compiled()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imp.load_dynamic()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imp.load_package()</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">imp.lock_held()</span></code>,``imp.acquire_lock()``,``imp.release_lock()``: 加锁方案在 Python 3.3 中已改为模块级锁。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imp.find_module()</span></code> 常量: <code class="docutils literal notranslate"><span class="pre">SEARCH_ERROR</span></code>, <code class="docutils literal notranslate"><span class="pre">PY_SOURCE</span></code>, <code class="docutils literal notranslate"><span class="pre">PY_COMPILED</span></code>, <code class="docutils literal notranslate"><span class="pre">C_EXTENSION</span></code>, <code class="docutils literal notranslate"><span class="pre">PY_RESOURCE</span></code>, <code class="docutils literal notranslate"><span class="pre">PKG_DIRECTORY</span></code>, <code class="docutils literal notranslate"><span class="pre">C_BUILTIN</span></code>, <code class="docutils literal notranslate"><span class="pre">PY_FROZEN</span></code>, <code class="docutils literal notranslate"><span class="pre">PY_CODERESOURCE</span></code>, <code class="docutils literal notranslate"><span class="pre">IMP_HOOK</span></code>。</p></li>
</ul>
</li>
</ul>
</section>
<section id="io">
<h3>io</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/io.xhtml#module-io" title="io: Core tools for working with streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">io</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">io.OpenWrapper</span></code> 和 <code class="docutils literal notranslate"><span class="pre">_pyio.OpenWrapper</span></code>，它们在 Python 3.10 中已被弃用：请改用 <a class="reference internal" href="../library/functions.xhtml#open" title="open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a>。  <a class="reference internal" href="../library/functions.xhtml#open" title="open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> (<a class="reference internal" href="../library/io.xhtml#io.open" title="io.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">io.open()</span></code></a>) 函数是一个内置函数。 自 Python 3.10 起，<code class="xref py py-func docutils literal notranslate"><span class="pre">_pyio.open()</span></code> 也是一个静态方法。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94169">gh-94169</a><span class="link-target"> [https://github.com/python/cpython/issues/94169]</span> 中贡献。）.)</p></li>
</ul>
</section>
<section id="locale">
<h3>locale</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/locale.xhtml#module-locale" title="locale: Internationalization services."><code class="xref py py-mod docutils literal notranslate"><span class="pre">locale</span></code></a> 的 <code class="xref py py-func docutils literal notranslate"><span class="pre">locale.format()</span></code> 函数，它在 Python 3.7 中已被弃用：请改用 <a class="reference internal" href="../library/locale.xhtml#locale.format_string" title="locale.format_string"><code class="xref py py-func docutils literal notranslate"><span class="pre">locale.format_string()</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94226">gh-94226</a><span class="link-target"> [https://github.com/python/cpython/issues/94226]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="smtpd">
<h3>smtpd</h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">smtpd</span></code> 模块已按照 <span class="target" id="index-133"></span><a class="pep reference external" href="https://peps.python.org/pep-0594/"><strong>PEP 594</strong></a><span class="link-target"> [https://peps.python.org/pep-0594/]</span> 中的计划表被移除，它在 Python 3.4.7 和 3.5.4 中已被弃用。 请改用 <a class="reference external" href="https://pypi.org/project/aiosmtpd/">aiosmtpd</a><span class="link-target"> [https://pypi.org/project/aiosmtpd/]</span> PyPI 模块或任何其他基于 <a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 的服务器。 （由 Oleg Iarygin 在 <a class="reference external" href="https://github.com/python/cpython/issues/93243">gh-93243</a><span class="link-target"> [https://github.com/python/cpython/issues/93243]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="id2">
<h3>sqlite3</h3>
<ul>
<li><p>以下未写入文档的 <a class="reference internal" href="../library/sqlite3.xhtml#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a> 特性，在 Python 3.10 中已被弃用，现在已被移除：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sqlite3.enable_shared_cache()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlite3.OptimizedUnicode</span></code></p></li>
</ul>
<p>如果必须使用共享缓存，请在以 URI 模式打开数据库时使用 <code class="docutils literal notranslate"><span class="pre">cache=shared</span></code> 查询参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">sqlite3.OptimizedUnicode</span></code> 文本工厂函数自 Python 3.3 起已成为 <a class="reference internal" href="../library/stdtypes.xhtml#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 的一个别名。 之前将文本工厂设为 <code class="docutils literal notranslate"><span class="pre">OptimizedUnicode</span></code> 的代码可以显式地使用 <code class="docutils literal notranslate"><span class="pre">str</span></code>，或者依赖同样为 <code class="docutils literal notranslate"><span class="pre">str</span></code> 的默认值。</p>
<p>（由 Erlend E. Aasland 在 <a class="reference external" href="https://github.com/python/cpython/issues/92548">gh-92548</a><span class="link-target"> [https://github.com/python/cpython/issues/92548]</span> 中贡献。）</p>
</li>
</ul>
</section>
<section id="ssl">
<h3>ssl</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/ssl.xhtml#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> 的 <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.RAND_pseudo_bytes()</span></code> 函数，它在 Python 3.6 中已被弃用：请改用 <a class="reference internal" href="../library/os.xhtml#os.urandom" title="os.urandom"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.urandom()</span></code></a> 或 <a class="reference internal" href="../library/ssl.xhtml#ssl.RAND_bytes" title="ssl.RAND_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.RAND_bytes()</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94199">gh-94199</a><span class="link-target"> [https://github.com/python/cpython/issues/94199]</span> 中贡献。）</p></li>
<li><p>移除了 <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.match_hostname()</span></code> 函数。 它在 Python 3.7 中已被弃用。 OpenSSL 自 Python 3.7 起将会执行主机名匹配，Python 已不再使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.match_hostname()</span></code> 函数。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94199">gh-94199</a><span class="link-target"> [https://github.com/python/cpython/issues/94199]</span> 中贡献。）</p></li>
<li><p>移除了 <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.wrap_socket()</span></code> 函数，它在 Python 3.7 中已被弃用：应改为创建一个 <a class="reference internal" href="../library/ssl.xhtml#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> 对象并调用其 <a class="reference internal" href="../library/ssl.xhtml#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext.wrap_socket</span></code></a> 方法。 任何仍然使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.wrap_socket()</span></code> 的包都是已不适用且不安全的。 该函数既不会发送 SNI TLS 扩展也不会验证服务器主机名。 其代码会受到 <a class="reference external" href="https://cwe.mitre.org/data/definitions/295.html">CWE-295</a><span class="link-target"> [https://cwe.mitre.org/data/definitions/295.html]</span> (Improper Certificate Validation) 的影响。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94199">gh-94199</a><span class="link-target"> [https://github.com/python/cpython/issues/94199]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="id3">
<h3>unittest</h3>
<ul>
<li><p>移除了许多早已弃用的 <a class="reference internal" href="../library/unittest.xhtml#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 特性：</p>
<ul id="unittest-testcase-removed-aliases">
<li><p>一些 <a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></a> 方法的别名:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>已弃用的别名</p></th>
<th class="head"><p>方法名</p></th>
<th class="head"><p>弃用于</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failUnless</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertTrue()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">failIf</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertFalse" title="unittest.TestCase.assertFalse"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertFalse()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failUnlessEqual</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">failIfEqual</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertNotEqual" title="unittest.TestCase.assertNotEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failUnlessAlmostEqual</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertAlmostEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">failIfAlmostEqual</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotAlmostEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failUnlessRaises</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertRaises" title="unittest.TestCase.assertRaises"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRaises()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">assert_</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertTrue()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assertEquals</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">assertNotEquals</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertNotEqual" title="unittest.TestCase.assertNotEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assertAlmostEquals</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertAlmostEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">assertNotAlmostEquals</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotAlmostEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assertRegexpMatches</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertRegex" title="unittest.TestCase.assertRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRegex()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">assertRaisesRegexp</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertRaisesRegex" title="unittest.TestCase.assertRaisesRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRaisesRegex()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assertNotRegexpMatches</span></code></p></td>
<td><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase.assertNotRegex" title="unittest.TestCase.assertNotRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNotRegex()</span></code></a></p></td>
<td><p>3.5</p></td>
</tr>
</tbody>
</table>
<p>您可以使用 <a class="reference external" href="https://github.com/isidentical/teyit">https://github.com/isidentical/teyit</a> 来自动更新你的单元测试。</p>
</li>
<li><p>未写入文档且已不可用的 <a class="reference internal" href="../library/unittest.xhtml#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></a> 方法 <code class="docutils literal notranslate"><span class="pre">assertDictContainsSubset</span></code>。 （在 Python 3.2 中已弃用。）</p></li>
<li><p>未写入文档的 <a class="reference internal" href="../library/unittest.xhtml#unittest.TestLoader.loadTestsFromModule" title="unittest.TestLoader.loadTestsFromModule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TestLoader.loadTestsFromModule</span></code></a> 形参 <em>use_load_tests</em>。 （自 Python 3.5 起已弃用并会被忽略。）</p></li>
<li><p><a class="reference internal" href="../library/unittest.xhtml#unittest.TextTestResult" title="unittest.TextTestResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextTestResult</span></code></a> 类的一个别名: <code class="docutils literal notranslate"><span class="pre">_TextTestResult</span></code>。 （在 Python 3.2 中已弃用。）</p></li>
</ul>
<p>（由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/89325">gh-89325</a><span class="link-target"> [https://github.com/python/cpython/issues/89325]</span> 中贡献。）</p>
</li>
</ul>
</section>
<section id="webbrowser">
<h3>webbrowser</h3>
<ul class="simple">
<li><p>从 <a class="reference internal" href="../library/webbrowser.xhtml#module-webbrowser" title="webbrowser: Easy-to-use controller for web browsers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">webbrowser</span></code></a> 移除了对过时浏览器的支持。 被移除的浏览器包括：Grail、Mosaic、Netscape、Galeon、Skipstone、Iceape、Firebird 和 Firefox 35 及以下的版本 (<a class="reference external" href="https://github.com/python/cpython/issues/102871">gh-102871</a><span class="link-target"> [https://github.com/python/cpython/issues/102871]</span>)。</p></li>
</ul>
</section>
<section id="xml-etree-elementtree">
<h3>xml.etree.ElementTree</h3>
<ul class="simple">
<li><p>移除了纯 Python 实现的 <code class="docutils literal notranslate"><span class="pre">ElementTree.Element.copy()</span></code> 方法，该方法在 Python 3.10 中已被弃用，请改用 <a class="reference internal" href="../library/copy.xhtml#copy.copy" title="copy.copy"><code class="xref py py-func docutils literal notranslate"><span class="pre">copy.copy()</span></code></a> 函数。 <a class="reference internal" href="../library/xml.etree.elementtree.xhtml#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> 的 C 实现没有 <code class="docutils literal notranslate"><span class="pre">copy()</span></code> 方法，只有 <code class="docutils literal notranslate"><span class="pre">__copy__()</span></code> 方法。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94383">gh-94383</a><span class="link-target"> [https://github.com/python/cpython/issues/94383]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="zipimport">
<h3>zipimport</h3>
<ul class="simple">
<li><p>移除了 <a class="reference internal" href="../library/zipimport.xhtml#module-zipimport" title="zipimport: Support for importing Python modules from ZIP archives."><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipimport</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">find_module()</span></code> 方法，它们在 Python 3.10 中已被弃用：请改用 <code class="docutils literal notranslate"><span class="pre">find_spec()</span></code> 方法。 请参阅 <span class="target" id="index-134"></span><a class="pep reference external" href="https://peps.python.org/pep-0451/"><strong>PEP 451</strong></a><span class="link-target"> [https://peps.python.org/pep-0451/]</span> 了解相关说明。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94379">gh-94379</a><span class="link-target"> [https://github.com/python/cpython/issues/94379]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="others">
<h3>其他事项</h3>
<ul class="simple">
<li><p>从文档 <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> 和 <code class="file docutils literal notranslate"><span class="pre">Doc/tools/rstlint.py</span></code> 中移除了 <code class="docutils literal notranslate"><span class="pre">suspicious</span></code> 规则，请改用 <a class="reference external" href="https://github.com/sphinx-contrib/sphinx-lint">sphinx-lint</a><span class="link-target"> [https://github.com/sphinx-contrib/sphinx-lint]</span>。 （由 Julien Palard 在 <a class="reference external" href="https://github.com/python/cpython/issues/98179">gh-98179</a><span class="link-target"> [https://github.com/python/cpython/issues/98179]</span> 中贡献。）</p></li>
<li><p>移除了 <a class="reference internal" href="../library/ftplib.xhtml#module-ftplib" title="ftplib: FTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ftplib</span></code></a>、<a class="reference internal" href="../library/imaplib.xhtml#module-imaplib" title="imaplib: IMAP4 protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">imaplib</span></code></a>、<a class="reference internal" href="../library/poplib.xhtml#module-poplib" title="poplib: POP3 protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">poplib</span></code></a> 和 <a class="reference internal" href="../library/smtplib.xhtml#module-smtplib" title="smtplib: SMTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">smtplib</span></code></a> 模块中的 <em>keyfile</em> 和 <em>certfile</em> 形参数，以及 <a class="reference internal" href="../library/http.client.xhtml#module-http.client" title="http.client: HTTP and HTTPS protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">http.client</span></code></a> 模块中的 <em>key_file</em>、<em>cert_file</em> 和 <em>check_hostname</em> 形参，它们自 Python 3.6 起都已被弃用。 请改用 <em>context</em> 形参（在 <a class="reference internal" href="../library/imaplib.xhtml#module-imaplib" title="imaplib: IMAP4 protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">imaplib</span></code></a> 中为 <em>ssl_context</em> 形参）。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94172">gh-94172</a><span class="link-target"> [https://github.com/python/cpython/issues/94172]</span> 中贡献。）.)</p></li>
<li><p>从多个标准库模块和测试中移除了 <code class="docutils literal notranslate"><span class="pre">Jython</span></code> 兼容性处理。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/99482">gh-99482</a><span class="link-target"> [https://github.com/python/cpython/issues/99482]</span> 中贡献。）</p></li>
<li><p>从 <a class="reference internal" href="../library/ctypes.xhtml#module-ctypes" title="ctypes: A foreign function library for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> 模块移除了 <code class="docutils literal notranslate"><span class="pre">_use_broken_old_ctypes_structure_semantics_</span></code> 旗标。 （由 Nikita Sobolev 在 <a class="reference external" href="https://github.com/python/cpython/issues/99285">gh-99285</a><span class="link-target"> [https://github.com/python/cpython/issues/99285]</span> 中贡献。）</p></li>
</ul>
</section>
</section>
<section id="porting-to-python-3-12">
<span id="whatsnew312-porting-to-python312"></span><h2>移植到 Python 3.12</h2>
<p>本节列出了先前描述的更改以及可能需要更改代码的其他错误修正.</p>
<section id="changes-in-the-python-api">
<h3>Python API 的变化</h3>
<ul>
<li><p>现在对于正则表达式中的数字分组引用和分组名称将应用更严格的规则。 现在只接受 ASCII 数字序列作为数字引用。 字节串模式和替换字符串中的分组名称现在只能包含 ASCII 字母、数字和下划线。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/91760">gh-91760</a><span class="link-target"> [https://github.com/python/cpython/issues/91760]</span> 中贡献。）</p></li>
<li><p>移除了自 Python 3.10 起已被弃用的 <code class="docutils literal notranslate"><span class="pre">randrange()</span></code> 功能。 以前，<code class="docutils literal notranslate"><span class="pre">randrange(10.0)</span></code> 会无损地转换为 <code class="docutils literal notranslate"><span class="pre">randrange(10)</span></code>。 现在，它将引发 <a class="reference internal" href="../library/exceptions.xhtml#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 此外，对于非整数值如 <code class="docutils literal notranslate"><span class="pre">randrange(10.5)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">randrange('10')</span></code> 所引发的异常已从 <a class="reference internal" href="../library/exceptions.xhtml#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> 改为 <a class="reference internal" href="../library/exceptions.xhtml#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 这也防止了 <code class="docutils literal notranslate"><span class="pre">randrange(1e25)</span></code> 会从比 <code class="docutils literal notranslate"><span class="pre">randrange(10**25)</span></code> 更大的范围中静默选择的问题。 （最初由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/86388">gh-86388</a><span class="link-target"> [https://github.com/python/cpython/issues/86388]</span> 中提议。）</p></li>
<li><p><a class="reference internal" href="../library/argparse.xhtml#argparse.ArgumentParser" title="argparse.ArgumentParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">argparse.ArgumentParser</span></code></a> 将从文件（例如 <code class="docutils literal notranslate"><span class="pre">fromfile_prefix_chars</span></code> 选项）读取参数的编码格式和错误处理器从默认的文本编码格式（例如 <a class="reference internal" href="../library/locale.xhtml#locale.getpreferredencoding" title="locale.getpreferredencoding"><code class="xref py py-func docutils literal notranslate"><span class="pre">locale.getpreferredencoding(False)</span></code></a> 调用）改为 <a class="reference internal" href="../glossary.xhtml#term-filesystem-encoding-and-error-handler"><span class="xref std std-term">filesystem encoding and error handler</span></a>。 在 Windows 系统中参数文件应使用 UTF-8 而不是 ANSI 代码页来编码。</p></li>
<li><p>移除了在 Python 3.4.7 和 3.5.4 中已被弃用的基于 <code class="docutils literal notranslate"><span class="pre">asyncore</span></code> 的 <code class="docutils literal notranslate"><span class="pre">smtpd</span></code> 模块。 推荐的替代是基于 <a class="reference internal" href="../library/asyncio.xhtml#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 的 <a class="reference external" href="https://pypi.org/project/aiosmtpd/">aiosmtpd</a><span class="link-target"> [https://pypi.org/project/aiosmtpd/]</span> PyPI 模块。</p></li>
<li><p><a class="reference internal" href="../library/shlex.xhtml#shlex.split" title="shlex.split"><code class="xref py py-func docutils literal notranslate"><span class="pre">shlex.split()</span></code></a>: 传入 <code class="docutils literal notranslate"><span class="pre">None</span></code> 作为 <em>s</em> 参数现在将引发异常，而不是读取 <a class="reference internal" href="../library/sys.xhtml#sys.stdin" title="sys.stdin"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdin</span></code></a>。 该特性在 Python 3.9 中已被弃用。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/94352">gh-94352</a><span class="link-target"> [https://github.com/python/cpython/issues/94352]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/os.xhtml#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> 模块不再接受类似字节串的路径，如 <a class="reference internal" href="../library/stdtypes.xhtml#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.xhtml#memoryview" title="memoryview"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> 类型：只接受明确的 <a class="reference internal" href="../library/stdtypes.xhtml#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 类型字节串。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/98393">gh-98393</a><span class="link-target"> [https://github.com/python/cpython/issues/98393]</span> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/syslog.xhtml#syslog.openlog" title="syslog.openlog"><code class="xref py py-func docutils literal notranslate"><span class="pre">syslog.openlog()</span></code></a> 和 <a class="reference internal" href="../library/syslog.xhtml#syslog.closelog" title="syslog.closelog"><code class="xref py py-func docutils literal notranslate"><span class="pre">syslog.closelog()</span></code></a> 如果在子解释器中使用将失败。 <a class="reference internal" href="../library/syslog.xhtml#syslog.syslog" title="syslog.syslog"><code class="xref py py-func docutils literal notranslate"><span class="pre">syslog.syslog()</span></code></a> 仍可在子解释器中使用，但前提是 <a class="reference internal" href="../library/syslog.xhtml#syslog.openlog" title="syslog.openlog"><code class="xref py py-func docutils literal notranslate"><span class="pre">syslog.openlog()</span></code></a> 已在主解释器中被调用。 这些新限制不适用于主解释器，因此只有少数用户可能会受到影响。 这一改变有助于实现解释器隔离。 此外，<a class="reference internal" href="../library/syslog.xhtml#module-syslog" title="syslog: An interface to the Unix syslog library routines. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">syslog</span></code></a> 是一个针对进程全局资源的包装器，而这些资源最好是由主解释器来管理。 （由 Donghee Na 在 <a class="reference external" href="https://github.com/python/cpython/issues/99127">gh-99127</a><span class="link-target"> [https://github.com/python/cpython/issues/99127]</span> 中贡献。）</p></li>
<li><p>未写入文档的 <a class="reference internal" href="../library/functools.xhtml#functools.cached_property" title="functools.cached_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">cached_property()</span></code></a> 的锁定行为已被移除，因为该行为会在类的所有实例中锁定，从而导致高锁定争用。 这意味着如果两个线程同时运行，缓存属性获取函数现在可以在单个实例中运行不止一次。 对于大多数简单的缓存属性（例如那些幂等的并且只需根据实例的其他属性计算一个值的属性）来说这是没有问题的。 如果需要同步，可在缓存属性获取函数中或多线程访问点周围实现锁定操作。</p></li>
<li><p>现在 <a class="reference internal" href="../library/sys.xhtml#sys._current_exceptions" title="sys._current_exceptions"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys._current_exceptions()</span></code></a> 将返回从线程 ID 到异常实例的映射，而不是到 <code class="docutils literal notranslate"><span class="pre">(typ,</span> <span class="pre">exc,</span> <span class="pre">tb)</span></code> 元组的映射。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/103176">gh-103176</a><span class="link-target"> [https://github.com/python/cpython/issues/103176]</span> 中贡献。）</p></li>
<li><p>当使用 <a class="reference internal" href="../library/tarfile.xhtml#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> 或 <a class="reference internal" href="../library/shutil.xhtml#shutil.unpack_archive" title="shutil.unpack_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.unpack_archive()</span></code></a> 提取 tar 文件时，请传入 <em>filter</em> 参数来限制可能令人感到意外或危险的特性。 请参阅 <a class="reference internal" href="../library/tarfile.xhtml#tarfile-extraction-filter"><span class="std std-ref">解压缩过滤器</span></a> 了解详情。</p></li>
<li><p>由于在 <span class="target" id="index-135"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span> 中引入的更改 <a class="reference internal" href="../library/tokenize.xhtml#tokenize.tokenize" title="tokenize.tokenize"><code class="xref py py-func docutils literal notranslate"><span class="pre">tokenize.tokenize()</span></code></a> 和 <a class="reference internal" href="../library/tokenize.xhtml#tokenize.generate_tokens" title="tokenize.generate_tokens"><code class="xref py py-func docutils literal notranslate"><span class="pre">tokenize.generate_tokens()</span></code></a> 函数的输出现在发生了改变。 这意味着不再为 f-字符输出 <code class="docutils literal notranslate"><span class="pre">STRING</span></code> 词元而是改为产生 <span class="target" id="index-136"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span> 中描述的词元：除了用于对表达式组件进行分词的适当词元外现在还有 <code class="docutils literal notranslate"><span class="pre">FSTRING_START</span></code>, <code class="docutils literal notranslate"><span class="pre">FSTRING_MIDDLE</span></code> 和 <code class="docutils literal notranslate"><span class="pre">FSTRING_END</span></code> 会被用于 f-字符串的“字符串”部分。 例如对于 f-字符串 <code class="docutils literal notranslate"><span class="pre">f&quot;start</span> <span class="pre">{1+1}</span> <span class="pre">end&quot;</span></code> 旧版本的分词器会生成:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">:</span>           <span class="n">STRING</span>         <span class="s1">&#39;f&quot;start {1+1} end&quot;&#39;</span>
</pre></div>
</div>
<p>而新版本将生成:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span>            <span class="n">FSTRING_START</span>  <span class="s1">&#39;f&quot;&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span>            <span class="n">FSTRING_MIDDLE</span> <span class="s1">&#39;start &#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">:</span>            <span class="n">OP</span>             <span class="s1">&#39;{&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span>           <span class="n">NUMBER</span>         <span class="s1">&#39;1&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">:</span>          <span class="n">OP</span>             <span class="s1">&#39;+&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span>          <span class="n">NUMBER</span>         <span class="s1">&#39;1&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">:</span>          <span class="n">OP</span>             <span class="s1">&#39;}&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">:</span>          <span class="n">FSTRING_MIDDLE</span> <span class="s1">&#39; end&#39;</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">:</span>          <span class="n">FSTRING_END</span>    <span class="s1">&#39;&quot;&#39;</span>
</pre></div>
</div>
<p>此外，支持 <span class="target" id="index-137"></span><a class="pep reference external" href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a><span class="link-target"> [https://peps.python.org/pep-0701/]</span> 所需的改变还可能会导致一些细微的行为改变。 这些变化包括:</p>
<ul class="simple">
<li><p>在对一些无效 Python 字符如 <code class="docutils literal notranslate"><span class="pre">!</span></code> 进行分词时相应词元的 <code class="docutils literal notranslate"><span class="pre">type</span></code> 属性已从 <code class="docutils literal notranslate"><span class="pre">ERRORTOKEN</span></code> 变为 <code class="docutils literal notranslate"><span class="pre">OP</span></code>。</p></li>
<li><p>不完整的单行字符串现在也会像不完整的多行字符串一样引发 <a class="reference internal" href="../library/tokenize.xhtml#tokenize.TokenError" title="tokenize.TokenError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tokenize.TokenError</span></code></a>。</p></li>
<li><p>某些不完整或无效的 Python 代码现在会引发 <a class="reference internal" href="../library/tokenize.xhtml#tokenize.TokenError" title="tokenize.TokenError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">tokenize.TokenError</span></code></a> 而不是在执行分词时返回任意的 <code class="docutils literal notranslate"><span class="pre">ERRORTOKEN</span></code> 词元。</p></li>
<li><p>在同一文件中混合使用制表符和空格作为缩进不再受到支持而是会引发 <a class="reference internal" href="../library/exceptions.xhtml#TabError" title="TabError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TabError</span></code></a>。</p></li>
</ul>
</li>
<li><p>现在 <a class="reference internal" href="../library/threading.xhtml#module-threading" title="threading: Thread-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> 模块会预期 <code class="xref py py-mod docutils literal notranslate"><span class="pre">_thread</span></code> 模块具有 <code class="docutils literal notranslate"><span class="pre">_is_main_interpreter</span></code> 属性。 它是一个不带参数的函数并会在当前解释器为主解释器时返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
<p>任何提供了自定义 <code class="docutils literal notranslate"><span class="pre">_thread</span></code> 模块的库或应用程序都应当提供 <code class="docutils literal notranslate"><span class="pre">_is_main_interpreter()</span></code>。 （参见 <a class="reference external" href="https://github.com/python/cpython/issues/112826">gh-112826</a><span class="link-target"> [https://github.com/python/cpython/issues/112826]</span>。）</p>
</li>
</ul>
</section>
</section>
<section id="build-changes">
<h2>构建的改变</h2>
<ul>
<li><p>Python 不再使用 <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> 来构建共享的 C 扩展模块。 头文件和库等编译参数在 <code class="docutils literal notranslate"><span class="pre">configure</span></code> 脚本中检测。 扩展将由 <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> 来构建。 大多数扩展使用 <code class="docutils literal notranslate"><span class="pre">pkg-config</span></code> 并回退为手动检测。 （由 Christian Heimes 在 <a class="reference external" href="https://github.com/python/cpython/issues/93939">gh-93939</a><span class="link-target"> [https://github.com/python/cpython/issues/93939]</span> 中贡献。）</p></li>
<li><p>现在需要用带有两个形参的 <code class="docutils literal notranslate"><span class="pre">va_start()</span></code>，如 <code class="docutils literal notranslate"><span class="pre">va_start(args,</span> <span class="pre">format),</span></code> 来构建 Python。 现在将不会再调用单个形参的 <code class="docutils literal notranslate"><span class="pre">va_start()</span></code>。 （由 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/93207">gh-93207</a><span class="link-target"> [https://github.com/python/cpython/issues/93207]</span> 中贡献。）</p></li>
<li><p>现在如果 Clang 编译器接受 ThinLTO 选项则 CPython 会将其作为默认的链接时间优化策略。 （由 Donghee Na 在 <a class="reference external" href="https://github.com/python/cpython/issues/89536">gh-89536</a><span class="link-target"> [https://github.com/python/cpython/issues/89536]</span> 中贡献。）</p></li>
<li><p>在 <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> 中添加了 <code class="docutils literal notranslate"><span class="pre">COMPILEALL_OPTS</span></code> 变量以覆盖 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> 中的 <a class="reference internal" href="../library/compileall.xhtml#module-compileall" title="compileall: Tools for byte-compiling all Python source files in a directory tree."><code class="xref py py-mod docutils literal notranslate"><span class="pre">compileall</span></code></a> 选项 (默认值: <code class="docutils literal notranslate"><span class="pre">-j0</span></code>)。 并将 3 条 <code class="docutils literal notranslate"><span class="pre">compileall</span></code> 命令合并为单条命令以便一次性构建所有优化级别 (0, 1, 2) 的 .pyc 文件。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/99289">gh-99289</a><span class="link-target"> [https://github.com/python/cpython/issues/99289]</span> 中贡献。）</p></li>
<li><p>为 64 位 LoongArch 添加了平台三选项:</p>
<ul class="simple">
<li><p>loongarch64-linux-gnusf</p></li>
<li><p>loongarch64-linux-gnuf32</p></li>
<li><p>loongarch64-linux-gnu</p></li>
</ul>
<p>（由 Zhang Na 在 <a class="reference external" href="https://github.com/python/cpython/issues/90656">gh-90656</a><span class="link-target"> [https://github.com/python/cpython/issues/90656]</span> 中贡献。）.)</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PYTHON_FOR_REGEN</span></code> 现在需要 Python 3.10 或更新版本。</p></li>
<li><p>现在需要有 autoconf 2.71 和 aclocal 1.16.4 才能重新生成 <code class="file docutils literal notranslate"><span class="pre">!configure</span></code>。 （由 Christian Heimes 在 <a class="reference external" href="https://github.com/python/cpython/issues/89886">gh-89886</a><span class="link-target"> [https://github.com/python/cpython/issues/89886]</span> 中贡献。）</p></li>
<li><p>来自 python.org 的 Windows 版本和 macOS 安装程序现在使用 OpenSSL 3.0。</p></li>
</ul>
</section>
<section id="c-api-changes">
<h2>C API 的改变</h2>
<section id="id4">
<h3>新的特性</h3>
<ul id="whatsnew312-pep697">
<li><p><span class="target" id="index-138"></span><a class="pep reference external" href="https://peps.python.org/pep-0697/"><strong>PEP 697</strong></a><span class="link-target"> [https://peps.python.org/pep-0697/]</span>: 引入了 <a class="reference internal" href="../c-api/stable.xhtml#unstable-c-api"><span class="std std-ref">不稳定 C API 层</span></a>，用于调试器和 JIT 编译器等低层级工具。 该 API 可能会在 CPython 的每个次要版本中发生变化而但发出弃用警告。 其内容在名称中以 <code class="docutils literal notranslate"><span class="pre">PyUnstable_</span></code> 前缀标记。</p>
<p>代码对象构造器:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnstable_Code_New()</span></code> (由 <code class="docutils literal notranslate"><span class="pre">PyCode_New</span></code> 改名而来)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnstable_Code_NewWithPosOnlyArgs()</span></code> (由 <code class="docutils literal notranslate"><span class="pre">PyCode_NewWithPosOnlyArgs</span></code> 改名而来)</p></li>
</ul>
<p>代码对象的额外存储 (<span class="target" id="index-139"></span><a class="pep reference external" href="https://peps.python.org/pep-0523/"><strong>PEP 523</strong></a><span class="link-target"> [https://peps.python.org/pep-0523/]</span>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnstable_Eval_RequestCodeExtraIndex()</span></code> (由 <code class="docutils literal notranslate"><span class="pre">_PyEval_RequestCodeExtraIndex</span></code> 改名而来)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnstable_Code_GetExtra()</span></code> (由 <code class="docutils literal notranslate"><span class="pre">_PyCode_GetExtra</span></code> 改名而来)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnstable_Code_SetExtra()</span></code> (由 <code class="docutils literal notranslate"><span class="pre">_PyCode_SetExtra</span></code> 改名而来)</p></li>
</ul>
<p>原有名称将继续可用直到对应的 API 发生改变。</p>
<p>（由 Petr Viktorin 在 <a class="reference external" href="https://github.com/python/cpython/issues/101101">gh-101101</a><span class="link-target"> [https://github.com/python/cpython/issues/101101]</span> 中贡献。）</p>
</li>
<li><p><span class="target" id="index-140"></span><a class="pep reference external" href="https://peps.python.org/pep-0697/"><strong>PEP 697</strong></a><span class="link-target"> [https://peps.python.org/pep-0697/]</span>: 添加了用于扩展实例内存布局不透明的类型的 API:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/type.xhtml#c.PyType_Spec.basicsize" title="PyType_Spec.basicsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyType_Spec.basicsize</span></code></a> 可以为零或负数，用于以指定继承或扩展基类的大小。</p></li>
<li><p>增加了 <a class="reference internal" href="../c-api/object.xhtml#c.PyObject_GetTypeData" title="PyObject_GetTypeData"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetTypeData()</span></code></a> 和 <a class="reference internal" href="../c-api/object.xhtml#c.PyType_GetTypeDataSize" title="PyType_GetTypeDataSize"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_GetTypeDataSize()</span></code></a> 以允许访问特定子类的实例数据。</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_ITEMS_AT_END" title="Py_TPFLAGS_ITEMS_AT_END"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_ITEMS_AT_END</span></code></a> 和 <a class="reference internal" href="../c-api/object.xhtml#c.PyObject_GetItemData" title="PyObject_GetItemData"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetItemData()</span></code></a> 以允许安全地扩展某些可变大小的类型，包括 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_Type" title="PyType_Type"><code class="xref c c-var docutils literal notranslate"><span class="pre">PyType_Type</span></code></a>。</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/structures.xhtml#c.Py_RELATIVE_OFFSET" title="Py_RELATIVE_OFFSET"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_RELATIVE_OFFSET</span></code></a> 以允许用特定于子类的结构体来定义 <a class="reference internal" href="../c-api/structures.xhtml#c.PyMemberDef" title="PyMemberDef"><code class="xref c c-type docutils literal notranslate"><span class="pre">成员</span></code></a>。</p></li>
</ul>
<p>（由 Petr Viktorin 在 <a class="reference external" href="https://github.com/python/cpython/issues/103509">gh-103509</a><span class="link-target"> [https://github.com/python/cpython/issues/103509]</span> 中贡献。）</p>
</li>
<li><p>添加了新的 <a class="reference internal" href="../c-api/stable.xhtml#limited-c-api"><span class="std std-ref">受限 C API</span></a> 函数 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromMetaclass" title="PyType_FromMetaclass"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromMetaclass()</span></code></a>，它使用了额外的 metaclass 参数对现有的 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 进行了泛化。 （由 Wenzel Jakob 在 <a class="reference external" href="https://github.com/python/cpython/issues/93012">gh-93012</a><span class="link-target"> [https://github.com/python/cpython/issues/93012]</span> 中贡献。）</p></li>
<li><p>在 <a class="reference internal" href="../c-api/stable.xhtml#stable"><span class="std std-ref">受限</span></a> 中添加了用于创建可使用 <a class="reference internal" href="../c-api/call.xhtml#vectorcall"><span class="std std-ref">vectorcall 协议</span></a> 来调用的对象的 API:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_HAVE_VECTORCALL" title="Py_TPFLAGS_HAVE_VECTORCALL"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_HAVE_VECTORCALL</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/call.xhtml#c.PyVectorcall_NARGS" title="PyVectorcall_NARGS"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyVectorcall_NARGS()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/call.xhtml#c.PyVectorcall_Call" title="PyVectorcall_Call"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyVectorcall_Call()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/call.xhtml#c.vectorcallfunc" title="vectorcallfunc"><code class="xref c c-type docutils literal notranslate"><span class="pre">vectorcallfunc</span></code></a></p></li>
</ul>
<p>现在当一个类的 <a class="reference internal" href="../reference/datamodel.xhtml#object.__call__" title="object.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__()</span></code></a> 方法被重新赋值时，该类的 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_HAVE_VECTORCALL" title="Py_TPFLAGS_HAVE_VECTORCALL"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_HAVE_VECTORCALL</span></code></a> 旗标将被移除。 这使得 vectorcall 可以安全地用于可变类型（即没有不可变旗标 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code></a> 的堆类型）。 未重载 <a class="reference internal" href="../c-api/typeobj.xhtml#c.PyTypeObject.tp_call" title="PyTypeObject.tp_call"><code class="xref c c-member docutils literal notranslate"><span class="pre">tp_call</span></code></a> 的可变类型现在继承了 <code class="docutils literal notranslate"><span class="pre">Py_TPFLAGS_HAVE_VECTORCALL</span></code> 旗标。 （由 Petr Viktorin 在 <a class="reference external" href="https://github.com/python/cpython/issues/93274">gh-93274</a><span class="link-target"> [https://github.com/python/cpython/issues/93274]</span> 中贡献。）</p>
<p>新增了 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_MANAGED_DICT" title="Py_TPFLAGS_MANAGED_DICT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_MANAGED_DICT</span></code></a> 和 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_MANAGED_WEAKREF" title="Py_TPFLAGS_MANAGED_WEAKREF"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_MANAGED_WEAKREF</span></code></a> 旗标。 这将允许扩展类在支持对象 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 和弱引用时减少记录消耗，占用更少内存并并加快访问速度。</p>
</li>
<li><p>在 <a class="reference internal" href="../c-api/stable.xhtml#stable"><span class="std std-ref">受限 API</span></a> 中添加了使用 <a class="reference internal" href="../c-api/call.xhtml#vectorcall"><span class="std std-ref">vectorcall 协议</span></a> 执行调用的 API:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/call.xhtml#c.PyObject_Vectorcall" title="PyObject_Vectorcall"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_Vectorcall()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/call.xhtml#c.PyObject_VectorcallMethod" title="PyObject_VectorcallMethod"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_VectorcallMethod()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/call.xhtml#c.PY_VECTORCALL_ARGUMENTS_OFFSET" title="PY_VECTORCALL_ARGUMENTS_OFFSET"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PY_VECTORCALL_ARGUMENTS_OFFSET</span></code></a></p></li>
</ul>
<p>这意味着 vectorcall 调用协议的传入端和传出端现在都可以在 <a class="reference internal" href="../c-api/stable.xhtml#stable"><span class="std std-ref">受限 API</span></a> 中使用。 （由 Wenzel Jakob 在 <a class="reference external" href="https://github.com/python/cpython/issues/98586">gh-98586</a><span class="link-target"> [https://github.com/python/cpython/issues/98586]</span> 中贡献。）</p>
</li>
<li><p>添加了两个新的公共函数 <a class="reference internal" href="../c-api/init.xhtml#c.PyEval_SetProfileAllThreads" title="PyEval_SetProfileAllThreads"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_SetProfileAllThreads()</span></code></a> 和 <a class="reference internal" href="../c-api/init.xhtml#c.PyEval_SetTraceAllThreads" title="PyEval_SetTraceAllThreads"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_SetTraceAllThreads()</span></code></a>，允许在调用的同时在所有运行线程中设置追踪和性能分析函数。 （由 Pablo Galindo 在 <a class="reference external" href="https://github.com/python/cpython/issues/93503">gh-93503</a><span class="link-target"> [https://github.com/python/cpython/issues/93503]</span> 中贡献。）</p></li>
<li><p>为 C API 添加了新函数 <a class="reference internal" href="../c-api/function.xhtml#c.PyFunction_SetVectorcall" title="PyFunction_SetVectorcall"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFunction_SetVectorcall()</span></code></a> 用于设置给定 <a class="reference internal" href="../c-api/function.xhtml#c.PyFunctionObject" title="PyFunctionObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyFunctionObject</span></code></a> 的 vectorcall 字段。 （由 Andrew Frost 在 <a class="reference external" href="https://github.com/python/cpython/issues/92257">gh-92257</a><span class="link-target"> [https://github.com/python/cpython/issues/92257]</span> 中贡献。）</p></li>
<li><p>C API 现在允许通过 <a class="reference internal" href="../c-api/dict.xhtml#c.PyDict_AddWatcher" title="PyDict_AddWatcher"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDict_AddWatcher()</span></code></a>、<a class="reference internal" href="../c-api/dict.xhtml#c.PyDict_Watch" title="PyDict_Watch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDict_Watch()</span></code></a> 和相关 API 注册回调，以便在字典被修改时调用。 这主要用于优化解释器、JIT 编译器或调试器。 （由 Carl Meyer 在 <a class="reference external" href="https://github.com/python/cpython/issues/91052">gh-91052</a><span class="link-target"> [https://github.com/python/cpython/issues/91052]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_AddWatcher" title="PyType_AddWatcher"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_AddWatcher()</span></code></a> 和 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_Watch" title="PyType_Watch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_Watch()</span></code></a> API 用于注册回调以接收类型变更通知。 （由 Carl Meyer 在 <a class="reference external" href="https://github.com/python/cpython/issues/91051">gh-91051</a><span class="link-target"> [https://github.com/python/cpython/issues/91051]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/code.xhtml#c.PyCode_AddWatcher" title="PyCode_AddWatcher"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCode_AddWatcher()</span></code></a> 和 <a class="reference internal" href="../c-api/code.xhtml#c.PyCode_ClearWatcher" title="PyCode_ClearWatcher"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCode_ClearWatcher()</span></code></a> API 用于注册回调以接收代码对象创建和销毁时的通知。 （由 Itamar Oren 在 <a class="reference external" href="https://github.com/python/cpython/issues/91054">gh-91054</a><span class="link-target"> [https://github.com/python/cpython/issues/91054]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/frame.xhtml#c.PyFrame_GetVar" title="PyFrame_GetVar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetVar()</span></code></a> 和 <a class="reference internal" href="../c-api/frame.xhtml#c.PyFrame_GetVarString" title="PyFrame_GetVarString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetVarString()</span></code></a> 函数用于通过名称来获取帧变量。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/91248">gh-91248</a><span class="link-target"> [https://github.com/python/cpython/issues/91248]</span> 中贡献。）</p></li>
<li><p>添加 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_GetRaisedException()</span></code></a> 和 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_SetRaisedException" title="PyErr_SetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetRaisedException()</span></code></a> 用于保存和恢复当前异常。 这些函数返回并接受单个异常对象，而不是像现在已弃用的 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_Fetch" title="PyErr_Fetch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Fetch()</span></code></a> 和 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_Restore" title="PyErr_Restore"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Restore()</span></code></a> 那样的三个参数。 这样不容易出错并且更为高效。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/101578">gh-101578</a><span class="link-target"> [https://github.com/python/cpython/issues/101578]</span> 中贡献。）</p></li>
<li><p>添加了 <code class="docutils literal notranslate"><span class="pre">_PyErr_ChainExceptions1</span></code>，它接受一个异常实例，用于取代旧式 API <code class="docutils literal notranslate"><span class="pre">_PyErr_ChainExceptions</span></code>，后者现已被弃用。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/101578">gh-101578</a><span class="link-target"> [https://github.com/python/cpython/issues/101578]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyException_GetArgs" title="PyException_GetArgs"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyException_GetArgs()</span></code></a> 和 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyException_SetArgs" title="PyException_SetArgs"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyException_SetArgs()</span></code></a> 作为便捷函数用于检索和修改传递给异常的构造函数的 <a class="reference internal" href="../library/exceptions.xhtml#BaseException.args" title="BaseException.args"><code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code></a>。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/101578">gh-101578</a><span class="link-target"> [https://github.com/python/cpython/issues/101578]</span> 中贡献。）</p></li>
<li><p>添加了 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_DisplayException" title="PyErr_DisplayException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_DisplayException()</span></code></a>，它接受一个异常实例，用于取代旧式 API <code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code>。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102755">gh-102755</a><span class="link-target"> [https://github.com/python/cpython/issues/102755]</span> 中贡献。）</p></li>
</ul>
<ul id="whatsnew312-pep683">
<li><p><span class="target" id="index-141"></span><a class="pep reference external" href="https://peps.python.org/pep-0683/"><strong>PEP 683</strong></a><span class="link-target"> [https://peps.python.org/pep-0683/]</span>: 引入了 <em>永生对象</em>，它允许对象绕过引用计数，并对 C-API 进行相应修改：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">_Py_IMMORTAL_REFCNT</span></code>: 定义对象的引用计数</dt><dd><p>为永生对象。</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_IsImmortal</span></code> 检测一个对象是否具有永生引用计数。</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">PyObject_HEAD_INIT</span></code> 这将把引用计数初始化为</dt><dd><p><code class="docutils literal notranslate"><span class="pre">_Py_IMMORTAL_REFCNT</span></code> 当配合 <code class="docutils literal notranslate"><span class="pre">Py_BUILD_CORE</span></code> 使用时。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">SSTATE_INTERNED_IMMORTAL</span></code> 一个针对内部 unicode 对象的标识符</dt><dd><p>为永生对象。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">SSTATE_INTERNED_IMMORTAL_STATIC</span></code> 一个针对内部 unicode</dt><dd><p>为永生且静态的对象</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sys.getunicodeinternedsize</span></code> 这将返回总计的 unicode</dt><dd><p>被管理的对象。现在 <code class="file docutils literal notranslate"><span class="pre">refleak.py</span></code> 需要这样才能正确地追踪引用计数和分配的块</p>
</dd>
</dl>
</li>
</ul>
<p>（由 Eddie Elizondo 在 <a class="reference external" href="https://github.com/python/cpython/issues/84436">gh-84436</a><span class="link-target"> [https://github.com/python/cpython/issues/84436]</span> 中贡献。）</p>
</li>
<li><p><span class="target" id="index-142"></span><a class="pep reference external" href="https://peps.python.org/pep-0684/"><strong>PEP 684</strong></a><span class="link-target"> [https://peps.python.org/pep-0684/]</span>: 新增了 <a class="reference internal" href="../c-api/init.xhtml#c.Py_NewInterpreterFromConfig" title="Py_NewInterpreterFromConfig"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_NewInterpreterFromConfig()</span></code></a> 函数和 <a class="reference internal" href="../c-api/init.xhtml#c.PyInterpreterConfig" title="PyInterpreterConfig"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyInterpreterConfig</span></code></a>，可用于创建具有单独 GIL 的子解释器。 （更多信息参见 <a class="reference internal" href="#whatsnew312-pep684"><span class="std std-ref">PEP 684: 每解释器 GIL</span></a>。） （由 Eric Snow 在 <a class="reference external" href="https://github.com/python/cpython/issues/104110">gh-104110</a><span class="link-target"> [https://github.com/python/cpython/issues/104110]</span> 中贡献。）</p></li>
<li><p>在 3.12 版的受限 C API 中，<a class="reference internal" href="../c-api/refcounting.xhtml#c.Py_INCREF" title="Py_INCREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_INCREF()</span></code></a> 和 <a class="reference internal" href="../c-api/refcounting.xhtml#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> 函数现在使用不透明函数调用的方式实现以隐藏实现细节。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/105387">gh-105387</a><span class="link-target"> [https://github.com/python/cpython/issues/105387]</span> 中贡献。）</p></li>
</ul>
</section>
<section id="id5">
<h3>移植到 Python 3.12</h3>
<ul>
<li><p>基于 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE*</span></code> 表示形式的旧式 Unicode API 已被移除。 请迁移到基于 UTF-8 或 <code class="docutils literal notranslate"><span class="pre">wchar_t*</span></code> 的 API。</p></li>
<li><p><a class="reference internal" href="../c-api/arg.xhtml#c.PyArg_ParseTuple" title="PyArg_ParseTuple"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyArg_ParseTuple()</span></code></a> 等参数解析函数不再支持基于 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE*</span></code> 的格式（例如 <code class="docutils literal notranslate"><span class="pre">u</span></code>, <code class="docutils literal notranslate"><span class="pre">Z</span></code> 等）。 请迁移到其他 Unicode 格式如 <code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">z</span></code>, <code class="docutils literal notranslate"><span class="pre">es</span></code> 和 <code class="docutils literal notranslate"><span class="pre">U</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tp_weaklist</span></code> 对于所有静态内置类型将始终为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。 这是 <code class="docutils literal notranslate"><span class="pre">PyTypeObject</span></code> 上的一个内部专属字段，但我们还是要指出这一变化以防有人碰巧仍然直接访问到该字段。 为避免出现中断，请考虑改用现有的公共 C-API，或在必要时使用（仅限内部使用的）宏 <code class="docutils literal notranslate"><span class="pre">_PyObject_GET_WEAKREFS_LISTPTR()</span></code>。</p></li>
<li><p>现在这个内部专用的 <a class="reference internal" href="../c-api/typeobj.xhtml#c.PyTypeObject.tp_subclasses" title="PyTypeObject.tp_subclasses"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyTypeObject.tp_subclasses</span></code></a> 可能不是一个有效的对象指针。 为了反映这一点我们将其类型改为 <span class="c-expr sig sig-inline c"><span class="kt">void</span><span class="p">*</span></span>。 我们提到这一点是为了防止有人碰巧直接访问到这个内部专用字段。</p>
<p>要获取子类的列表，请调用 Python 方法 <a class="reference internal" href="../library/stdtypes.xhtml#class.__subclasses__" title="class.__subclasses__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__subclasses__()</span></code></a> (例如使用 <a class="reference internal" href="../c-api/call.xhtml#c.PyObject_CallMethod" title="PyObject_CallMethod"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_CallMethod()</span></code></a>)。</p>
</li>
<li><p>在 <a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a> 和 <a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FromFormatV" title="PyUnicode_FromFormatV"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormatV()</span></code></a> 中添加对更多格式选项（左对齐、八进制、大写十六进制、<code class="xref c c-type docutils literal notranslate"><span class="pre">intmax_t</span></code>、<code class="xref c c-type docutils literal notranslate"><span class="pre">ptrdiff_t</span></code>、<code class="xref c c-type docutils literal notranslate"><span class="pre">wchar_t</span></code> C 字符串、可变宽度和精度）的支持。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/98836">gh-98836</a><span class="link-target"> [https://github.com/python/cpython/issues/98836]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a> 和 <a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FromFormatV" title="PyUnicode_FromFormatV"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormatV()</span></code></a> 中未被识别的格式字符现在会设置一个 <a class="reference internal" href="../library/exceptions.xhtml#SystemError" title="SystemError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SystemError</span></code></a>。 在之前的版本中它会导致格式字符串的所有其他部分被原样复制到结果字符串中，并丢弃任何额外的参数。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://github.com/python/cpython/issues/95781">gh-95781</a><span class="link-target"> [https://github.com/python/cpython/issues/95781]</span> 中贡献。）</p></li>
<li><p>修复了 <a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a> 和 <a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FromFormatV" title="PyUnicode_FromFormatV"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormatV()</span></code></a> 中错误的标志位置。 （由 Philip Georgi 在 <a class="reference external" href="https://github.com/python/cpython/issues/95504">gh-95504</a><span class="link-target"> [https://github.com/python/cpython/issues/95504]</span> 中贡献。）</p></li>
<li><p>希望添加 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 或弱引用槽位的扩展类应分别使用 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_MANAGED_DICT" title="Py_TPFLAGS_MANAGED_DICT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_MANAGED_DICT</span></code></a> 和 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_MANAGED_WEAKREF" title="Py_TPFLAGS_MANAGED_WEAKREF"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_MANAGED_WEAKREF</span></code></a> 来代替 <code class="docutils literal notranslate"><span class="pre">tp_dictoffset</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tp_weaklistoffset</span></code>。 目前仍支持使用 <code class="docutils literal notranslate"><span class="pre">tp_dictoffset</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tp_weaklistoffset</span></code>，但并不完全支持多重继承 (<a class="reference external" href="https://github.com/python/cpython/issues/95589">gh-95589</a><span class="link-target"> [https://github.com/python/cpython/issues/95589]</span>)，而且性能可能会变差。 声明了 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_MANAGED_DICT" title="Py_TPFLAGS_MANAGED_DICT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_MANAGED_DICT</span></code></a> 的类应当调用 <code class="xref c c-func docutils literal notranslate"><span class="pre">_PyObject_VisitManagedDict()</span></code> 和 <code class="xref c c-func docutils literal notranslate"><span class="pre">_PyObject_ClearManagedDict()</span></code> 来遍历并清除它们的实例的字典。 要清除弱引用，请像之前一样调用 <a class="reference internal" href="../c-api/weakref.xhtml#c.PyObject_ClearWeakRefs" title="PyObject_ClearWeakRefs"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_ClearWeakRefs()</span></code></a>。</p></li>
<li><p><a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_FSDecoder" title="PyUnicode_FSDecoder"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FSDecoder()</span></code></a> 函数不再接受类似字节串的路径，如 <a class="reference internal" href="../library/stdtypes.xhtml#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.xhtml#memoryview" title="memoryview"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> 类型：只接受明确的 <a class="reference internal" href="../library/stdtypes.xhtml#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 类型字节字符串。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/98393">gh-98393</a><span class="link-target"> [https://github.com/python/cpython/issues/98393]</span> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/refcounting.xhtml#c.Py_CLEAR" title="Py_CLEAR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_CLEAR</span></code></a>、<a class="reference internal" href="../c-api/refcounting.xhtml#c.Py_SETREF" title="Py_SETREF"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_SETREF</span></code></a> 和 <a class="reference internal" href="../c-api/refcounting.xhtml#c.Py_XSETREF" title="Py_XSETREF"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_XSETREF</span></code></a> 宏现在只会对其参数求值一次。如果参数有附带影响，这些附带影响将不会再重复。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/98724">gh-98724</a><span class="link-target"> [https://github.com/python/cpython/issues/98724]</span> 中贡献。）</p></li>
<li><p>解释器的错误指示器现在总是规范化的。 这意味着 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_SetObject" title="PyErr_SetObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetObject()</span></code></a>、<a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_SetString" title="PyErr_SetString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetString()</span></code></a> 以及其他设置错误指示器的函数在保存异常之前都会将其规范化。 （由 Mark Shannon 在 <a class="reference external" href="https://github.com/python/cpython/issues/101578">gh-101578</a><span class="link-target"> [https://github.com/python/cpython/issues/101578]</span> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_RefTotal</span></code> 已不再具有重要性而保留它只是为了 ABI 的兼容性。 请注意，这是一个内部全局变量并且仅在调试版本中可用。 如果你碰巧要使用它那么你需要开始使用 <code class="docutils literal notranslate"><span class="pre">_Py_GetGlobalRefTotal()</span></code>。</p></li>
<li><p>下面的函数将为新创建的类型选择一个合适的元类:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromSpec" title="PyType_FromSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpec()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromSpecWithBases" title="PyType_FromSpecWithBases"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpecWithBases()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a></p></li>
</ul>
<p>创建具有重载了 <a class="reference internal" href="../c-api/typeobj.xhtml#c.PyTypeObject.tp_new" title="PyTypeObject.tp_new"><code class="xref c c-member docutils literal notranslate"><span class="pre">tp_new</span></code></a> 的元类的类的做法已被弃用，在 Python 3.14+ 中将被禁止。 请注意这些函数会忽略元类的 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code>，从而可能导致不完整的初始化。</p>
<p>请注意 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromMetaclass" title="PyType_FromMetaclass"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromMetaclass()</span></code></a> (在 Python 3.12 中新增) 已禁止创建具有重载了 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code> (在 Python 中为 <a class="reference internal" href="../reference/datamodel.xhtml#object.__new__" title="object.__new__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__new__()</span></code></a> ) 的元类的类。</p>
<p>由于 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code> 重载了``PyType_From*`` 函数的几乎所有内容，因此两者互不兼容。 现有的行为 -- 在创建类型的一些步骤中忽略元类 -- 通常都是不安全的，因为（元）类会假定 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code> 已被调用。 目前还没有简单通用的绕过方式。 以下办法之一可能对你有用:</p>
<ul class="simple">
<li><p>如果你控制着元类，请避免在其中使用 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code>:</p>
<ul>
<li><p>如初始化可被跳过，则可以改在 <a class="reference internal" href="../c-api/typeobj.xhtml#c.PyTypeObject.tp_init" title="PyTypeObject.tp_init"><code class="xref c c-member docutils literal notranslate"><span class="pre">tp_init</span></code></a> 中完成。</p></li>
<li><p>如果元类不需要从 Python 执行实例化，则使用 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_DISALLOW_INSTANTIATION" title="Py_TPFLAGS_DISALLOW_INSTANTIATION"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_DISALLOW_INSTANTIATION</span></code></a> 旗标将其 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code> 设为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。 这将使其可被 <code class="docutils literal notranslate"><span class="pre">PyType_From*</span></code> 函数接受。</p></li>
</ul>
</li>
<li><p>避免使用 <code class="docutils literal notranslate"><span class="pre">PyType_From*</span></code> 函数：如果不需要 C 专属的特性（槽位或设置实例大小），请通过 <a class="reference internal" href="../c-api/call.xhtml#call"><span class="std std-ref">调用</span></a> 元类来创建类型。</p></li>
<li><p>如果你 <em>知道</em> 可以安全地跳过 <code class="docutils literal notranslate"><span class="pre">tp_new</span></code>，就使用 Python 中的 <a class="reference internal" href="../library/warnings.xhtml#warnings.catch_warnings" title="warnings.catch_warnings"><code class="xref py py-func docutils literal notranslate"><span class="pre">warnings.catch_warnings()</span></code></a> 过滤掉弃用警告。</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../c-api/veryhigh.xhtml#c.PyOS_InputHook" title="PyOS_InputHook"><code class="xref c c-var docutils literal notranslate"><span class="pre">PyOS_InputHook</span></code></a> 和 <a class="reference internal" href="../c-api/veryhigh.xhtml#c.PyOS_ReadlineFunctionPointer" title="PyOS_ReadlineFunctionPointer"><code class="xref c c-var docutils literal notranslate"><span class="pre">PyOS_ReadlineFunctionPointer</span></code></a> 将不再在 <a class="reference internal" href="../c-api/init.xhtml#sub-interpreter-support"><span class="std std-ref">子解释器</span></a> 中被调用。 这是因为客户端通常依赖进程级的全局状态（而这些回调没有办法恢复扩展模块状态）。</p>
<p>这也避免了扩展程序在不支持（或尚未被加载）的子解释器中运行的情况。 请参阅 <a class="reference external" href="https://github.com/python/cpython/issues/104668">gh-104668</a><span class="link-target"> [https://github.com/python/cpython/issues/104668]</span> 了解更多信息。</p>
</li>
<li><p><a class="reference internal" href="../c-api/long.xhtml#c.PyLongObject" title="PyLongObject"><code class="xref c c-struct docutils literal notranslate"><span class="pre">PyLongObject</span></code></a> 对其内部字段进行了修改以提高性能。 虽然 <a class="reference internal" href="../c-api/long.xhtml#c.PyLongObject" title="PyLongObject"><code class="xref c c-struct docutils literal notranslate"><span class="pre">PyLongObject</span></code></a> 的内部字段是私有的，但某些扩展模块会使用它们。 内部字段不应再被直接访问，而应改用以 <code class="docutils literal notranslate"><span class="pre">PyLong_...</span></code> 打头的 API 函数。 新增了两个 <em>暂定</em> API 函数用于高效访问适配至单个机器字的 <a class="reference internal" href="../c-api/long.xhtml#c.PyLongObject" title="PyLongObject"><code class="xref c c-struct docutils literal notranslate"><span class="pre">PyLongObject</span></code></a> 的值:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/long.xhtml#c.PyUnstable_Long_IsCompact" title="PyUnstable_Long_IsCompact"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnstable_Long_IsCompact()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/long.xhtml#c.PyUnstable_Long_CompactValue" title="PyUnstable_Long_CompactValue"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnstable_Long_CompactValue()</span></code></a></p></li>
</ul>
</li>
<li><p>通过 <a class="reference internal" href="../c-api/memory.xhtml#c.PyMem_SetAllocator" title="PyMem_SetAllocator"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyMem_SetAllocator()</span></code></a> 设置的自定义分配器现在必须是线程安全的，无论内存域是什么。 没有自己的状态的分配器，包括“钩子”将不会受影响。 如果你的自定义分配器还不是线程安全的且你需要指导则请创建一个新的 GitHub 问题并抄送给 <code class="docutils literal notranslate"><span class="pre">&#64;ericsnowcurrently</span></code>。</p></li>
</ul>
</section>
<section id="id6">
<h3>弃用</h3>
<ul>
<li><p>根据 <span class="target" id="index-143"></span><a class="pep reference external" href="https://peps.python.org/pep-0699/"><strong>PEP 699</strong></a><span class="link-target"> [https://peps.python.org/pep-0699/]</span> 的要求，<a class="reference internal" href="../c-api/dict.xhtml#c.PyDictObject" title="PyDictObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyDictObject</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">ma_version_tag</span></code> 字段对于扩展模块已被弃用。 访问该字段将在编译时生成编译器警告。 该字段将在 Python 3.14 中移除。 （由 Ramvikrams 和 Kumar Aditya 在 <a class="reference external" href="https://github.com/python/cpython/issues/101193">gh-101193</a><span class="link-target"> [https://github.com/python/cpython/issues/101193]</span> 中贡献。 PEP 由 Ken Jin 撰写。）</p></li>
<li><p>已弃用的全局配置变量:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_DebugFlag" title="Py_DebugFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_DebugFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.parser_debug" title="PyConfig.parser_debug"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.parser_debug</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_VerboseFlag" title="Py_VerboseFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_VerboseFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.verbose" title="PyConfig.verbose"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.verbose</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_QuietFlag" title="Py_QuietFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_QuietFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.quiet" title="PyConfig.quiet"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.quiet</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_InteractiveFlag" title="Py_InteractiveFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_InteractiveFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.interactive" title="PyConfig.interactive"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.interactive</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_InspectFlag" title="Py_InspectFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_InspectFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.inspect" title="PyConfig.inspect"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.inspect</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_OptimizeFlag" title="Py_OptimizeFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_OptimizeFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.optimization_level" title="PyConfig.optimization_level"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.optimization_level</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_NoSiteFlag" title="Py_NoSiteFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_NoSiteFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.site_import" title="PyConfig.site_import"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.site_import</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_BytesWarningFlag" title="Py_BytesWarningFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_BytesWarningFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.bytes_warning" title="PyConfig.bytes_warning"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.bytes_warning</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_FrozenFlag" title="Py_FrozenFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_FrozenFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.pathconfig_warnings" title="PyConfig.pathconfig_warnings"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.pathconfig_warnings</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_IgnoreEnvironmentFlag" title="Py_IgnoreEnvironmentFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_IgnoreEnvironmentFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.use_environment" title="PyConfig.use_environment"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.use_environment</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_DontWriteBytecodeFlag" title="Py_DontWriteBytecodeFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_DontWriteBytecodeFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.write_bytecode" title="PyConfig.write_bytecode"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.write_bytecode</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_NoUserSiteDirectory" title="Py_NoUserSiteDirectory"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_NoUserSiteDirectory</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.user_site_directory" title="PyConfig.user_site_directory"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.user_site_directory</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_UnbufferedStdioFlag" title="Py_UnbufferedStdioFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_UnbufferedStdioFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.buffered_stdio" title="PyConfig.buffered_stdio"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.buffered_stdio</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_HashRandomizationFlag" title="Py_HashRandomizationFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_HashRandomizationFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.use_hash_seed" title="PyConfig.use_hash_seed"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.use_hash_seed</span></code></a> 和 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.hash_seed" title="PyConfig.hash_seed"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.hash_seed</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_IsolatedFlag" title="Py_IsolatedFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_IsolatedFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.isolated" title="PyConfig.isolated"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.isolated</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_LegacyWindowsFSEncodingFlag" title="Py_LegacyWindowsFSEncodingFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_LegacyWindowsFSEncodingFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyPreConfig.legacy_windows_fs_encoding" title="PyPreConfig.legacy_windows_fs_encoding"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyPreConfig.legacy_windows_fs_encoding</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_LegacyWindowsStdioFlag" title="Py_LegacyWindowsStdioFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_LegacyWindowsStdioFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.legacy_windows_stdio" title="PyConfig.legacy_windows_stdio"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.legacy_windows_stdio</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_FileSystemDefaultEncoding</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_HasFileSystemDefaultEncoding</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_FileSystemDefaultEncodeErrors</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.filesystem_errors" title="PyConfig.filesystem_errors"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.filesystem_errors</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_UTF8Mode</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyPreConfig.utf8_mode" title="PyPreConfig.utf8_mode"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyPreConfig.utf8_mode</span></code></a> (参见 <a class="reference internal" href="../c-api/init_config.xhtml#c.Py_PreInitialize" title="Py_PreInitialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_PreInitialize()</span></code></a>)</p></li>
</ul>
<p><a class="reference internal" href="../c-api/init_config.xhtml#c.Py_InitializeFromConfig" title="Py_InitializeFromConfig"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_InitializeFromConfig()</span></code></a> API 应当改为使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig" title="PyConfig"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyConfig</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/77782">gh-77782</a><span class="link-target"> [https://github.com/python/cpython/issues/77782]</span> 中贡献。）</p>
</li>
<li><p>使用可变的基类创建 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code class="xref c c-data docutils literal notranslate"><span class="pre">不可变类型</span></code></a> 的做法已被弃用并将在 Python 3.14 中被禁用。 (<a class="reference external" href="https://github.com/python/cpython/issues/95388">gh-95388</a><span class="link-target"> [https://github.com/python/cpython/issues/95388]</span>)</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">structmember.h</span></code> 头文件已被弃用，不过它仍可继续使用也没有计划将其移除。</p>
<p>现在只需包括 <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> 即可获得其内容，如果找不到请添加 <code class="docutils literal notranslate"><span class="pre">Py</span></code> 前缀：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/structures.xhtml#c.PyMemberDef" title="PyMemberDef"><code class="xref c c-struct docutils literal notranslate"><span class="pre">PyMemberDef</span></code></a>, <a class="reference internal" href="../c-api/structures.xhtml#c.PyMember_GetOne" title="PyMember_GetOne"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyMember_GetOne()</span></code></a> 和 <a class="reference internal" href="../c-api/structures.xhtml#c.PyMember_SetOne" title="PyMember_SetOne"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyMember_SetOne()</span></code></a></p></li>
<li><p>类型宏如 <a class="reference internal" href="../c-api/structures.xhtml#c.Py_T_INT" title="Py_T_INT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_T_INT</span></code></a>, <a class="reference internal" href="../c-api/structures.xhtml#c.Py_T_DOUBLE" title="Py_T_DOUBLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_T_DOUBLE</span></code></a> 等（之前为 <code class="docutils literal notranslate"><span class="pre">T_INT</span></code>, <code class="docutils literal notranslate"><span class="pre">T_DOUBLE</span></code> 等）</p></li>
<li><p>旗标 <a class="reference internal" href="../c-api/structures.xhtml#c.Py_READONLY" title="Py_READONLY"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_READONLY</span></code></a> (之前为 <code class="docutils literal notranslate"><span class="pre">READONLY</span></code>) 和 <a class="reference internal" href="../c-api/structures.xhtml#c.Py_AUDIT_READ" title="Py_AUDIT_READ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_AUDIT_READ</span></code></a> (之前为全大写形式)</p></li>
</ul>
<p><code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> 上有几个项目没有暴露：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/structures.xhtml#c.T_OBJECT" title="T_OBJECT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">T_OBJECT</span></code></a> (使用 <a class="reference internal" href="../c-api/structures.xhtml#c.Py_T_OBJECT_EX" title="Py_T_OBJECT_EX"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_T_OBJECT_EX</span></code></a>)</p></li>
<li><p><a class="reference internal" href="../c-api/structures.xhtml#c.T_NONE" title="T_NONE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">T_NONE</span></code></a> (之前未写入文档，并且相当怪异)</p></li>
<li><p>不进行任何操作的宏 <code class="docutils literal notranslate"><span class="pre">WRITE_RESTRICTED</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RESTRICTED</span></code> 和 <code class="docutils literal notranslate"><span class="pre">READ_RESTRICTED</span></code> 宏，等同于 <a class="reference internal" href="../c-api/structures.xhtml#c.Py_AUDIT_READ" title="Py_AUDIT_READ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_AUDIT_READ</span></code></a>。</p></li>
<li><p>在某些配置中， <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> 未包含 <code class="docutils literal notranslate"><span class="pre">&lt;stddef.h&gt;</span></code> 。使用 <code class="docutils literal notranslate"><span class="pre">offsetof()</span></code> 时，应手动将其包含在内。</p></li>
</ul>
<p>已被弃用的头文件将继续以原来的名称提供原来的内容。 你的旧代码可以保持不变，除非额外的包括指令和无命名空间宏会给你带来很大困扰。</p>
<p>（由 Petr Viktorin 在 <a class="reference external" href="https://github.com/python/cpython/issues/47146">gh-47146</a><span class="link-target"> [https://github.com/python/cpython/issues/47146]</span> 中贡献，基于 Alexander Belopolsky 和 Matthias Braun 在先前的工作。）.)</p>
</li>
<li><p><a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_Fetch" title="PyErr_Fetch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Fetch()</span></code></a> 和 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_Restore" title="PyErr_Restore"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Restore()</span></code></a> 已被弃用。请使用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_GetRaisedException()</span></code></a> 和 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_SetRaisedException" title="PyErr_SetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetRaisedException()</span></code></a> 代替。(由 Mark Shannon 在:gh:<cite>101578</cite> 贡献）。</p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 已被弃用，请改用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_DisplayException" title="PyErr_DisplayException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_DisplayException()</span></code></a>。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102755">gh-102755</a><span class="link-target"> [https://github.com/python/cpython/issues/102755]</span> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_PyErr_ChainExceptions</span></code> 已被弃用。 请改用 <code class="docutils literal notranslate"><span class="pre">_PyErr_ChainExceptions1</span></code>。 （由 Irit Katriel 在 <a class="reference external" href="https://github.com/python/cpython/issues/102192">gh-102192</a><span class="link-target"> [https://github.com/python/cpython/issues/102192]</span> 中贡献。）</p></li>
<li><p>使用 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromSpec" title="PyType_FromSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpec()</span></code></a>, <a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromSpecWithBases" title="PyType_FromSpecWithBases"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpecWithBases()</span></code></a> 或 <a class="reference internal" href="../c-api/type.xhtml#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 来创建所属元类重载了 <a class="reference internal" href="../c-api/typeobj.xhtml#c.PyTypeObject.tp_new" title="PyTypeObject.tp_new"><code class="xref c c-member docutils literal notranslate"><span class="pre">tp_new</span></code></a> 的类的做法已被弃用。 请改为调用相应元类。is deprecated. Call the metaclass instead.</p></li>
</ul>
<section id="id7">
<h4>计划在 Python 3.14 中移除</h4>
<ul>
<li><p><a class="reference internal" href="../c-api/dict.xhtml#c.PyDictObject" title="PyDictObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyDictObject</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">ma_version_tag</span></code> 字段用于扩展模块 ( <span class="target" id="index-144"></span><a class="pep reference external" href="https://peps.python.org/pep-0699/"><strong>PEP 699</strong></a><span class="link-target"> [https://peps.python.org/pep-0699/]</span> ; <a class="reference external" href="https://github.com/python/cpython/issues/101193">gh-101193</a><span class="link-target"> [https://github.com/python/cpython/issues/101193]</span> )。</p></li>
<li><p>全局配置变量：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_DebugFlag" title="Py_DebugFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_DebugFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.parser_debug" title="PyConfig.parser_debug"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.parser_debug</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_VerboseFlag" title="Py_VerboseFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_VerboseFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.verbose" title="PyConfig.verbose"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.verbose</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_QuietFlag" title="Py_QuietFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_QuietFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.quiet" title="PyConfig.quiet"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.quiet</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_InteractiveFlag" title="Py_InteractiveFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_InteractiveFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.interactive" title="PyConfig.interactive"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.interactive</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_InspectFlag" title="Py_InspectFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_InspectFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.inspect" title="PyConfig.inspect"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.inspect</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_OptimizeFlag" title="Py_OptimizeFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_OptimizeFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.optimization_level" title="PyConfig.optimization_level"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.optimization_level</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_NoSiteFlag" title="Py_NoSiteFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_NoSiteFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.site_import" title="PyConfig.site_import"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.site_import</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_BytesWarningFlag" title="Py_BytesWarningFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_BytesWarningFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.bytes_warning" title="PyConfig.bytes_warning"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.bytes_warning</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_FrozenFlag" title="Py_FrozenFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_FrozenFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.pathconfig_warnings" title="PyConfig.pathconfig_warnings"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.pathconfig_warnings</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_IgnoreEnvironmentFlag" title="Py_IgnoreEnvironmentFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_IgnoreEnvironmentFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.use_environment" title="PyConfig.use_environment"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.use_environment</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_DontWriteBytecodeFlag" title="Py_DontWriteBytecodeFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_DontWriteBytecodeFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.write_bytecode" title="PyConfig.write_bytecode"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.write_bytecode</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_NoUserSiteDirectory" title="Py_NoUserSiteDirectory"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_NoUserSiteDirectory</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.user_site_directory" title="PyConfig.user_site_directory"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.user_site_directory</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_UnbufferedStdioFlag" title="Py_UnbufferedStdioFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_UnbufferedStdioFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.buffered_stdio" title="PyConfig.buffered_stdio"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.buffered_stdio</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_HashRandomizationFlag" title="Py_HashRandomizationFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_HashRandomizationFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.use_hash_seed" title="PyConfig.use_hash_seed"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.use_hash_seed</span></code></a> 和 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.hash_seed" title="PyConfig.hash_seed"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.hash_seed</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_IsolatedFlag" title="Py_IsolatedFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_IsolatedFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.isolated" title="PyConfig.isolated"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.isolated</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_LegacyWindowsFSEncodingFlag" title="Py_LegacyWindowsFSEncodingFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_LegacyWindowsFSEncodingFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyPreConfig.legacy_windows_fs_encoding" title="PyPreConfig.legacy_windows_fs_encoding"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyPreConfig.legacy_windows_fs_encoding</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_LegacyWindowsStdioFlag" title="Py_LegacyWindowsStdioFlag"><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_LegacyWindowsStdioFlag</span></code></a>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.legacy_windows_stdio" title="PyConfig.legacy_windows_stdio"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.legacy_windows_stdio</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_FileSystemDefaultEncoding</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_HasFileSystemDefaultEncoding</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_FileSystemDefaultEncodeErrors</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.filesystem_errors" title="PyConfig.filesystem_errors"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.filesystem_errors</span></code></a></p></li>
<li><p><code class="xref c c-var docutils literal notranslate"><span class="pre">Py_UTF8Mode</span></code>: 使用 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyPreConfig.utf8_mode" title="PyPreConfig.utf8_mode"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyPreConfig.utf8_mode</span></code></a> (参见 <a class="reference internal" href="../c-api/init_config.xhtml#c.Py_PreInitialize" title="Py_PreInitialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_PreInitialize()</span></code></a>)</p></li>
</ul>
<p><a class="reference internal" href="../c-api/init_config.xhtml#c.Py_InitializeFromConfig" title="Py_InitializeFromConfig"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_InitializeFromConfig()</span></code></a> API 应与 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig" title="PyConfig"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyConfig</span></code></a> 一起使用。</p>
</li>
<li><p>创建 <a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code class="xref c c-data docutils literal notranslate"><span class="pre">immutable</span> <span class="pre">types</span></code></a>  的可变基础 ( <a class="reference external" href="https://github.com/python/cpython/issues/95388">gh-95388</a><span class="link-target"> [https://github.com/python/cpython/issues/95388]</span> )。</p></li>
</ul>
</section>
<section id="id8">
<h4>Python 3.15 中的待移除功能</h4>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/import.xhtml#c.PyImport_ImportModuleNoBlock" title="PyImport_ImportModuleNoBlock"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModuleNoBlock()</span></code></a> ：使用 <a class="reference internal" href="../c-api/import.xhtml#c.PyImport_ImportModule" title="PyImport_ImportModule"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModule()</span></code></a></p></li>
<li><p><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE_WIDE</span></code> 类型：使用 <code class="xref c c-type docutils literal notranslate"><span class="pre">wchar_t</span></code></p></li>
<li><p><a class="reference internal" href="../c-api/unicode.xhtml#c.Py_UNICODE" title="Py_UNICODE"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE</span></code></a> 类型：使用 <code class="xref c c-type docutils literal notranslate"><span class="pre">wchar_t</span></code></p></li>
<li><p>Python 初始化函数</p>
<ul>
<li><p><a class="reference internal" href="../c-api/sys.xhtml#c.PySys_ResetWarnOptions" title="PySys_ResetWarnOptions"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySys_ResetWarnOptions()</span></code></a>：清除 <a class="reference internal" href="../library/sys.xhtml#sys.warnoptions" title="sys.warnoptions"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.warnoptions</span></code></a> 和 <code class="xref py py-data docutils literal notranslate"><span class="pre">warnings.filters</span></code></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_GetExecPrefix" title="Py_GetExecPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetExecPrefix()</span></code></a> ：获取 <a class="reference internal" href="../library/sys.xhtml#sys.exec_prefix" title="sys.exec_prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.exec_prefix</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_GetPath" title="Py_GetPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPath()</span></code></a> ：获取 <a class="reference internal" href="../library/sys.xhtml#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_GetPrefix" title="Py_GetPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPrefix()</span></code></a> ：获取 <a class="reference internal" href="../library/sys.xhtml#sys.prefix" title="sys.prefix"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.prefix</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_GetProgramFullPath" title="Py_GetProgramFullPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramFullPath()</span></code></a> ：获取 <a class="reference internal" href="../library/sys.xhtml#sys.executable" title="sys.executable"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.executable</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_GetProgramName" title="Py_GetProgramName"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramName()</span></code></a> ：获取 <a class="reference internal" href="../library/sys.xhtml#sys.executable" title="sys.executable"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.executable</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.Py_GetPythonHome" title="Py_GetPythonHome"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPythonHome()</span></code></a> ：获取 <a class="reference internal" href="../c-api/init_config.xhtml#c.PyConfig.home" title="PyConfig.home"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.home</span></code></a> 或 <span class="target" id="index-145"></span><a class="reference internal" href="../using/cmdline.xhtml#envvar-PYTHONHOME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONHOME</span></code></a> 环境变量</p></li>
</ul>
</li>
</ul>
</section>
<section id="id9">
<h4>计划在未来版本中移除</h4>
<p>以下 API 已被弃用，将被移除，但目前尚未确定移除日期。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/typeobj.xhtml#c.Py_TPFLAGS_HAVE_FINALIZE" title="Py_TPFLAGS_HAVE_FINALIZE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_HAVE_FINALIZE</span></code></a> ：自 Python 3.8 起不再需要</p></li>
<li><p><a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_Fetch" title="PyErr_Fetch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Fetch()</span></code></a> : 使用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_GetRaisedException()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_NormalizeException" title="PyErr_NormalizeException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_NormalizeException()</span></code></a> :使用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_GetRaisedException()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_Restore" title="PyErr_Restore"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Restore()</span></code></a> :使用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_SetRaisedException" title="PyErr_SetRaisedException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetRaisedException()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/module.xhtml#c.PyModule_GetFilename" title="PyModule_GetFilename"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetFilename()</span></code></a> :使用 <a class="reference internal" href="../c-api/module.xhtml#c.PyModule_GetFilenameObject" title="PyModule_GetFilenameObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetFilenameObject()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/sys.xhtml#c.PyOS_AfterFork" title="PyOS_AfterFork"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyOS_AfterFork()</span></code></a> :使用 <a class="reference internal" href="../c-api/sys.xhtml#c.PyOS_AfterFork_Child" title="PyOS_AfterFork_Child"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyOS_AfterFork_Child()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/slice.xhtml#c.PySlice_GetIndicesEx" title="PySlice_GetIndicesEx"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySlice_GetIndicesEx()</span></code></a> ：使用 <a class="reference internal" href="../c-api/slice.xhtml#c.PySlice_Unpack" title="PySlice_Unpack"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySlice_Unpack()</span></code></a> 和 <a class="reference internal" href="../c-api/slice.xhtml#c.PySlice_AdjustIndices" title="PySlice_AdjustIndices"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySlice_AdjustIndices()</span></code></a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsDecodedObject()</span></code> :使用 <a class="reference internal" href="../c-api/codec.xhtml#c.PyCodec_Decode" title="PyCodec_Decode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCodec_Decode()</span></code></a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsDecodedUnicode()</span></code> :使用 <a class="reference internal" href="../c-api/codec.xhtml#c.PyCodec_Decode" title="PyCodec_Decode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCodec_Decode()</span></code></a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsEncodedObject()</span></code> : 使用 <a class="reference internal" href="../c-api/codec.xhtml#c.PyCodec_Encode" title="PyCodec_Encode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCodec_Encode()</span></code></a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsEncodedUnicode()</span></code> :使用 <a class="reference internal" href="../c-api/codec.xhtml#c.PyCodec_Encode" title="PyCodec_Encode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCodec_Encode()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/unicode.xhtml#c.PyUnicode_READY" title="PyUnicode_READY"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_READY()</span></code></a> ：自 Python 3.12 起不再需要</p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> :使用 <a class="reference internal" href="../c-api/exceptions.xhtml#c.PyErr_DisplayException" title="PyErr_DisplayException"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_DisplayException()</span></code></a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">_PyErr_ChainExceptions()</span></code> :使用 <code class="docutils literal notranslate"><span class="pre">_PyErr_ChainExceptions1</span></code></p></li>
<li><p><code class="xref c c-member docutils literal notranslate"><span class="pre">PyBytesObject.ob_shash</span></code> 成员：改用 <a class="reference internal" href="../c-api/object.xhtml#c.PyObject_Hash" title="PyObject_Hash"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_Hash()</span></code></a></p></li>
<li><p><code class="xref c c-member docutils literal notranslate"><span class="pre">PyDictObject.ma_version_tag</span></code> 成员</p></li>
<li><p>线程本地存储 (TLS) API：</p>
<ul>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.PyThread_create_key" title="PyThread_create_key"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_create_key()</span></code></a> ：使用 <a class="reference internal" href="../c-api/init.xhtml#c.PyThread_tss_alloc" title="PyThread_tss_alloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_tss_alloc()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.PyThread_delete_key" title="PyThread_delete_key"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_delete_key()</span></code></a> ：使用 <a class="reference internal" href="../c-api/init.xhtml#c.PyThread_tss_free" title="PyThread_tss_free"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_tss_free()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.PyThread_set_key_value" title="PyThread_set_key_value"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_set_key_value()</span></code></a> ：使用 <a class="reference internal" href="../c-api/init.xhtml#c.PyThread_tss_set" title="PyThread_tss_set"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_tss_set()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.PyThread_get_key_value" title="PyThread_get_key_value"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_get_key_value()</span></code></a> :使用 <a class="reference internal" href="../c-api/init.xhtml#c.PyThread_tss_get" title="PyThread_tss_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_tss_get()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.PyThread_delete_key_value" title="PyThread_delete_key_value"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_delete_key_value()</span></code></a> :使用 <a class="reference internal" href="../c-api/init.xhtml#c.PyThread_tss_delete" title="PyThread_tss_delete"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_tss_delete()</span></code></a></p></li>
<li><p><a class="reference internal" href="../c-api/init.xhtml#c.PyThread_ReInitTLS" title="PyThread_ReInitTLS"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThread_ReInitTLS()</span></code></a> ：自 Python 3.7 起不再需要</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id10">
<h3>移除</h3>
<ul class="simple">
<li><p>移除 <code class="file docutils literal notranslate"><span class="pre">token.h</span></code> 头文件。从来就没有任何公开的 C 语言标记程序接口。 <code class="file docutils literal notranslate"><span class="pre">token.h</span></code> 头文件只是为 Python 内部使用而设计的。(由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/92651">gh-92651</a><span class="link-target"> [https://github.com/python/cpython/issues/92651]</span> 提供）。</p></li>
<li><p>旧式 Unicode API 已被移除。 请参阅 <span class="target" id="index-146"></span><a class="pep reference external" href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a><span class="link-target"> [https://peps.python.org/pep-0623/]</span> 了解详情。for detail.</p>
<ul>
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_WCHAR_KIND</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AS_UNICODE()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicode()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeAndSize()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AS_DATA()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromUnicode()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GET_SIZE()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetSize()</span></code></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GET_DATA_SIZE()</span></code></p></li>
</ul>
</li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">PyUnicode_InternImmortal()</span></code> 函数宏。 （由 Victor Stinner 在 <a class="reference external" href="https://github.com/python/cpython/issues/85858">gh-85858</a><span class="link-target"> [https://github.com/python/cpython/issues/85858]</span> 中贡献。）.)</p></li>
</ul>
</section>
</section>
<section id="notable-changes-in-3-12-4">
<h2>3.12.4 中的重要变化</h2>
<section id="ipaddress">
<h3>ipaddress</h3>
<ul class="simple">
<li><p>修正了 <code class="docutils literal notranslate"><span class="pre">IPv4Address</span></code>, <code class="docutils literal notranslate"><span class="pre">IPv6Address</span></code>, <code class="docutils literal notranslate"><span class="pre">IPv4Network</span></code> 和 <code class="docutils literal notranslate"><span class="pre">IPv6Network</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">is_global</span></code> 和 <code class="docutils literal notranslate"><span class="pre">is_private</span></code> 行为。</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>